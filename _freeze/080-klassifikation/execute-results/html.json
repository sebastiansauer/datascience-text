{
  "hash": "8935e3f8e904202a92d99faee43d18fc",
  "result": {
    "markdown": "\n\n# Klassifikation von Hatespeech\n\n\n\n\n\n## Vorab\n\n\n### Lernziele\n\n\n- Sie können grundlegende Verfahren zur Klassifikation von Hatespeech einsetzen und erklären\n\n\n\n\n\n\n\n\n### Benötigte R-Pakete\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-1_c37d4b591d4c019567660229e6502e98'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(easystats)\nlibrary(tidymodels)\nlibrary(tidytext)\nlibrary(textrecipes)  # Textanalysen in Tidymodels-Rezepten\nlibrary(lsa)  # stopwords\nlibrary(discrim)  # naive bayes classification\nlibrary(naivebayes)\nlibrary(tictoc)  # Zeitmessung\nlibrary(fastrtext)  # Worteinbettungen\nlibrary(remoji)  # Emojis\nlibrary(tokenizers)  # Vektoren tokenisieren\nlibrary(tictoc)  # Zeitmessung\n```\n:::\n\n\n\n## Daten\n\n\nFür Maschinenlernen brauchen wir Trainingsdaten,\nDaten also, bei denen wir pro Beobachtung der Wert der Zielvariablen kennen.\nMan spricht auch von \"gelabelten\" Daten.\n\nWir nutzen die Daten von @germeval bzw. @wiegand-data.\nDie Daten sind unter CC-By-4.0 Int. lizensiert.\n\n\n::: {.cell hash='080-klassifikation_cache/html/import-heidelberg-data_c85f26dba7e098dc46d51174dca00022'}\n\n```{.r .cell-code}\nd_raw <- \n  data_read(\"data/germeval2018.training.txt\",\n         header = FALSE,\n         quote = \"\")\n```\n:::\n\n\n\nDie Daten finden sich auch im Paket [pradadata](https://github.com/sebastiansauer/pradadata).\n\nDa die Daten keine Spaltenköpfe haben, informieren wir die Funktion dazu mit `header = FALSE`.\n\nBenennen wir die die Spalten um:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-2_a64ac4b0527a808a8e0f22218e4e7fc3'}\n\n```{.r .cell-code}\nnames(d_raw) <- c(\"text\", \"c1\", \"c2\")\n```\n:::\n\n\nDabei soll `c1` und `c2` für die 1. bzw. 2. Klassifikation stehen.\n\n\nIn `c1` finden sich diese Werte:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-3_31bc191f85f5f20e181ccbeb20f2d0bd'}\n\n```{.r .cell-code}\nd_raw %>% \n  count(c1)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"c1\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"OFFENSE\",\"2\":\"1688\"},{\"1\":\"OTHER\",\"2\":\"3321\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nMit `c1` wurde klassifiziert,\nob beleidigende Sprache (offensive language) vorlag oder nicht [@risch-etal-2021-overview, S. 2], also `OFFENSE` bzw. `OTHER`:\n\n\n\n>   Task 1 was to decide whether a tweet includes some form of offensive language or not. The tweets had to be classiﬁed into the two classes OFFENSE and OTHER. The OFFENSE category covered abusive language, insults, as well as merely profane statements.\n\n\nUnd in `c2` finden sich die vier Ausprägungen `ABUSE`, `INSULT`, `PROFANITY` und `OTHER`:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-4_438af12ffb58708ee70e9928d4f500b6'}\n\n```{.r .cell-code}\nd_raw %>% \n  count(c2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"c2\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"ABUSE\",\"2\":\"1022\"},{\"1\":\"INSULT\",\"2\":\"595\"},{\"1\":\"OTHER\",\"2\":\"3321\"},{\"1\":\"PROFANITY\",\"2\":\"71\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nIn `c2` ging es um eine *feinere Klassifikation* beleidigender Sprache [@risch-etal-2021-overview, S. 2]:\n\n>   The second task involved four categories, a nonoffensive OTHER class and three sub-categories of what is OFFENSE in Task 1. In the case of PROFANITY, profane words are used, however, the tweet does not want to insult anyone. This typically concerns the usage of swearwords (Scheiße, Fuck etc.) and cursing (Zur Hölle! Verdammt! etc.). This can be often found in youth language. Swearwords and cursing may, but need not, co-occur with insults or abusive speech. Profane language may in fact be used in tweets with positive sentiment to express emphasis. Whenever profane words are not directed towards a speciﬁc person or group of persons and there are no separate cues of INSULT or ABUSE, then tweets are labeled as simple cases of PROFANITY.\n\n\n\n\nSind Texte, die als `OFFENSE` klassifiziert sind,\nauch (fast) immer nie als `OTHER`, sondern stattdessen als `ABUSE`, `INSULT` oder `PROFANITY` klassifiziert?\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-5_71c8f273a6b38378e63c8873eeba0b51'}\n\n```{.r .cell-code}\nd_raw %>% \n  filter(c1 == \"OFFENSE\", c2 != \"OTHER\") %>% \n  nrow() / nrow(d_raw)\n## [1] 0.3369934\n```\n:::\n\n\n\nIn ca. 2/3 der Fälle wurden in beiden Klassifikation `OTHER` klassifiziert:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-6_d3ede3cee11020db7f76523e3dfefd9f'}\n\n```{.r .cell-code}\nd_raw %>% \n  filter(c1 == \"OTHER\", c2 == \"OTHER\") %>% \n  nrow() / nrow(d_raw)\n## [1] 0.6630066\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-7_9a2ef2e44b2d1e822de8b83df3243ffa'}\n\n```{.r .cell-code}\nd_raw %>% \n  filter(c1 != \"OTHER\", c2 != \"OTHER\") %>% \n  nrow() / nrow(d_raw)\n## [1] 0.3369934\n```\n:::\n\n\nEntsprechend in ca. 1/3 der Fälle wurde jeweils nicht mit `OTHER` klassifiziert.\n\n\nWir begnügen uns hier mit der ersten, gröberen Klassifikation.\n\n\n\nFügen wir abschließend noch eine ID-Variable hinzu:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-8_5ae7a41c3e0440f0018cf07521c2d048'}\n\n```{.r .cell-code}\nd1 <-\n  d_raw %>% \n  mutate(id = as.character(1:nrow(.)))\n```\n:::\n\n\n\nDie *ID-Variable* definieren als *Text* (nicht als Integer),\nda die Twitter-IDs zwar natürliche Zahlen sind,\naber zu groß, um von R als Integer verarbeitet zu werden.\nFaktisch sind sie für uns auch nur nominal skalierte Variablen,\nso dass wir keinen Informationsverlust haben.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-9_74c1d68bf8dedb6e25a7618577bff3af'}\n\n```{.r .cell-code}\n#write_rds(d1, \"objects/d1.rds\")\n```\n:::\n\n\n\n\n## Feature Engineering\n\n\nReichern wir die Daten mit weiteren Features an,\nin der Hoffnung, damit eine bessere Klassifikation erzielen zu können.\n\n\n### Textlänge\n\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/d2_db9c27a0ad5c74473ac6c7a007ff3494'}\n\n```{.r .cell-code}\nd2 <-\n  d1 %>% \n  mutate(text_length = str_length(text))\n\nhead(d2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"text\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"c1\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"c2\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"text_length\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"@corinnamilborn Liebe Corinna, wir würden dich gerne als Moderatorin für uns gewinnen! Wärst du begeisterbar?\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"1\",\"5\":\"109\",\"_rn_\":\"1\"},{\"1\":\"@Martin28a Sie haben ja auch Recht. Unser Tweet war etwas missverständlich. Dass das BVerfG Sachleistungen nicht ausschließt, kritisieren wir.\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"2\",\"5\":\"142\",\"_rn_\":\"2\"},{\"1\":\"@ahrens_theo fröhlicher gruß aus der schönsten stadt der welt theo ⚓️\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"3\",\"5\":\"69\",\"_rn_\":\"3\"},{\"1\":\"@dushanwegner Amis hätten alles und jeden gewählt...nur Hillary wollten sie nicht und eine Fortsetzung von Obama-Politik erst recht nicht..!\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"4\",\"5\":\"140\",\"_rn_\":\"4\"},{\"1\":\"@spdde kein verläßlicher Verhandlungspartner. Nachkarteln nach den Sondierzngsgesprächen - schickt diese Stümper #SPD in die Versenkung.\",\"2\":\"OFFENSE\",\"3\":\"INSULT\",\"4\":\"5\",\"5\":\"136\",\"_rn_\":\"5\"},{\"1\":\"@Dirki_M Ja, aber wo widersprechen die Zahlen denn denen, die im von uns verlinkten Artikel stehen? In unserem Tweet geht es rein um subs. Geschützte. 2017 ist der gesamte Familiennachzug im Vergleich zu 2016 - die Zahlen, die Hr. Brandner bemüht - übrigens leicht rückläufig gewesen.\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"6\",\"5\":\"284\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n### Sentimentanalyse\n\nWir nutzen dazu `SentiWS` [@Remus2010].\n\n\n::: {.cell hash='080-klassifikation_cache/html/read-sentiws_b9fe13794bc25dd9c3422c6d21358b8c'}\n\n```{.r .cell-code}\nsentiws <- read_csv(\"https://osf.io/x89wq/?action=download\")\n## Rows: 3468 Columns: 4\n## ── Column specification ────────────────────────────────────────────────────────\n## Delimiter: \",\"\n## chr (3): neg_pos, word, inflections\n## dbl (1): value\n## \n## ℹ Use `spec()` to retrieve the full column specification for this data.\n## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/d2-long_bddf8a4b599ec915c7724cd0f20d1644'}\n\n```{.r .cell-code}\nd2_long <-\n  d2 %>% \n  unnest_tokens(input = text, output = token)\n\nhead(d2_long)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"c1\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"c2\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"text_length\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"token\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"corinnamilborn\",\"_rn_\":\"1\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"liebe\",\"_rn_\":\"2\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"corinna\",\"_rn_\":\"3\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"wir\",\"_rn_\":\"4\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"würden\",\"_rn_\":\"5\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"dich\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nJetzt filtern wir unsere Textdaten so,\ndass nur Wörter mit Sentimentwert übrig bleiben:\n\n\n::: {.cell hash='080-klassifikation_cache/html/d2-senti-long_56e7c60f0cef60159d3d348ca7e52e1a'}\n\n```{.r .cell-code}\nd2_long_senti <- \n  d2_long %>%  \n  inner_join(sentiws %>% select(-inflections), by = c(\"token\" = \"word\"))\n## Warning in inner_join(., sentiws %>% select(-inflections), by = c(token = \"word\")): Detected an unexpected many-to-many relationship between `x` and `y`.\n## ℹ Row 1559 of `x` matches multiple rows in `y`.\n## ℹ Row 2572 of `y` matches multiple rows in `x`.\n## ℹ If a many-to-many relationship is expected, set `relationship =\n##   \"many-to-many\"` to silence this warning.\n\nhead(d2_long)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"c1\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"c2\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"text_length\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"token\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"corinnamilborn\",\"_rn_\":\"1\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"liebe\",\"_rn_\":\"2\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"corinna\",\"_rn_\":\"3\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"wir\",\"_rn_\":\"4\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"würden\",\"_rn_\":\"5\"},{\"1\":\"OTHER\",\"2\":\"OTHER\",\"3\":\"1\",\"4\":\"109\",\"5\":\"dich\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nSchließlich berechnen wir die Sentimentwert pro Polarität und pro Tweet:\n\n\n::: {.cell hash='080-klassifikation_cache/html/d2-sentis_86688616afb35798212a38cab5e36d66'}\n\n```{.r .cell-code}\nd2_sentis <-\n  d2_long_senti %>% \n  group_by(id, neg_pos) %>% \n  summarise(senti_avg = mean(value))\n## `summarise()` has grouped output by 'id'. You can override using the `.groups`\n## argument.\n\nhead(d2_sentis)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"neg_pos\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"senti_avg\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"pos\",\"3\":\"0.0040\"},{\"1\":\"1012\",\"2\":\"neg\",\"3\":\"-0.2087\"},{\"1\":\"1013\",\"2\":\"neg\",\"3\":\"-0.0420\"},{\"1\":\"1015\",\"2\":\"neg\",\"3\":\"-0.0048\"},{\"1\":\"1021\",\"2\":\"pos\",\"3\":\"0.0845\"},{\"1\":\"1024\",\"2\":\"neg\",\"3\":\"-0.4787\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nDiese Tabelle bringen wir wieder eine breitere Form,\num sie dann wieder mit den Hauptdaten zu vereinigen.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/d2-sentis-wide_7edfef0d01d48f9a1eeb61a668d19454'}\n\n```{.r .cell-code}\nd2_sentis_wide <-\n  d2_sentis %>% \n  pivot_wider(names_from = \"neg_pos\", values_from = \"senti_avg\")\n\nd2_sentis_wide %>% head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"pos\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"neg\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"0.0040\",\"3\":\"NA\"},{\"1\":\"1012\",\"2\":\"NA\",\"3\":\"-0.2087\"},{\"1\":\"1013\",\"2\":\"NA\",\"3\":\"-0.0420\"},{\"1\":\"1015\",\"2\":\"NA\",\"3\":\"-0.0048\"},{\"1\":\"1021\",\"2\":\"0.0845\",\"3\":\"NA\"},{\"1\":\"1024\",\"2\":\"0.0040\",\"3\":\"-0.4787\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/d3_bd0edc632d6fce6dd1ac1ad41406e659'}\n\n```{.r .cell-code}\nd3 <-\n  d2 %>% \n  full_join(d2_sentis_wide)\n## Joining with `by = join_by(id)`\n\nhead(d3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"text\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"c1\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"c2\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"id\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"text_length\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"pos\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"neg\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"@corinnamilborn Liebe Corinna, wir würden dich gerne als Moderatorin für uns gewinnen! Wärst du begeisterbar?\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"1\",\"5\":\"109\",\"6\":\"0.004\",\"7\":\"NA\",\"_rn_\":\"1\"},{\"1\":\"@Martin28a Sie haben ja auch Recht. Unser Tweet war etwas missverständlich. Dass das BVerfG Sachleistungen nicht ausschließt, kritisieren wir.\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"2\",\"5\":\"142\",\"6\":\"NA\",\"7\":\"-0.3466\",\"_rn_\":\"2\"},{\"1\":\"@ahrens_theo fröhlicher gruß aus der schönsten stadt der welt theo ⚓️\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"3\",\"5\":\"69\",\"6\":\"NA\",\"7\":\"NA\",\"_rn_\":\"3\"},{\"1\":\"@dushanwegner Amis hätten alles und jeden gewählt...nur Hillary wollten sie nicht und eine Fortsetzung von Obama-Politik erst recht nicht..!\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"4\",\"5\":\"140\",\"6\":\"NA\",\"7\":\"NA\",\"_rn_\":\"4\"},{\"1\":\"@spdde kein verläßlicher Verhandlungspartner. Nachkarteln nach den Sondierzngsgesprächen - schickt diese Stümper #SPD in die Versenkung.\",\"2\":\"OFFENSE\",\"3\":\"INSULT\",\"4\":\"5\",\"5\":\"136\",\"6\":\"NA\",\"7\":\"NA\",\"_rn_\":\"5\"},{\"1\":\"@Dirki_M Ja, aber wo widersprechen die Zahlen denn denen, die im von uns verlinkten Artikel stehen? In unserem Tweet geht es rein um subs. Geschützte. 2017 ist der gesamte Familiennachzug im Vergleich zu 2016 - die Zahlen, die Hr. Brandner bemüht - übrigens leicht rückläufig gewesen.\",\"2\":\"OTHER\",\"3\":\"OTHER\",\"4\":\"6\",\"5\":\"284\",\"6\":\"0.004\",\"7\":\"-0.2042\",\"_rn_\":\"6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n:::callout-note\nDie Sentimentanalyse hier vernachlässigt Flexionen der Wörter. \nDer  Autor fühlt den Drang zu schreiben: \"Left as an exercise for the reader\" :-)\n:::\n\n\n### Schimpfwörter\n\n\nZählen wir die Schimpfwörter pro Text.\nDazu nutzen wir die Daten von [LDNOOBW](https://github.com/LDNOOBW/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words/blob/master/LICENSE), lizensiert nach CC-BY-4.0-Int.\n\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/schimpf1_fad97c6eec7019694e963c2c91a9d9d8'}\n\n```{.r .cell-code}\nschimpf1 <- read_csv(\"https://raw.githubusercontent.com/LDNOOBW/List-of-Dirty-Naughty-Obscene-and-Otherwise-Bad-Words/master/de\", col_names = FALSE)\n## Rows: 66 Columns: 1\n## ── Column specification ────────────────────────────────────────────────────────\n## Delimiter: \",\"\n## chr (1): X1\n## \n## ℹ Use `spec()` to retrieve the full column specification for this data.\n## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n\n\nLänger aber noch ist die Liste aus dem [InsultWiki](https://www.insult.wiki/schimpfwort-liste), lizensiert CC0.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/schimpf2_88faef321e5a6498d957ebc0a41abf4a'}\n\n```{.r .cell-code}\nschimpf2 <- \n  data_read(\"data/insult-de.txt\", header = FALSE) %>% \n  mutate_all(str_to_lower)\n```\n:::\n\n\n\n\nDie Daten finden sich auch im Paket [pradadata](https://github.com/sebastiansauer/pradadata).\n\nBinden wir die Listen zusammen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/schimpf_3250f864833c93132f203242ae983855'}\n\n```{.r .cell-code}\nschimpf <-\n  schimpf1 %>% \n  bind_rows(schimpf2) %>% \n  distinct() %>% \n  rename(word = \"V1\")\n\nnrow(schimpf)\n## [1] 6235\n```\n:::\n\n\n\nUm die Lesis vor (unnötiger?) Kopfverschmutzung zu bewahren,\nsind diese Schimpfwörter hier nicht abgedruckt.\n\nJetzt zählen wir, ob unsere Tweets/Texte solcherlei Wörter enthalten.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/d_schimpf_692ded66bfa2218e8d3883a6661d7814'}\n\n```{.r .cell-code}\nd_schimpf <- \nd2_long %>% \n  select(id, token) %>% \n  mutate(schimpf = token %in% schimpf$word)\n```\n:::\n\n\n\nWie viele Schimpfwörter haben wir gefunden?\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-10_39628a78198c9782b5b96f1ea163eca8'}\n\n```{.r .cell-code}\nd_schimpf %>% \n  count(schimpf)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"schimpf\"],\"name\":[1],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"FALSE\",\"2\":\"99105\"},{\"1\":\"TRUE\",\"2\":\"1112\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nEtwa ein Prozent der Wörter (ca. 1k) sind Schimpfwörter in unserem Corpus.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/d-schimpf2_6cf7d90214657242627e117c002442c5'}\n\n```{.r .cell-code}\nd_schimpf2 <-\n  d_schimpf %>% \n  group_by(id) %>% \n  summarise(schimpf_n = sum(schimpf))\n\nhead(d_schimpf2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"schimpf_n\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1\",\"2\":\"0\"},{\"1\":\"10\",\"2\":\"0\"},{\"1\":\"100\",\"2\":\"0\"},{\"1\":\"1000\",\"2\":\"0\"},{\"1\":\"1001\",\"2\":\"0\"},{\"1\":\"1002\",\"2\":\"0\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/d_main_61becc850aa91ceed5f4666366af940e'}\n\n```{.r .cell-code}\nd_main <-\n  d3 %>% \n  full_join(d_schimpf2)\n## Joining with `by = join_by(id)`\n```\n:::\n\n\n\n:::callout-important\nNamen wie `final`, `main` oder `result` sind gefährlich,\nda es unter Garantie ein \"final-final geben wird, oder der \"Haupt-Datensatz\" plötzlich nicht mehr so wichtig erscheint und so weiter.\n:::\n\n\n\n### Emojis\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/get-emoji-list_8050d957349570d1706df4e7c66cf534'}\n\n```{.r .cell-code}\nemj <- emoji(list_emoji(), pad = FALSE)\n\nhead(emj)\n## [1] \"😄\" \"😃\" \"😀\" \"😊\" \"☺️\"  \"😉\"\n```\n:::\n\n\nDiese Liste umfasst knapp 900 Emojis, \ndas sind allerdings noch nicht alle, die es gibt.\n[Diese Liste](https://unicode.org/emoji/charts/full-emoji-list.html) umfasst mit gut 1800 Emojis\ngut das Doppelte.\n\n\nSelbstkuratierte Liste an \"wilden\" Emoji;\ndiese Liste ist inspiriert von [emojicombos.com](https://emojicombos.com/disgust).\n\n\n::: {.cell hash='080-klassifikation_cache/html/wild-emojis_4e5415c3e3bae818b2dcfffd2af0780a'}\n\n```{.r .cell-code}\nwild_emojis <- \n  c(\n    emoji(find_emoji(\"gun\")),\n    emoji(find_emoji(\"bomb\")),\n    emoji(find_emoji(\"fist\")),\n    emoji(find_emoji(\"knife\"))[1],\n    emoji(find_emoji(\"ambulance\")),\n    emoji(find_emoji(\"fist\")),\n    emoji(find_emoji(\"skull\")),\n    \"☠️\",     \"🗑\",       \"😠\",    \"👹\",    \"💩\" ,\n    \"🖕\",    \"👎️\",\n    emoji(find_emoji(\"middle finger\")),    \"😡\",    \"🤢\",    \"🤮\",  \n    \"😖\",    \"😣\",    \"😩\",    \"😨\",    \"😝\",    \"😳\",    \"😬\",    \"😱\",    \"😵\",\n       \"😤\",    \"🤦‍♀️\",    \"🤦‍\"\n  )\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-11_c699129085453a1e94f2a980a68f5e3e'}\n\n```{.r .cell-code}\nwild_emojis_df <-\n  tibble(emoji = wild_emojis)\n\n#save(wild_emojis_df, file = \"data/wild_emojis.RData\")\n```\n:::\n\n\n\n\nAuf dieser Basis können wir einen Prädiktor erstellen,\nder zählt, ob ein Tweet einen oder mehrere der \"wilden\" Emojis enthält.\n\n\n## Workflow 1: Rezept 1 + Naive-Bayes\n\n\n### Dummy-Rezept\n\n\nHier ist ein einfaches Beispiel,\num die Textvorbereitung mit `{textrecipes}` zu verdeutlichen.\n\nWir erstellen uns einen Dummy-Text:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-12_e175bad5f1b6e60ba6db923b9a12465e'}\n\n```{.r .cell-code}\ndummy <- \n  tibble(text = c(\"Ich gehe heim und der die das nicht in ein and the\"))\n```\n:::\n\n\n\nDann tokenisieren wir den Text:\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec-dummy1_29a9c6aeb81e623a9525b6bac919dfc6'}\n\n```{.r .cell-code}\nrec_dummy <-\n  recipe(text ~ 1, data = dummy) %>% \n  step_tokenize(text)\n  \nrec_dummy\n## \n## ── Recipe ──────────────────────────────────────────────────────────────────────\n## \n## ── Inputs\n## Number of variables by role\n## outcome: 1\n## \n## ── Operations\n## • Tokenization for: text\n```\n:::\n\n\n\nDie Tokens kann man sich so zeigen lassen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-13_024e0df072b7264b608c10e85f326583'}\n\n```{.r .cell-code}\nshow_tokens(rec_dummy, text)\n## [[1]]\n## [1] \"gehe\" \"heim\" \"and\"  \"the\"\n```\n:::\n\n\n\nJetzt entfernen wir die Stopwörter deutscher Sprache;\ndafür nutzen wir die Stopwort-Quelle `snowball`:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec-dummy2_2b5595cee839d8ace1b9def66c8e2403'}\n\n```{.r .cell-code}\nrec_dummy <-\n  recipe(text ~ 1, data = dummy) %>% \n  step_tokenize(text) %>% \n  step_stopwords(text, language = \"de\", stopword_source = \"snowball\")\n\nrec_dummy\n## \n## ── Recipe ──────────────────────────────────────────────────────────────────────\n## \n## ── Inputs\n## Number of variables by role\n## outcome: 1\n## \n## ── Operations\n## • Tokenization for: text\n## • Stop word removal for: text\n```\n:::\n\n\n\nPrüfen wir die Tokens; \nsind die Stopwörter wirklich entfernt?\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-14_88fa06017bf42fab33a9c3b6c9638cbb'}\n\n```{.r .cell-code}\nshow_tokens(rec_dummy, text)\n## [[1]]\n## [1] \"gehe\" \"heim\" \"and\"  \"the\"\n```\n:::\n\n\n\nJa, die deutschen Stopwörter sind entfernt. Die englischen nicht;\ndas macht Sinn!\n\n\n### Datenaufteilung\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/d-split2_1aa1ea70c66996045009beb0b6802601'}\n\n```{.r .cell-code}\nd_split <- initial_split(d_main, strata = c1)\n\nd_train <- training(d_split)\nd_test <- testing(d_split)\n```\n:::\n\n\n\n\n\n\n### Rezept 1\n\n\nRezept definieren:\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec1_8414e16f43c623abe9fd3b2427ffbe16'}\n\n```{.r .cell-code}\nrec1 <- \n  recipe(c1 ~ ., data = select(d_train, text, c1, id)) %>% \n  update_role(id, new_role = \"id\") %>% \n  step_tokenize(text) %>% \n  step_stopwords(text, language = \"de\", stopword_source = \"snowball\") %>% \n  step_stem(text) %>% \n  step_tokenfilter(text, max_tokens = 1e2) %>%  # wir behalten nur die häufigsten Tokens\n  step_tfidf(text) %>%  \n  step_normalize(all_numeric_predictors())\n\nrec1\n## \n## ── Recipe ──────────────────────────────────────────────────────────────────────\n## \n## ── Inputs\n## Number of variables by role\n## outcome:   1\n## predictor: 1\n## id:        1\n## \n## ── Operations\n## • Tokenization for: text\n## • Stop word removal for: text\n## • Stemming for: text\n## • Text filtering for: text\n## • Term frequency-inverse document frequency with: text\n## • Centering and scaling for: all_numeric_predictors()\n```\n:::\n\n\n\nPreppen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec1-prepped_c91ab13ed942d2d77afd23d9cdab80d3'}\n\n```{.r .cell-code}\nrec1_prepped <- prep(rec1)\n```\n:::\n\n\nUnd backen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec1-baked_a2965b7425f70edb8b41b68d92d9a880'}\n\n```{.r .cell-code}\nd_rec1 <- bake(rec1_prepped, new_data = NULL)\n\nhead(d_rec1)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"c1\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"tfidf_text__macmik\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_2\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_ab\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_afd\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_amp\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_anna_iina\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_antisemitismu\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_athinamala\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_beim\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_besser\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_bild\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_cdu\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_charlie_silv\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_csu\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_d\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_dafür\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_dank\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_dass\"],\"name\":[20],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_deutsch\"],\"name\":[21],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_deutschen\"],\"name\":[22],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_deutschland\"],\"name\":[23],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_dumm\"],\"name\":[24],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_eigentlich\"],\"name\":[25],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_einfach\"],\"name\":[26],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_ellibisathid\"],\"name\":[27],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_ennof_\"],\"name\":[28],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_erst\"],\"name\":[29],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_eu\"],\"name\":[30],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_europa\"],\"name\":[31],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_fdp\"],\"name\":[32],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_feldenfrizz\"],\"name\":[33],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_frage\"],\"name\":[34],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_frau\"],\"name\":[35],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_ganz\"],\"name\":[36],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_geht\"],\"name\":[37],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_gerad\"],\"name\":[38],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_gibt\"],\"name\":[39],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_grünen\"],\"name\":[40],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_gt\"],\"name\":[41],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_gut\"],\"name\":[42],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_heut\"],\"name\":[43],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_immer\"],\"name\":[44],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_info2099\"],\"name\":[45],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_islam\"],\"name\":[46],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_israel\"],\"name\":[47],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_ja\"],\"name\":[48],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_jahr\"],\"name\":[49],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_juden\"],\"name\":[50],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_kommt\"],\"name\":[51],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_krippmari\"],\"name\":[52],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_land\"],\"name\":[53],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_lassen\"],\"name\":[54],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_lbr\"],\"name\":[55],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_leben\"],\"name\":[56],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_leut\"],\"name\":[57],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_lifetrend\"],\"name\":[58],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_link\"],\"name\":[59],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_macht\"],\"name\":[60],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_machtjanix23\"],\"name\":[61],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_mal\"],\"name\":[62],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_md_franz\"],\"name\":[63],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_medien\"],\"name\":[64],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_mehr\"],\"name\":[65],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_menschen\"],\"name\":[66],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_merkel\"],\"name\":[67],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_miriamozen\"],\"name\":[68],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_müssen\"],\"name\":[69],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_nancypeggymandi\"],\"name\":[70],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_nasanas\"],\"name\":[71],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_neue\"],\"name\":[72],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_nie\"],\"name\":[73],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_noherrman\"],\"name\":[74],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_norbinator2403\"],\"name\":[75],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_petpanther0\"],\"name\":[76],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_politik\"],\"name\":[77],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_recht\"],\"name\":[78],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_richtig\"],\"name\":[79],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_schmiddiemaik\"],\"name\":[80],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_schon\"],\"name\":[81],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_schulz\"],\"name\":[82],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_seit\"],\"name\":[83],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_sollten\"],\"name\":[84],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_spd\"],\"name\":[85],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_thomasgbau\"],\"name\":[86],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_troll_putin\"],\"name\":[87],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_trump\"],\"name\":[88],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_tun\"],\"name\":[89],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_türken\"],\"name\":[90],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_u\"],\"name\":[91],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_unser\"],\"name\":[92],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_viel\"],\"name\":[93],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_volk\"],\"name\":[94],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_wäre\"],\"name\":[95],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_warum\"],\"name\":[96],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_welt\"],\"name\":[97],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_wer\"],\"name\":[98],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_willjrosenblatt\"],\"name\":[99],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_wohl\"],\"name\":[100],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_wurd\"],\"name\":[101],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"tfidf_text_zeit\"],\"name\":[102],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"5\",\"2\":\"OFFENSE\",\"3\":\"-0.1346011\",\"4\":\"-0.1003752\",\"5\":\"-0.09792459\",\"6\":\"-0.1660907\",\"7\":\"-0.1204636\",\"8\":\"-0.1028449\",\"9\":\"-0.08021671\",\"10\":\"-0.1346011\",\"11\":\"-0.09440746\",\"12\":\"-0.1000035\",\"13\":\"-0.09482191\",\"14\":\"-0.1042422\",\"15\":\"-0.14549\",\"16\":\"-0.08923074\",\"17\":\"-0.1419055\",\"18\":\"-0.08986937\",\"19\":\"-0.120494\",\"20\":\"-0.1875993\",\"21\":\"-0.1585185\",\"22\":\"-0.1505451\",\"23\":\"-0.1968493\",\"24\":\"-0.1036064\",\"25\":\"-0.09318605\",\"26\":\"-0.1185338\",\"27\":\"-0.1078257\",\"28\":\"-0.1205031\",\"29\":\"-0.1154219\",\"30\":\"-0.1104403\",\"31\":\"-0.1075715\",\"32\":\"-0.09207358\",\"33\":\"-0.1473002\",\"34\":\"-0.09215035\",\"35\":\"-0.08923117\",\"36\":\"-0.1097063\",\"37\":\"-0.1456569\",\"38\":\"-0.110838\",\"39\":\"-0.1620773\",\"40\":\"-0.1115926\",\"41\":\"-0.08879427\",\"42\":\"-0.1233819\",\"43\":\"-0.1692998\",\"44\":\"-0.1667488\",\"45\":\"-0.07875031\",\"46\":\"-0.1035873\",\"47\":\"-0.08671145\",\"48\":\"-0.1718921\",\"49\":\"-0.1046301\",\"50\":\"-0.09580855\",\"51\":\"-0.1048049\",\"52\":\"-0.135184\",\"53\":\"-0.1450162\",\"54\":\"-0.1023692\",\"55\":\"-0.4085687\",\"56\":\"-0.08556558\",\"57\":\"-0.08592457\",\"58\":\"-0.1443829\",\"59\":\"-0.09777515\",\"60\":\"-0.1212058\",\"61\":\"-0.1098629\",\"62\":\"-0.1767845\",\"63\":\"-0.1144559\",\"64\":\"-0.09195891\",\"65\":\"-0.186299\",\"66\":\"-0.1253732\",\"67\":\"-0.228626\",\"68\":\"-0.09929523\",\"69\":\"-0.129862\",\"70\":\"-0.1181466\",\"71\":\"-0.1047581\",\"72\":\"-0.08988478\",\"73\":\"-0.09395036\",\"74\":\"-0.1237278\",\"75\":\"-0.06282837\",\"76\":\"-0.0790019\",\"77\":\"-0.1457582\",\"78\":\"-0.1185633\",\"79\":\"-0.1018952\",\"80\":\"-0.1425605\",\"81\":\"-0.1985576\",\"82\":\"-0.1043453\",\"83\":\"-0.1197637\",\"84\":\"-0.09746385\",\"85\":\"13.522620\",\"86\":\"-0.1473632\",\"87\":\"-0.1215411\",\"88\":\"-0.1059998\",\"89\":\"-0.1032855\",\"90\":\"-0.103325\",\"91\":\"-0.1531764\",\"92\":\"-0.1543363\",\"93\":\"-0.09549797\",\"94\":\"-0.1051413\",\"95\":\"-0.1105591\",\"96\":\"-0.1036588\",\"97\":\"-0.1510228\",\"98\":\"-0.1573557\",\"99\":\"-0.1425605\",\"100\":\"-0.1015713\",\"101\":\"-0.1113423\",\"102\":\"-0.106895\"},{\"1\":\"7\",\"2\":\"OFFENSE\",\"3\":\"-0.1346011\",\"4\":\"-0.1003752\",\"5\":\"-0.09792459\",\"6\":\"-0.1660907\",\"7\":\"-0.1204636\",\"8\":\"-0.1028449\",\"9\":\"-0.08021671\",\"10\":\"-0.1346011\",\"11\":\"-0.09440746\",\"12\":\"-0.1000035\",\"13\":\"-0.09482191\",\"14\":\"-0.1042422\",\"15\":\"-0.14549\",\"16\":\"-0.08923074\",\"17\":\"-0.1419055\",\"18\":\"-0.08986937\",\"19\":\"-0.120494\",\"20\":\"-0.1875993\",\"21\":\"-0.1585185\",\"22\":\"-0.1505451\",\"23\":\"-0.1968493\",\"24\":\"-0.1036064\",\"25\":\"-0.09318605\",\"26\":\"-0.1185338\",\"27\":\"-0.1078257\",\"28\":\"-0.1205031\",\"29\":\"-0.1154219\",\"30\":\"-0.1104403\",\"31\":\"-0.1075715\",\"32\":\"-0.09207358\",\"33\":\"-0.1473002\",\"34\":\"-0.09215035\",\"35\":\"-0.08923117\",\"36\":\"-0.1097063\",\"37\":\"3.9633963\",\"38\":\"-0.110838\",\"39\":\"-0.1620773\",\"40\":\"-0.1115926\",\"41\":\"-0.08879427\",\"42\":\"-0.1233819\",\"43\":\"2.9362282\",\"44\":\"-0.1667488\",\"45\":\"-0.07875031\",\"46\":\"-0.1035873\",\"47\":\"-0.08671145\",\"48\":\"-0.1718921\",\"49\":\"-0.1046301\",\"50\":\"-0.09580855\",\"51\":\"-0.1048049\",\"52\":\"-0.135184\",\"53\":\"-0.1450162\",\"54\":\"-0.1023692\",\"55\":\"-0.4085687\",\"56\":\"-0.08556558\",\"57\":\"-0.08592457\",\"58\":\"-0.1443829\",\"59\":\"-0.09777515\",\"60\":\"-0.1212058\",\"61\":\"-0.1098629\",\"62\":\"-0.1767845\",\"63\":\"-0.1144559\",\"64\":\"-0.09195891\",\"65\":\"-0.186299\",\"66\":\"-0.1253732\",\"67\":\"-0.228626\",\"68\":\"-0.09929523\",\"69\":\"-0.129862\",\"70\":\"-0.1181466\",\"71\":\"-0.1047581\",\"72\":\"-0.08988478\",\"73\":\"-0.09395036\",\"74\":\"-0.1237278\",\"75\":\"-0.06282837\",\"76\":\"-0.0790019\",\"77\":\"-0.1457582\",\"78\":\"-0.1185633\",\"79\":\"-0.1018952\",\"80\":\"-0.1425605\",\"81\":\"-0.1985576\",\"82\":\"-0.1043453\",\"83\":\"-0.1197637\",\"84\":\"-0.09746385\",\"85\":\"-0.136156\",\"86\":\"-0.1473632\",\"87\":\"-0.1215411\",\"88\":\"-0.1059998\",\"89\":\"-0.1032855\",\"90\":\"-0.103325\",\"91\":\"-0.1531764\",\"92\":\"-0.1543363\",\"93\":\"-0.09549797\",\"94\":\"-0.1051413\",\"95\":\"-0.1105591\",\"96\":\"-0.1036588\",\"97\":\"-0.1510228\",\"98\":\"-0.1573557\",\"99\":\"-0.1425605\",\"100\":\"-0.1015713\",\"101\":\"-0.1113423\",\"102\":\"5.972986\"},{\"1\":\"9\",\"2\":\"OFFENSE\",\"3\":\"-0.1346011\",\"4\":\"-0.1003752\",\"5\":\"-0.09792459\",\"6\":\"12.5017538\",\"7\":\"-0.1204636\",\"8\":\"-0.1028449\",\"9\":\"-0.08021671\",\"10\":\"-0.1346011\",\"11\":\"-0.09440746\",\"12\":\"-0.1000035\",\"13\":\"-0.09482191\",\"14\":\"-0.1042422\",\"15\":\"-0.14549\",\"16\":\"-0.08923074\",\"17\":\"-0.1419055\",\"18\":\"-0.08986937\",\"19\":\"-0.120494\",\"20\":\"-0.1875993\",\"21\":\"-0.1585185\",\"22\":\"-0.1505451\",\"23\":\"-0.1968493\",\"24\":\"-0.1036064\",\"25\":\"-0.09318605\",\"26\":\"-0.1185338\",\"27\":\"-0.1078257\",\"28\":\"-0.1205031\",\"29\":\"-0.1154219\",\"30\":\"-0.1104403\",\"31\":\"-0.1075715\",\"32\":\"-0.09207358\",\"33\":\"-0.1473002\",\"34\":\"-0.09215035\",\"35\":\"-0.08923117\",\"36\":\"-0.1097063\",\"37\":\"-0.1456569\",\"38\":\"-0.110838\",\"39\":\"-0.1620773\",\"40\":\"-0.1115926\",\"41\":\"-0.08879427\",\"42\":\"-0.1233819\",\"43\":\"-0.1692998\",\"44\":\"-0.1667488\",\"45\":\"-0.07875031\",\"46\":\"-0.1035873\",\"47\":\"-0.08671145\",\"48\":\"-0.1718921\",\"49\":\"-0.1046301\",\"50\":\"-0.09580855\",\"51\":\"-0.1048049\",\"52\":\"-0.135184\",\"53\":\"-0.1450162\",\"54\":\"-0.1023692\",\"55\":\"-0.4085687\",\"56\":\"-0.08556558\",\"57\":\"-0.08592457\",\"58\":\"-0.1443829\",\"59\":\"-0.09777515\",\"60\":\"-0.1212058\",\"61\":\"-0.1098629\",\"62\":\"-0.1767845\",\"63\":\"-0.1144559\",\"64\":\"-0.09195891\",\"65\":\"-0.186299\",\"66\":\"-0.1253732\",\"67\":\"-0.228626\",\"68\":\"-0.09929523\",\"69\":\"-0.129862\",\"70\":\"-0.1181466\",\"71\":\"-0.1047581\",\"72\":\"-0.08988478\",\"73\":\"-0.09395036\",\"74\":\"-0.1237278\",\"75\":\"-0.06282837\",\"76\":\"-0.0790019\",\"77\":\"-0.1457582\",\"78\":\"-0.1185633\",\"79\":\"-0.1018952\",\"80\":\"-0.1425605\",\"81\":\"-0.1985576\",\"82\":\"-0.1043453\",\"83\":\"-0.1197637\",\"84\":\"-0.09746385\",\"85\":\"-0.136156\",\"86\":\"-0.1473632\",\"87\":\"-0.1215411\",\"88\":\"-0.1059998\",\"89\":\"-0.1032855\",\"90\":\"-0.103325\",\"91\":\"-0.1531764\",\"92\":\"-0.1543363\",\"93\":\"-0.09549797\",\"94\":\"-0.1051413\",\"95\":\"-0.1105591\",\"96\":\"-0.1036588\",\"97\":\"-0.1510228\",\"98\":\"-0.1573557\",\"99\":\"-0.1425605\",\"100\":\"-0.1015713\",\"101\":\"-0.1113423\",\"102\":\"-0.106895\"},{\"1\":\"10\",\"2\":\"OFFENSE\",\"3\":\"-0.1346011\",\"4\":\"-0.1003752\",\"5\":\"-0.09792459\",\"6\":\"-0.1660907\",\"7\":\"-0.1204636\",\"8\":\"-0.1028449\",\"9\":\"-0.08021671\",\"10\":\"-0.1346011\",\"11\":\"-0.09440746\",\"12\":\"-0.1000035\",\"13\":\"-0.09482191\",\"14\":\"-0.1042422\",\"15\":\"-0.14549\",\"16\":\"-0.08923074\",\"17\":\"-0.1419055\",\"18\":\"-0.08986937\",\"19\":\"-0.120494\",\"20\":\"-0.1875993\",\"21\":\"5.4267502\",\"22\":\"-0.1505451\",\"23\":\"-0.1968493\",\"24\":\"-0.1036064\",\"25\":\"-0.09318605\",\"26\":\"-0.1185338\",\"27\":\"-0.1078257\",\"28\":\"-0.1205031\",\"29\":\"-0.1154219\",\"30\":\"-0.1104403\",\"31\":\"-0.1075715\",\"32\":\"-0.09207358\",\"33\":\"-0.1473002\",\"34\":\"-0.09215035\",\"35\":\"-0.08923117\",\"36\":\"-0.1097063\",\"37\":\"-0.1456569\",\"38\":\"-0.110838\",\"39\":\"-0.1620773\",\"40\":\"-0.1115926\",\"41\":\"-0.08879427\",\"42\":\"-0.1233819\",\"43\":\"-0.1692998\",\"44\":\"-0.1667488\",\"45\":\"-0.07875031\",\"46\":\"-0.1035873\",\"47\":\"-0.08671145\",\"48\":\"-0.1718921\",\"49\":\"-0.1046301\",\"50\":\"-0.09580855\",\"51\":\"-0.1048049\",\"52\":\"-0.135184\",\"53\":\"-0.1450162\",\"54\":\"-0.1023692\",\"55\":\"-0.4085687\",\"56\":\"-0.08556558\",\"57\":\"-0.08592457\",\"58\":\"-0.1443829\",\"59\":\"-0.09777515\",\"60\":\"-0.1212058\",\"61\":\"-0.1098629\",\"62\":\"-0.1767845\",\"63\":\"-0.1144559\",\"64\":\"10.81369600\",\"65\":\"-0.186299\",\"66\":\"-0.1253732\",\"67\":\"-0.228626\",\"68\":\"-0.09929523\",\"69\":\"-0.129862\",\"70\":\"-0.1181466\",\"71\":\"-0.1047581\",\"72\":\"-0.08988478\",\"73\":\"-0.09395036\",\"74\":\"-0.1237278\",\"75\":\"-0.06282837\",\"76\":\"-0.0790019\",\"77\":\"-0.1457582\",\"78\":\"-0.1185633\",\"79\":\"-0.1018952\",\"80\":\"-0.1425605\",\"81\":\"-0.1985576\",\"82\":\"-0.1043453\",\"83\":\"-0.1197637\",\"84\":\"-0.09746385\",\"85\":\"-0.136156\",\"86\":\"-0.1473632\",\"87\":\"-0.1215411\",\"88\":\"-0.1059998\",\"89\":\"-0.1032855\",\"90\":\"-0.103325\",\"91\":\"-0.1531764\",\"92\":\"-0.1543363\",\"93\":\"-0.09549797\",\"94\":\"-0.1051413\",\"95\":\"-0.1105591\",\"96\":\"-0.1036588\",\"97\":\"-0.1510228\",\"98\":\"-0.1573557\",\"99\":\"-0.1425605\",\"100\":\"-0.1015713\",\"101\":\"-0.1113423\",\"102\":\"-0.106895\"},{\"1\":\"12\",\"2\":\"OFFENSE\",\"3\":\"-0.1346011\",\"4\":\"-0.1003752\",\"5\":\"-0.09792459\",\"6\":\"-0.1660907\",\"7\":\"-0.1204636\",\"8\":\"-0.1028449\",\"9\":\"-0.08021671\",\"10\":\"-0.1346011\",\"11\":\"-0.09440746\",\"12\":\"-0.1000035\",\"13\":\"-0.09482191\",\"14\":\"-0.1042422\",\"15\":\"-0.14549\",\"16\":\"-0.08923074\",\"17\":\"-0.1419055\",\"18\":\"-0.08986937\",\"19\":\"-0.120494\",\"20\":\"-0.1875993\",\"21\":\"-0.1585185\",\"22\":\"-0.1505451\",\"23\":\"-0.1968493\",\"24\":\"-0.1036064\",\"25\":\"-0.09318605\",\"26\":\"-0.1185338\",\"27\":\"-0.1078257\",\"28\":\"-0.1205031\",\"29\":\"-0.1154219\",\"30\":\"-0.1104403\",\"31\":\"-0.1075715\",\"32\":\"-0.09207358\",\"33\":\"-0.1473002\",\"34\":\"-0.09215035\",\"35\":\"-0.08923117\",\"36\":\"-0.1097063\",\"37\":\"-0.1456569\",\"38\":\"-0.110838\",\"39\":\"-0.1620773\",\"40\":\"-0.1115926\",\"41\":\"-0.08879427\",\"42\":\"-0.1233819\",\"43\":\"-0.1692998\",\"44\":\"3.4277858\",\"45\":\"-0.07875031\",\"46\":\"-0.1035873\",\"47\":\"-0.08671145\",\"48\":\"3.4064844\",\"49\":\"-0.1046301\",\"50\":\"-0.09580855\",\"51\":\"-0.1048049\",\"52\":\"-0.135184\",\"53\":\"-0.1450162\",\"54\":\"-0.1023692\",\"55\":\"1.2153760\",\"56\":\"-0.08556558\",\"57\":\"-0.08592457\",\"58\":\"-0.1443829\",\"59\":\"-0.09777515\",\"60\":\"-0.1212058\",\"61\":\"-0.1098629\",\"62\":\"-0.1767845\",\"63\":\"-0.1144559\",\"64\":\"-0.09195891\",\"65\":\"-0.186299\",\"66\":\"-0.1253732\",\"67\":\"-0.228626\",\"68\":\"-0.09929523\",\"69\":\"-0.129862\",\"70\":\"-0.1181466\",\"71\":\"-0.1047581\",\"72\":\"-0.08988478\",\"73\":\"-0.09395036\",\"74\":\"-0.1237278\",\"75\":\"-0.06282837\",\"76\":\"-0.0790019\",\"77\":\"-0.1457582\",\"78\":\"-0.1185633\",\"79\":\"-0.1018952\",\"80\":\"-0.1425605\",\"81\":\"-0.1985576\",\"82\":\"-0.1043453\",\"83\":\"-0.1197637\",\"84\":\"-0.09746385\",\"85\":\"-0.136156\",\"86\":\"-0.1473632\",\"87\":\"-0.1215411\",\"88\":\"-0.1059998\",\"89\":\"-0.1032855\",\"90\":\"-0.103325\",\"91\":\"-0.1531764\",\"92\":\"-0.1543363\",\"93\":\"-0.09549797\",\"94\":\"-0.1051413\",\"95\":\"-0.1105591\",\"96\":\"-0.1036588\",\"97\":\"-0.1510228\",\"98\":\"-0.1573557\",\"99\":\"-0.1425605\",\"100\":\"-0.1015713\",\"101\":\"-0.1113423\",\"102\":\"-0.106895\"},{\"1\":\"27\",\"2\":\"OFFENSE\",\"3\":\"-0.1346011\",\"4\":\"-0.1003752\",\"5\":\"-0.09792459\",\"6\":\"-0.1660907\",\"7\":\"-0.1204636\",\"8\":\"-0.1028449\",\"9\":\"-0.08021671\",\"10\":\"-0.1346011\",\"11\":\"-0.09440746\",\"12\":\"-0.1000035\",\"13\":\"-0.09482191\",\"14\":\"-0.1042422\",\"15\":\"-0.14549\",\"16\":\"-0.08923074\",\"17\":\"-0.1419055\",\"18\":\"-0.08986937\",\"19\":\"-0.120494\",\"20\":\"-0.1875993\",\"21\":\"-0.1585185\",\"22\":\"-0.1505451\",\"23\":\"-0.1968493\",\"24\":\"-0.1036064\",\"25\":\"-0.09318605\",\"26\":\"-0.1185338\",\"27\":\"-0.1078257\",\"28\":\"-0.1205031\",\"29\":\"-0.1154219\",\"30\":\"-0.1104403\",\"31\":\"-0.1075715\",\"32\":\"-0.09207358\",\"33\":\"-0.1473002\",\"34\":\"-0.09215035\",\"35\":\"-0.08923117\",\"36\":\"-0.1097063\",\"37\":\"-0.1456569\",\"38\":\"-0.110838\",\"39\":\"-0.1620773\",\"40\":\"-0.1115926\",\"41\":\"-0.08879427\",\"42\":\"-0.1233819\",\"43\":\"-0.1692998\",\"44\":\"-0.1667488\",\"45\":\"-0.07875031\",\"46\":\"-0.1035873\",\"47\":\"-0.08671145\",\"48\":\"-0.1718921\",\"49\":\"-0.1046301\",\"50\":\"-0.09580855\",\"51\":\"-0.1048049\",\"52\":\"6.553714\",\"53\":\"-0.1450162\",\"54\":\"-0.1023692\",\"55\":\"-0.4085687\",\"56\":\"-0.08556558\",\"57\":\"-0.08592457\",\"58\":\"-0.1443829\",\"59\":\"-0.09777515\",\"60\":\"-0.1212058\",\"61\":\"-0.1098629\",\"62\":\"-0.1767845\",\"63\":\"-0.1144559\",\"64\":\"-0.09195891\",\"65\":\"-0.186299\",\"66\":\"-0.1253732\",\"67\":\"-0.228626\",\"68\":\"-0.09929523\",\"69\":\"-0.129862\",\"70\":\"-0.1181466\",\"71\":\"-0.1047581\",\"72\":\"-0.08988478\",\"73\":\"-0.09395036\",\"74\":\"-0.1237278\",\"75\":\"-0.06282837\",\"76\":\"-0.0790019\",\"77\":\"-0.1457582\",\"78\":\"-0.1185633\",\"79\":\"-0.1018952\",\"80\":\"-0.1425605\",\"81\":\"-0.1985576\",\"82\":\"-0.1043453\",\"83\":\"-0.1197637\",\"84\":\"9.83670735\",\"85\":\"-0.136156\",\"86\":\"-0.1473632\",\"87\":\"-0.1215411\",\"88\":\"-0.1059998\",\"89\":\"-0.1032855\",\"90\":\"-0.103325\",\"91\":\"-0.1531764\",\"92\":\"-0.1543363\",\"93\":\"-0.09549797\",\"94\":\"-0.1051413\",\"95\":\"-0.1105591\",\"96\":\"-0.1036588\",\"97\":\"-0.1510228\",\"98\":\"-0.1573557\",\"99\":\"-0.1425605\",\"100\":\"-0.1015713\",\"101\":\"-0.1113423\",\"102\":\"-0.106895\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n### Modellspezifikation 1\n\nWir definiere einen Naive-Bayes-Algorithmus:\n\n\n::: {.cell hash='080-klassifikation_cache/html/nb-spec_6b3656164cef42028c24a6b20dc3d602'}\n\n```{.r .cell-code}\nnb_spec <- naive_Bayes() %>%\n  set_mode(\"classification\") %>%\n  set_engine(\"naivebayes\")\n\nnb_spec\n## Naive Bayes Model Specification (classification)\n## \n## Computational engine: naivebayes\n```\n:::\n\n\n\n\nUnd setzen auf die klassische zehnfache Kreuzvalidierung.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/folds1_988fcd99f3170d6256b0549800a03224'}\n\n```{.r .cell-code}\nset.seed(42)\nfolds1 <- vfold_cv(d_train)\n```\n:::\n\n\n\n\n### Workflow 1\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/wf1_566dee9642ee128443f7b6b0720fd9d9'}\n\n```{.r .cell-code}\nwf1 <-\n  workflow() %>% \n  add_recipe(rec1) %>% \n  add_model(nb_spec)\n\nwf1\n## ══ Workflow ════════════════════════════════════════════════════════════════════\n## Preprocessor: Recipe\n## Model: naive_Bayes()\n## \n## ── Preprocessor ────────────────────────────────────────────────────────────────\n## 6 Recipe Steps\n## \n## • step_tokenize()\n## • step_stopwords()\n## • step_stem()\n## • step_tokenfilter()\n## • step_tfidf()\n## • step_normalize()\n## \n## ── Model ───────────────────────────────────────────────────────────────────────\n## Naive Bayes Model Specification (classification)\n## \n## Computational engine: naivebayes\n```\n:::\n\n\n\n### Fitting 1\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/fit1_be885b2f60089a42626c71ca8c287dbb'}\n\n```{.r .cell-code}\nfit1 <-\n  fit_resamples(\n    wf1,\n    folds1,\n    control = control_resamples(save_pred = TRUE)\n  )\n```\n:::\n\n\nDie Vorhersagen speichern wir ab,\num die Performanz in den Faltungen des Hold-out-Samples zu berechnen.\n\n\nMöchte man sich die Zeit sparen, die Syntax wieder durchlaufen zu lassen,\nkann man das Objekt speichern. \nAber Vorsicht: Dabei kann es passieren, dass man mit veralteten Objekten arbeitet.\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/write-fit1_ae472ee290fa52b853c63e2c880be608'}\n\n```{.r .cell-code}\n#write_rds(fit1, \"objects/chap_classific_fit1.rds\")\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/read-fit1_13221ec31ffddf7a54ba4cbcfb286abf'}\n\n:::\n\n\n\n\n### Performanz 1\n\n\n::: {.cell hash='080-klassifikation_cache/html/wf1-perf_31895cf62d084211a5c636aa30a69aff'}\n\n```{.r .cell-code}\nwf1_performance <-\n  collect_metrics(fit1)\n\nwf1_performance\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/wf1-preds_c32bed4c7f05987fe83f8d4fb8a51672'}\n\n```{.r .cell-code}\nwf_preds <-\n  collect_predictions(fit1)\n\nwf_preds %>% \n  group_by(id) %>% \n  roc_curve(truth = c1, .pred_OFFENSE) %>% \n  autoplot()\n```\n\n::: {.cell-output-display}\n![](080-klassifikation_files/figure-html/wf1-preds-1.png){width=672}\n:::\n:::\n\n\n\nconf_mat_resampled(fit1, tidy = FALSE) %>% \n  autoplot(type = \"heatmap\")\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-15_e26342e17a37c8bc8dc4c60d80b3a864'}\n\n```{.r .cell-code}\nconf_mat_resampled(fit1, tidy = FALSE) %>% \n  autoplot(type = \"heatmap\")\n```\n\n::: {.cell-output-display}\n![](080-klassifikation_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Nullmodell\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/nullmodel_9c1d1acbd5c8b1740fadd42f9f24a131'}\n\n```{.r .cell-code}\nnull_classification <- \n  parsnip::null_model() %>%\n  set_engine(\"parsnip\") %>%\n  set_mode(\"classification\")\n\nnull_rs <- workflow() %>%\n  add_recipe(rec1) %>%\n  add_model(null_classification) %>%\n  fit_resamples(\n    folds1\n  )\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-16_b31e58a72e97d16a3bec31cf6ca83ba0'}\n\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-17_da9a57bc03a7b5d7ea58d3da6eb11e0f'}\n\n:::\n\n\n\n\nHier ist die Performanz des Nullmodells.\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-18_f2763f06103bba98f24d6b5ec801c522'}\n\n```{.r .cell-code}\nnull_rs %>%\n  collect_metrics()\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-19_d28df837276586e95229d9ab163b8543'}\n\n```{.r .cell-code}\nshow_best(null_rs)\n## Warning: No value of `metric` was given; metric 'roc_auc' will be used.\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"penalty\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".metric\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimator\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"std_err\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".config\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"0.0017433288\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8116297\",\"5\":\"10\",\"6\":\"0.008710636\",\"7\":\"Preprocessor1_Model22\"},{\"1\":\"0.0007880463\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8111630\",\"5\":\"10\",\"6\":\"0.008941393\",\"7\":\"Preprocessor1_Model21\"},{\"1\":\"0.0003562248\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8103737\",\"5\":\"10\",\"6\":\"0.009238082\",\"7\":\"Preprocessor1_Model20\"},{\"1\":\"0.0001610262\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8099159\",\"5\":\"10\",\"6\":\"0.009444783\",\"7\":\"Preprocessor1_Model19\"},{\"1\":\"0.0000000001\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8095907\",\"5\":\"10\",\"6\":\"0.009602864\",\"7\":\"Preprocessor1_Model01\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n\n## Workflow 2: Rezept 1 + Lasso\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/lasso-spec_c7228c139be62b1a4970a6d0917075b9'}\n\n```{.r .cell-code}\nlasso_spec <- logistic_reg(penalty = tune(), mixture = 1) %>%\n  set_mode(\"classification\") %>%\n  set_engine(\"glmnet\")\n\nlasso_spec\n## Logistic Regression Model Specification (classification)\n## \n## Main Arguments:\n##   penalty = tune()\n##   mixture = 1\n## \n## Computational engine: glmnet\n```\n:::\n\n\n\n\nWir definieren die Ausprägungen von `penalty`, \ndie wir ausprobieren wollen:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/lambda-grid_2ba58d9c270effaba8e65e9b59d6974e'}\n\n```{.r .cell-code}\nlambda_grid <- grid_regular(penalty(), levels = 3)  # hier nur 3 Werte, um Rechenzeit zu sparen\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/wf2_e751bc1152e9ed287e5b88ce3a929343'}\n\n```{.r .cell-code}\nwf2 <-\n  workflow() %>% \n  add_recipe(rec1) %>% \n  add_model(lasso_spec)\n\nwf2\n## ══ Workflow ════════════════════════════════════════════════════════════════════\n## Preprocessor: Recipe\n## Model: logistic_reg()\n## \n## ── Preprocessor ────────────────────────────────────────────────────────────────\n## 6 Recipe Steps\n## \n## • step_tokenize()\n## • step_stopwords()\n## • step_stem()\n## • step_tokenfilter()\n## • step_tfidf()\n## • step_normalize()\n## \n## ── Model ───────────────────────────────────────────────────────────────────────\n## Logistic Regression Model Specification (classification)\n## \n## Main Arguments:\n##   penalty = tune()\n##   mixture = 1\n## \n## Computational engine: glmnet\n```\n:::\n\n\n\nTunen und Fitten:\n\n\n::: {.cell hash='080-klassifikation_cache/html/fit2_5c2cdcce1a21d19166af335aa2ef1eb0'}\n\n```{.r .cell-code}\nset.seed(42)\n\nfit2 <-\n  tune_grid(\n    wf2,\n    folds1,\n    grid = lambda_grid,\n    control = control_resamples(save_pred = TRUE)\n  )\n\nfit2\n```\n:::\n\n\n\nVorsicht beim Abspeichern.\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-20_9ccb8475d3f640dbbe8597769b4e94d0'}\n\n```{.r .cell-code}\n#write_rds(fit2, \"objects/chap_classific_fit2.rds\")\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/read-fit2_8528dfe26dc05a7643decda1e3460927'}\n\n:::\n\n\n\n\nHier ist die Performanz:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-21_77653a62e849f930f19aeec05c620e64'}\n\n```{.r .cell-code}\ncollect_metrics(fit2) %>% \n  filter(.metric == \"roc_auc\") %>% \n  slice_max(mean, n = 3)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-22_3cfbc996b5d23c6c9da0dde7c3c6ab4c'}\n\n```{.r .cell-code}\nautoplot(fit2)\n```\n\n::: {.cell-output-display}\n![](080-klassifikation_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-23_0183fb1327ddd95042ddd5d29da37708'}\n\n```{.r .cell-code}\nfit2 %>% \n  show_best(\"roc_auc\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"penalty\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".metric\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimator\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"std_err\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".config\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1.000000e-10\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.5997476\",\"5\":\"10\",\"6\":\"0.009057521\",\"7\":\"Preprocessor1_Model01\"},{\"1\":\"2.212216e-10\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.5997476\",\"5\":\"10\",\"6\":\"0.009057521\",\"7\":\"Preprocessor1_Model02\"},{\"1\":\"4.893901e-10\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.5997476\",\"5\":\"10\",\"6\":\"0.009057521\",\"7\":\"Preprocessor1_Model03\"},{\"1\":\"1.082637e-09\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.5997476\",\"5\":\"10\",\"6\":\"0.009057521\",\"7\":\"Preprocessor1_Model04\"},{\"1\":\"2.395027e-09\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.5997476\",\"5\":\"10\",\"6\":\"0.009057521\",\"7\":\"Preprocessor1_Model05\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/chosen-auc-fit2_d5f5ec6e34c6618b6fdab5780cb7b313'}\n\n```{.r .cell-code}\nchosen_auc <- \n  fit2 %>%\n  select_by_one_std_err(metric = \"roc_auc\", -penalty)\n```\n:::\n\n\n\n\nFinalisieren:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/wf2-final_792738629535b08d7311002bbde4fd88'}\n\n```{.r .cell-code}\nwf2_final <-\n  finalize_workflow(wf2, chosen_auc)\n\nwf2_final\n## ══ Workflow ════════════════════════════════════════════════════════════════════\n## Preprocessor: Recipe\n## Model: logistic_reg()\n## \n## ── Preprocessor ────────────────────────────────────────────────────────────────\n## 6 Recipe Steps\n## \n## • step_tokenize()\n## • step_stopwords()\n## • step_stem()\n## • step_tokenfilter()\n## • step_tfidf()\n## • step_normalize()\n## \n## ── Model ───────────────────────────────────────────────────────────────────────\n## Logistic Regression Model Specification (classification)\n## \n## Main Arguments:\n##   penalty = 0.00853167852417281\n##   mixture = 1\n## \n## Computational engine: glmnet\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/fit2-final-train_96fd07c319cf6b9195a47ae3021aaaf6'}\n\n```{.r .cell-code}\nfit2_final_train <-\n  fit(wf2_final, d_train)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-24_0f451bccfa2ca6eafec8510a5d8b2603'}\n\n```{.r .cell-code}\nfit2_final_train %>% \n  extract_fit_parsnip() %>% \n  tidy() %>% \n  arrange(-abs(estimate)) %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"penalty\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"0.6972276\",\"3\":\"0.008531679\"},{\"1\":\"tfidf_text_dumm\",\"2\":\"-0.3090231\",\"3\":\"0.008531679\"},{\"1\":\"tfidf_text_merkel\",\"2\":\"-0.2350812\",\"3\":\"0.008531679\"},{\"1\":\"tfidf_text_lbr\",\"2\":\"-0.1986196\",\"3\":\"0.008531679\"},{\"1\":\"tfidf_text_dank\",\"2\":\"0.1242220\",\"3\":\"0.008531679\"},{\"1\":\"tfidf_text_israel\",\"2\":\"0.1077206\",\"3\":\"0.008531679\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/fit2-final-test_1c5ed7b730ff1f83fb3d402474d75378'}\n\n```{.r .cell-code}\nfit2_final_test <-\n  last_fit(wf2_final, d_split)\n\ncollect_metrics(fit2_final_test)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\".metric\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimator\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".config\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"accuracy\",\"2\":\"binary\",\"3\":\"0.6576217\",\"4\":\"Preprocessor1_Model1\"},{\"1\":\"roc_auc\",\"2\":\"binary\",\"3\":\"0.6189140\",\"4\":\"Preprocessor1_Model1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n### Vorhersage\n\n\n### Vohersagedaten\n\nPfad zu den Daten:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-25_c89642f9342ec05b7daed6b209053fc4'}\n\n```{.r .cell-code}\ntweet_data_path <- \"/Users/sebastiansaueruser/github-repos/hate-speech-data/data-raw/tweets/\"\n```\n:::\n\n\n\n:::\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-26_0ebf9095bf945bfa1e4f3dee1a97a489'}\n\n```{.r .cell-code}\ntweet_data_files_names <- list.files(path = tweet_data_path,\n                                     pattern  = \"tweets-to-.*\\\\.rds$\")\nhead(tweet_data_files_names)\n## [1] \"tweets-to-Janine_Wissler_2021.rds\" \"tweets-to-Janine_Wissler_2022.rds\"\n## [3] \"tweets-to-MAStrackZi_2021.rds\"     \"tweets-to-MAStrackZi_2022.rds\"    \n## [5] \"tweets-to-schirdewan_2021.rds\"     \"tweets-to-schirdewan_2022.rds\"\n```\n:::\n\n\n\nWie viele Dateien sind es?\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-27_06106965c965393e71f880fcb417814c'}\n\n```{.r .cell-code}\nlength(tweet_data_files_names)\n## [1] 6\n```\n:::\n\n\n\nWir geben den Elementen des Vektors gängige Namen,\ndas hilft uns gleich bei `map`:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-28_0582aa61ac84df69cf3073168d90b06a'}\n\n```{.r .cell-code}\nnames(tweet_data_files_names) <- \n  str_remove(tweet_data_files_names, \"\\\\.rds$\")  # Datei-Suffix entfernen \n```\n:::\n\n\n\n\n\n\nOK, weiter: So können wir *eine* der Datendateien einlesen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/read-tweets_29ffa1028484c038f05a7c95ef7bc45f'}\n\n```{.r .cell-code}\nd_raw <-\n  read_rds(file = paste0(tweet_data_path, tweet_data_files_names[1])) \n\nd <- \n  d_raw %>% \n  select(id, author_id, created_at, public_metrics) %>% \n  unnest_wider(public_metrics)\n\nhead(d)\n```\n:::\n\n\n\nUnd so lesen wir alle ein:\n\n\nZunächst erstellen wir uns eine Helper-Funktion:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/fun-read-and-select_84d3943e0a2e9dc56066f146af49f303'}\n\n```{.r .cell-code}\nread_and_select <- function(file_name, path_to_tweet_data = tweet_data_path) {\n  \n  out <- \n    read_rds(file = paste0(path_to_tweet_data, file_name)) %>% \n    select(id, author_id, created_at, text, public_metrics) %>% \n    unnest_wider(public_metrics)\n  \n  cat(\"Data file was read.\\n\")\n  \n  return(out)\n}\n```\n:::\n\n\nTesten:\n\n\n::: {.cell hash='080-klassifikation_cache/html/read-and-seelct-test_591787f3a97d62f5b43729b6a2be2a9f'}\n\n```{.r .cell-code}\nd1 <- read_and_select(tweet_data_files_names[1])\n\nhead(d1)\n```\n:::\n\n\n\n\nDie Funktion `read_and_select`  mappen wir auf alle Datendateien:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/map-read-and-select_908850c247d9b756b230184a5e8bfeca'}\n\n```{.r .cell-code}\ntic()\nds <-\n  tweet_data_files_names %>% \n  map_dfr(read_and_select, .id = \"dataset\")\ntoc()\n```\n:::\n\n\n\n`214.531 sec elapsed`\n\nDa wir den Elementen von `tweet_data_files_names` Namen gegeben haben, \nfinden wir diese Namen praktischerweise wieder in `ds`.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-29_67924fdd68f91b8c8a1caab6632e7693'}\n\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/read-ds_11731db0d7481c8058950e2e5444d1f5'}\n\n:::\n\n\n\n\n\nVielleicht ist es zum Entwickeln besser,\nmit einem kleineren Datensatz einstweilen zu arbeiten:\n\n\n::: {.cell hash='080-klassifikation_cache/html/ds-short_f3ac49ceecfb603ee882a0a149f87cce'}\n\n```{.r .cell-code}\nds_short <- read_rds(file = \"/Users/sebastiansaueruser/github-repos/hate-speech-data/objects/ds_short.rds\")  # 300kb\n\nds <- ds_short\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-30_9bd5d42f835cfc27e8955c5762cc74af'}\n\n:::\n\n\n\n\n\n### Vokabular erstellen\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/ds-long_1d2426d2e0ef0ccbc2cb7c8ebf04bf40'}\n\n```{.r .cell-code}\nds_long <-\n  ds %>% \n  select(text) %>% \n  unnest_tokens(input = text, output = word)\n```\n:::\n\n\nPuh, das hat gedauert!\n\nSpeichern wir uns diese Daten daher auf die Festplatte:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-31_23d9558bbe61f385f3e5dd9be37deef7'}\n\n```{.r .cell-code}\n#write_rds(ds_long, file = paste0(tweet_data_path, \"ds_long.rds\"))\n```\n:::\n\n\nEntfernen wir daraus die Duplikate,\num uns ein Vokabular zu erstellen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/ds-voc_fa4e0cbb7e3ff43b3b4a98157f098f67'}\n\n```{.r .cell-code}\nds_voc <-\n  ds_long %>% \n  distinct(word)\n\nhead(ds_voc)\n```\n:::\n\n\nInsgesamt umfasst `nrow(ds_voc)` Wörter.\n\nUnd das resultierende Objekt speichern wir wieder ab:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-32_ac7a57227a333cbee94b25fb0a3bd2ee'}\n\n```{.r .cell-code}\n#write_rds(ds_voc, file = paste0(\"objects/\", \"ds_voc.rds\"))\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-33_5c2f6213cb247439526781bb451ef9c6'}\n\n:::\n\n\n\n\n\n\n## Worteinbettungen erstellen\n\n>    👨‍🏫 Hey ChatGPT, beschreibe Das FastText-Modell für Worteinbettungen.\n\n>    🤖 Ja, Moment...\n\n\n\n### Was ist das FastText-Modell? {#sec-fasttext}\n\nDas [FastText-Modell](https://fasttext.cc/) für Worteinbettungen (auch als Word Embeddings bezeichnet) ist ein NLP-Modell, das von Facebook AI Research entwickelt wurde. Es ist eine Erweiterung des klassischen Word2Vec-Modells und zielt darauf ab, Worte in Vektoren umzuwandeln, um semantische Informationen über Wörter zu erfassen. Der Hauptunterschied zwischen FastText und Word2Vec besteht darin, wie sie Worte darstellen.\n\nHier sind einige wichtige Merkmale und Unterschiede des FastText-Modells:\n\nSubword-Informationen: Während Word2Vec auf ganzen Wörtern basiert, behandelt FastText Wörter als eine Sammlung von Subwörtern (n-Grammen). Diese Subwörter sind buchstäbliche Teile eines Wortes, die für die Analyse verwendet werden. Zum Beispiel, für das Wort \"apple\" könnte FastText die Subwörter \"ap,\" \"app,\" \"ppl,\" \"ple\" usw. berücksichtigen. Dies ermöglicht es dem Modell, semantische Informationen auf Buchstabenebene zu erfassen und seltene Wörter oder Wörter, die nicht im Trainingskorpus enthalten sind, besser zu behandeln.\n\n\n\nPre-trained Modelle: Es stehen vorab trainierte FastText-Modelle in vielen Sprachen zur Verfügung. Diese vortrainierten Modelle können in verschiedenen NLP-Anwendungen verwendet werden, ohne von Grund auf neu trainiert werden zu müssen.\n\nDer Trainingsprozess für ein FastText-Modell umfasst das Lernen von Wortdarstellungen anhand großer Textkorpora. Die resultierenden Wortvektoren können verwendet werden, um semantische Beziehungen zwischen Wörtern zu erkunden, Ähnlichkeiten zu berechnen oder als Eingabe für maschinelle Lernmodelle in verschiedenen natürlichsprachlichen Verarbeitungsaufgaben zu dienen. Insgesamt hat FastText aufgrund seiner Fähigkeit zur Berücksichtigung von Subwörtern und seiner Effizienz bei der Verarbeitung großer Vokabulare in der NLP-Gemeinschaft an Popularität gewonnen.^[Der Text dieses Abschnitts wurde von ChatGPT 3.5 erstellt, 2023-10-29.]\n\n\n### Ein Fast-Text-Modell trainieren\n\n\nDefiniere die Konstanten für das fastText-Modell:\n\n\n::: {.cell hash='080-klassifikation_cache/html/fastText-constants_e39f510b6bba9fa0fab4255863d8599f'}\n\n```{.r .cell-code}\ntexts <- ds %>% pull(text)\ntexts <- tolower(texts)\n```\n:::\n\n\n\nWir können uns ein FastText-Modell für Worteinbettungen basierend auf unseren Daten berechnen lassen:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/fasttext-modell_fa874cd47eb4b68b680d8f845e79d20e'}\n\n```{.r .cell-code}\n#writeLines(text = texts, con = out_file_txt)\n#execute(commands = c(\"skipgram\", \"-input\", tmp_file_txt, \"-output\", out_file_model, \"-verbose\", 1))  # execute berechnet ein FastText-Mdlell\n```\n:::\n\n\nIm Standard werden 100 Dimensionen berechnet.\n\nHier ist schon ein vorab gespeichertes Modell, basierend auf den Twitter-Daten:\n\n\n::: {.cell hash='080-klassifikation_cache/html/fastText-filenames_68f6f89e41466e616f7898f90327b624'}\n\n```{.r .cell-code}\nout_file_txt <- \"/Users/sebastiansaueruser/datasets/Twitter/twitter-polit-model.vec\"\nout_file_model <- \"/Users/sebastiansaueruser/datasets/Twitter/twitter-polit-model.bin\"\n\nfile.exists(out_file_txt)\n## [1] TRUE\nfile.exists(out_file_model)\n## [1] TRUE\n```\n:::\n\n\n\n\n```\nRead 22M words\nNumber of words:  130328\nNumber of labels: 0\nProgress: 100.0% words/sec/thread:   49218 lr:  0.000000 avg.loss:  1.720812 ETA:   0h 0m 0s\n```\n\nJetzt laden wir das Modell von der Festplatte:\n\n\n::: {.cell hash='080-klassifikation_cache/html/twitter-fasttext-model_2a98ecc8d376a4349b9018eba834ae3d'}\n\n```{.r .cell-code}\ntwitter_fasttext_model <- load_model(out_file_model)\ndict <- get_dictionary(twitter_fasttext_model)\n```\n:::\n\n\nDas Wörterbuch umfasst 130328 (verschiedene) Wörter.\n\n\nSchauen wir uns einige Begriffe aus dem Vokabular an:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-34_62b19d10b14dd33e99a26215c498eed7'}\n\n```{.r .cell-code}\nprint(head(dict, 10))\n##  [1] \"</s>\"            \"die\"             \"und\"             \"der\"            \n##  [5] \"sie\"             \"das\"             \"nicht\"           \"in\"             \n##  [9] \"ist\"             \"@_friedrichmerz\"\n```\n:::\n\n\nHier sind die ersten paar Elemente des Vektors für `menschen`:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/vector-menschen_e93149f341f3af324be4daf9eff30e57'}\n\n```{.r .cell-code}\nvec1 <- get_word_vectors(twitter_fasttext_model, c(\"menschen\"))\nvec1[1:10]\n```\n:::\n\n\n\n\n```\n [1]  0.14156282  0.44875699  0.23911817 -0.02580349  0.29811972  0.03870077\n [7]  0.06518744  0.22527063  0.28198120  0.39931887\n ```\n\n\nErstellen wir uns einen Tibble, der \nals erste Spalte das Vokabular und in den übrigen 100 Spalten die Dimensionen enthält:\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-35_1dc5cfb1f43c5b76fa55523b85e6eb9e'}\n\n```{.r .cell-code}\nword_embedding_twitter <-\n  tibble(\n    word = dict\n  )\n```\n:::\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/words-vec-twitter_c9e8a68ad775fdff23e5880c1eb890cd'}\n\n```{.r .cell-code}\nwords_vecs_twitter <-\n  get_word_vectors(twitter_fasttext_model)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/df-word-embedding-twitter_99db5b901aa5431a8ea9e046d33ad50a'}\n\n```{.r .cell-code}\nword_embedding_twitter <-\n  word_embedding_twitter %>% \n  bind_cols(words_vecs_twitter)\n\nnames(word_embedding_twitter) <- c(\"word\", paste0(\"v\", sprintf(\"%03d\", 1:100)))  # Namen verschönern mit fortlaufender Nummer von 0 bis 100\n```\n:::\n\n\n\nUnd als Worteinbettungs-Datei abspeichern:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-36_3d1cf9d3f0d315b7b3fb9a6659ea9113'}\n\n```{.r .cell-code}\n#write_rds(word_embedding_twitter, file = paste0(tweet_data_path, \"word_embedding_twitter.rds\"))\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-37_eb8285bcd775a6325d84c9f1ba780e18'}\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"word\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"v001\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v002\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v003\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"v004\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"<\\/s>\",\"2\":\"0.17330834\",\"3\":\"0.07820062\",\"4\":\"-0.05277666\",\"5\":\"0.0862241\"},{\"1\":\"die\",\"2\":\"0.48641139\",\"3\":\"0.03693734\",\"4\":\"-0.01204743\",\"5\":\"0.1565817\"},{\"1\":\"und\",\"2\":\"0.39090732\",\"3\":\"-0.02645574\",\"4\":\"0.11355034\",\"5\":\"0.1545031\"},{\"1\":\"der\",\"2\":\"0.37105647\",\"3\":\"-0.33681911\",\"4\":\"0.05018367\",\"5\":\"0.2029566\"},{\"1\":\"sie\",\"2\":\"0.45957077\",\"3\":\"0.04141690\",\"4\":\"0.23099238\",\"5\":\"0.1809430\"},{\"1\":\"das\",\"2\":\"0.07037771\",\"3\":\"-0.07423849\",\"4\":\"0.04087655\",\"5\":\"0.1506333\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n### Aufbereiten\n\nAm besten nur die Spalten (unseres Twitter-Datensatzes) behalten,\ndie wir zum Modellieren nutzen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/ds-short2_c7ab04eca5eb49704cdaf612e8b662f5'}\n\n```{.r .cell-code}\nds_short2 <-\n  ds_short %>% \n  select(text, id)\n```\n:::\n\n\n\nWir definieren ein modifiziertesRezept `rec1`:\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-38_b998285bc3b365964367452faf2d63d8'}\n\n```{.r .cell-code}\nrec1a <- \n  recipe(c1 ~ ., data = select(d_train, text, c1, id)) %>% \n  update_role(id, new_role = \"id\") %>% \n  step_tokenize(text) %>% \n  step_stopwords(text, language = \"de\", stopword_source = \"snowball\") %>% \n  step_stem(text) %>% \n  step_tokenfilter(text, max_tokens = 1e2) %>%  # wir behalten nur die häufigsten Tokens\n  step_word_embeddings(text, embeddings = word_embedding_twitter)\n```\n:::\n\n\n\nDann preppen und backen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-39_e828d1fe6eb17863875a7c4fb5735196'}\n\n```{.r .cell-code}\nrec1a_prepped <-\n  prep(rec1a)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/ds-baked_1a7c3ba54faa334a8dd5dfd5f0b7563e'}\n\n```{.r .cell-code}\nds_baked_rec1a <- bake(rec1a_prepped, new_data = ds_short2)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-40_9ce44f620e4dbeff33ef4f95c7b1f692'}\n\n```{.r .cell-code}\nds_baked_rec1a %>% `[`(1:10, 1:10)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"wordembed_text_v001\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v002\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v003\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v004\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v005\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v006\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v007\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v008\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"wordembed_text_v009\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"NA\",\"2\":\"0.23893653\",\"3\":\"0.014598664\",\"4\":\"-0.2222376\",\"5\":\"0.48163152\",\"6\":\"0.20162874\",\"7\":\"-0.12450162\",\"8\":\"0.23333058\",\"9\":\"-0.226192281\",\"10\":\"-0.027382970\"},{\"1\":\"NA\",\"2\":\"0.32377085\",\"3\":\"0.695485767\",\"4\":\"0.4336860\",\"5\":\"0.28993332\",\"6\":\"-0.17770833\",\"7\":\"-0.74807747\",\"8\":\"1.49294108\",\"9\":\"1.064348385\",\"10\":\"0.820613639\"},{\"1\":\"NA\",\"2\":\"0.21142043\",\"3\":\"0.783711389\",\"4\":\"-1.3797138\",\"5\":\"0.28518000\",\"6\":\"0.33366236\",\"7\":\"-0.24040961\",\"8\":\"0.19629040\",\"9\":\"0.084888689\",\"10\":\"-0.186157003\"},{\"1\":\"NA\",\"2\":\"0.71277493\",\"3\":\"-0.304109801\",\"4\":\"-0.4309491\",\"5\":\"0.05916093\",\"6\":\"0.04967718\",\"7\":\"0.10116307\",\"8\":\"0.34288836\",\"9\":\"0.004611025\",\"10\":\"0.875826895\"},{\"1\":\"NA\",\"2\":\"0.00000000\",\"3\":\"0.000000000\",\"4\":\"0.0000000\",\"5\":\"0.00000000\",\"6\":\"0.00000000\",\"7\":\"0.00000000\",\"8\":\"0.00000000\",\"9\":\"0.000000000\",\"10\":\"0.000000000\"},{\"1\":\"NA\",\"2\":\"0.00000000\",\"3\":\"0.000000000\",\"4\":\"0.0000000\",\"5\":\"0.00000000\",\"6\":\"0.00000000\",\"7\":\"0.00000000\",\"8\":\"0.00000000\",\"9\":\"0.000000000\",\"10\":\"0.000000000\"},{\"1\":\"NA\",\"2\":\"0.61656542\",\"3\":\"-0.006150134\",\"4\":\"-0.7271604\",\"5\":\"-0.10712643\",\"6\":\"0.96813375\",\"7\":\"-0.03373864\",\"8\":\"0.08099335\",\"9\":\"0.201609042\",\"10\":\"1.104397699\"},{\"1\":\"NA\",\"2\":\"0.04866463\",\"3\":\"-0.441774538\",\"4\":\"-0.3122953\",\"5\":\"0.05295798\",\"6\":\"0.78680488\",\"7\":\"0.09914146\",\"8\":\"0.01339768\",\"9\":\"-0.094183717\",\"10\":\"0.029520422\"},{\"1\":\"NA\",\"2\":\"0.00000000\",\"3\":\"0.000000000\",\"4\":\"0.0000000\",\"5\":\"0.00000000\",\"6\":\"0.00000000\",\"7\":\"0.00000000\",\"8\":\"0.00000000\",\"9\":\"0.000000000\",\"10\":\"0.000000000\"},{\"1\":\"NA\",\"2\":\"0.21170381\",\"3\":\"-0.291642219\",\"4\":\"-0.3079664\",\"5\":\"-0.17432338\",\"6\":\"0.52147198\",\"7\":\"-0.06467295\",\"8\":\"0.21021771\",\"9\":\"-0.425262958\",\"10\":\"0.006601942\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nIst das nicht komfortabel?\nDas Textrezept übernimmt die Arbeit für uns,\nmit den richtigen Features zu arbeiten,\nund die Wort-Einbettungen für die richtigen Wörter bereitzustellen.\n\nWer dem Frieden nicht traut,\ndem sei geraten, nachzuprüfen 🤓.\n\n\n\n## Workflow 3: Rezept 2 + Lasso\n\n### Daten aufteilen\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/split-data3_f0092a9f20716aac4aa2fcb2b00aced9'}\n\n```{.r .cell-code}\nd_split <- initial_split(d2, strata = c1)\n\nd_train <- training(d_split)\nd_test <- testing(d_split)\n```\n:::\n\n\n\n\n### Hilfsfunktionen\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-41_a0850cd4efe894e642ae924dfbf4efc1'}\n\n```{.r .cell-code}\nsource(\"funs/helper-funs-recipes.R\")\n```\n:::\n\n\n\n\nTesten wir die Funktionen:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-42_853ac1ee2528321e45592696d80f3da7'}\n\n```{.r .cell-code}\ndummy <- c(\"hallo\", \"baby\", \"fatal\")\n\ncount_profane(dummy) \n## [1] 1\n\ncount_emo_words(dummy)\n## [1] 1\n\ndummy <- c(\"baby\", \"und\", \"🆗\", \"🖕\")\n\ncount_emojis(dummy)\n## [1] 0\n\ncount_wild_emojis(dummy) \n## [1] 0\n```\n:::\n\n\n\n### Rezept mit Worteinbettungen\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec2_079cc1d0fa27ee2604293fe3ca283972'}\n\n```{.r .cell-code}\nrec2 <- \n  recipe(c1 ~ ., data = select(d_train, text, c1, id)) %>% \n  update_role(id, new_role = \"id\") %>% \n  step_text_normalization(text) %>% \n  step_mutate(text_copy = text,\n              profane_n = map_int(text, count_profane),\n              emo_words_n = map_int(text, count_emo_words),\n              emojis_n = map_int(text, count_emojis),\n              wild_emojis_n = map_int(text, count_wild_emojis)\n  ) %>% \n  step_textfeature(text_copy) %>% \n  step_tokenize(text, token = \"words\") %>% \n  step_stopwords(text, language = \"de\", stopword_source = \"snowball\") %>% \n  step_word_embeddings(text, embeddings = word_embedding_twitter)\n \nrec2\n## \n## ── Recipe ──────────────────────────────────────────────────────────────────────\n## \n## ── Inputs\n## Number of variables by role\n## outcome:   1\n## predictor: 1\n## id:        1\n## \n## ── Operations\n## • Text Normalization for: text\n## • Variable mutation for: text, map_int(text, count_profane), ...\n## • Text feature extraction for: text_copy\n## • Tokenization for: text\n## • Stop word removal for: text\n## • Word embeddings aggregated from: text\n```\n:::\n\n\n\n\n\nJetzt preppen:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec2-prepped_3e84b849ec0a0d3eabd3ec17c41ab020'}\n\n```{.r .cell-code}\nrec2_prepped <- prep(rec2)\n```\n:::\n\n\n\n\n\nVielleicht macht es Sinn, sich das Objekt zur späteren\nVerwendung abzuspeichern.^[Aber Vorsicht beim Abspeichern, man könnte versehentlich mit einer veralteten Version weiterarbeiten.]\n`Feather` verarbeitet nur Dataframes,\ndaher nutzen wir hier RDS.\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-43_993d47934f13ed3bb87dc6fd5d635553'}\n\n```{.r .cell-code}\n#write_rds(rec2_prepped, file = \"~/datasets/Twitter/klassifik-rec2-prepped.rds\")\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-44_4fdf3594491afffb9ce4e0a3d85a3840'}\n\n```{.r .cell-code}\nrec2_prepped <- read_rds(\"/Users/sebastiansaueruser/github-repos/hate-speech-data/objects/rec2_prepped.rds\")\n```\n:::\n\n\n\n\n\nDas Element `rec2_prepped` ist recht groß:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-45_991adb40141ef137d14c0c54c1e41610'}\n\n```{.r .cell-code}\nformat(object.size(rec2_prepped), units  = \"Mb\")\n## [1] \"113.8 Mb\"\n```\n:::\n\n\nJetzt können wir das präparierte (\"gepreppte\") Rezept \"backen\":\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/rec2-prepped-baked_5acd513c5cbc4468cde3d6426275d587'}\n\n```{.r .cell-code}\nrec2_baked <- bake(rec2_prepped, new_data = NULL)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-46_76012e474af86e0fcc3837ba061561f8'}\n\n```{.r .cell-code}\nrec2_baked %>% \n  select(1:15) %>% \n  glimpse()\n## Rows: 3,756\n## Columns: 15\n## $ id                                  <fct> 5, 7, 10, 12, 17, 27, 33, 42, 44, …\n## $ c1                                  <fct> OFFENSE, OFFENSE, OFFENSE, OFFENSE…\n## $ profane_n                           <int> 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n## $ emo_words_n                         <int> 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1…\n## $ emojis_n                            <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n## $ wild_emojis_n                       <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n## $ textfeature_text_copy_n_words       <int> 16, 32, 15, 26, 19, 15, 33, 30, 31…\n## $ textfeature_text_copy_n_uq_words    <int> 16, 28, 15, 25, 17, 15, 32, 29, 29…\n## $ textfeature_text_copy_n_charS       <int> 121, 145, 119, 134, 112, 101, 196,…\n## $ textfeature_text_copy_n_uq_charS    <int> 31, 29, 30, 39, 36, 31, 35, 42, 35…\n## $ textfeature_text_copy_n_digits      <int> 0, 4, 0, 2, 4, 0, 0, 0, 1, 0, 2, 0…\n## $ textfeature_text_copy_n_hashtags    <int> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n## $ textfeature_text_copy_n_uq_hashtags <int> 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n## $ textfeature_text_copy_n_mentions    <int> 1, 1, 0, 1, 0, 1, 1, 5, 1, 0, 1, 1…\n## $ textfeature_text_copy_n_uq_mentions <int> 1, 1, 0, 1, 0, 1, 1, 5, 1, 0, 1, 1…\n```\n:::\n\n\n\nDas Rezept beinhaltet also einige Textfeatures plus die FastText-Worteinbettungen.\n\n### Fitting 3 {#sec-klassifik-fit3}\n\n\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/wf3_f7535f8176b69bfb6c9c9055f191ae9b'}\n\n```{.r .cell-code}\nwf3 <-\n  workflow() %>% \n  add_recipe(rec2) %>% \n  add_model(lasso_spec)\n\nwf3\n## ══ Workflow ════════════════════════════════════════════════════════════════════\n## Preprocessor: Recipe\n## Model: logistic_reg()\n## \n## ── Preprocessor ────────────────────────────────────────────────────────────────\n## 6 Recipe Steps\n## \n## • step_text_normalization()\n## • step_mutate()\n## • step_textfeature()\n## • step_tokenize()\n## • step_stopwords()\n## • step_word_embeddings()\n## \n## ── Model ───────────────────────────────────────────────────────────────────────\n## Logistic Regression Model Specification (classification)\n## \n## Main Arguments:\n##   penalty = tune()\n##   mixture = 1\n## \n## Computational engine: glmnet\n```\n:::\n\n\n\n\n\n\nTunen und Fitten:\n\n\n::: {.cell hash='080-klassifikation_cache/html/wf3-fit_ad0f96fc98fa905ea46c29cb4a622559'}\n\n```{.r .cell-code}\nset.seed(42)\n\ntic()\nfit3 <-\n  tune_grid(\n    wf3,\n    folds1,\n    grid = lambda_grid,\n    control = control_resamples(save_pred = TRUE)\n  )\n(toc)\nfit3\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-47_8d14f3040a9a287e8e9469cfbd5c7fe4'}\n\n```{.r .cell-code}\n#write_rds(fit3, \"objects/chap_classific_fit3.rds\")\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-48_80fd25340ae116c7b81f6adaa6f63940'}\n\n:::\n\n\n\n\nHier ist die Performanz:\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-49_f3329e8b6c9a4c06429f769e153e508c'}\n\n```{.r .cell-code}\ncollect_metrics(fit3)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-50_e0c429f8f5da73fa845ad93bc8efd942'}\n\n```{.r .cell-code}\nautoplot(fit3)\n```\n\n::: {.cell-output-display}\n![](080-klassifikation_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-51_a66fce26d52e2d9b44df5068346b038b'}\n\n```{.r .cell-code}\nfit3 %>% \n  show_best(\"roc_auc\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"penalty\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".metric\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimator\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"n\"],\"name\":[5],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"std_err\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".config\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"0.0017433288\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8116297\",\"5\":\"10\",\"6\":\"0.008710636\",\"7\":\"Preprocessor1_Model22\"},{\"1\":\"0.0007880463\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8111630\",\"5\":\"10\",\"6\":\"0.008941393\",\"7\":\"Preprocessor1_Model21\"},{\"1\":\"0.0003562248\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8103737\",\"5\":\"10\",\"6\":\"0.009238082\",\"7\":\"Preprocessor1_Model20\"},{\"1\":\"0.0001610262\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8099159\",\"5\":\"10\",\"6\":\"0.009444783\",\"7\":\"Preprocessor1_Model19\"},{\"1\":\"0.0000000001\",\"2\":\"roc_auc\",\"3\":\"binary\",\"4\":\"0.8095907\",\"5\":\"10\",\"6\":\"0.009602864\",\"7\":\"Preprocessor1_Model01\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/chosenauc-fit3_f54278d2943f058ede1a255ba8f20814'}\n\n```{.r .cell-code}\nchosen_auc_fit3 <- \n  fit3 %>%\n  select_by_one_std_err(metric = \"roc_auc\", -penalty)\n```\n:::\n\n\n\n\nFinalisieren:\n\n\n\n::: {.cell hash='080-klassifikation_cache/html/wf3-final_a6136cb4552c6681a2c0022f981b498a'}\n\n```{.r .cell-code}\nwf3_final <-\n  finalize_workflow(wf3, chosen_auc_fit3)\n\nwf3_final\n## ══ Workflow ════════════════════════════════════════════════════════════════════\n## Preprocessor: Recipe\n## Model: logistic_reg()\n## \n## ── Preprocessor ────────────────────────────────────────────────────────────────\n## 6 Recipe Steps\n## \n## • step_text_normalization()\n## • step_mutate()\n## • step_textfeature()\n## • step_tokenize()\n## • step_stopwords()\n## • step_word_embeddings()\n## \n## ── Model ───────────────────────────────────────────────────────────────────────\n## Logistic Regression Model Specification (classification)\n## \n## Main Arguments:\n##   penalty = 0.00853167852417281\n##   mixture = 1\n## \n## Computational engine: glmnet\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/fit3-final-train_878a9a44f3c70819b8a4eddfd66ecc7b'}\n\n```{.r .cell-code}\n#fit3_final_train <-  # die Berechnung kann dauern ...\n  fit(wf3_final, d_train)\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-52_530cd82f930a169f1a29ff3cf065f4d3'}\n\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/fit3-final-train2_13f4d3f29af32fa4f93631998d22fce4'}\n\n```{.r .cell-code}\nfit3_final_train %>% \n  extract_fit_parsnip() %>% \n  tidy() %>% \n  arrange(-abs(estimate)) %>% \n  head()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"term\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"estimate\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"penalty\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"1.3359975\",\"3\":\"0.008531679\"},{\"1\":\"profane_n\",\"2\":\"-0.5669547\",\"3\":\"0.008531679\"},{\"1\":\"wordembed_text_v055\",\"2\":\"0.2084922\",\"3\":\"0.008531679\"},{\"1\":\"textfeature_text_copy_n_exclaims\",\"2\":\"-0.1848394\",\"3\":\"0.008531679\"},{\"1\":\"wordembed_text_v089\",\"2\":\"-0.1844506\",\"3\":\"0.008531679\"},{\"1\":\"wordembed_text_v054\",\"2\":\"0.1759950\",\"3\":\"0.008531679\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/fit3-final-test_f3005dcddf41f5dfe926d5793c3dca1a'}\n\n```{.r .cell-code}\nfit3_final_test <-\n  last_fit(wf3_final, d_split)  # dauert etwas\n```\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-53_55eb9bbd353cd52536c872681733bd91'}\n\n:::\n\n::: {.cell hash='080-klassifikation_cache/html/load-fit3-final-test_6f33194d43c6f042bc8159beaace7e72'}\n\n:::\n\n\n\nUnd endlich: Wie gut ist die Performanz?\n\n\n::: {.cell hash='080-klassifikation_cache/html/unnamed-chunk-54_e75266ff1398aec25b7ab8695c9965b1'}\n\n```{.r .cell-code}\ncollect_metrics(fit3_final_test)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\".metric\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimator\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\".estimate\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\".config\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"accuracy\",\"2\":\"binary\",\"3\":\"0.7454110\",\"4\":\"Preprocessor1_Model1\"},{\"1\":\"roc_auc\",\"2\":\"binary\",\"3\":\"0.8055475\",\"4\":\"Preprocessor1_Model1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nAm Ende so eines Arbeitsganges,\nbei dem man wieder (und wieder) die gleichen Funktionen kopiert,\nund nur aufpassen muss, aus `fit2` an der richtigen Stelle `fit3` zu machen:\nDa blickt man jedem Umbau dieses Codes zu einer Funktion freudig ins Gesicht.\n\nEin anderes Problem,\nfür das hier keine elegante Lösung präsentiert wird,\nsind die langen Berechnungszeiten, die, wenn man Pech hat, auch noch\nmehrfach wiederholt werden müssen.\n\nDie Gefahr mit dem Abspeichern via `write_rds` ist klar:\nMan riskiert, später ein veraltetes Objekt zu laden.\n\nZu diesen Punkten später mehr.\n\n\n\n## Fallstudien\n\n\n\nJulia Silge stellt eine schöne [Fallstudie](https://juliasilge.com/blog/spam-email/) zur Klassifikation von Spam-Mails bereit. In der Fallstudie geht es nicht um Feature Engineering, sondern um Modellierung.\n\n[ChatGPT generierten Text automatisch erkennen -- ](https://juliasilge.com/blog/gpt-detectors/) wie gut geht das? \nDie Maschine erkennt sich selbst, im besten (oder schlechtesten?) Fall. Die Fallstudie zeigt, naja, so mittel, zumindest in den Daten in der Fallstudie.\n\n\n[OpenAIs Word-Einbettungen](https://platform.openai.com/docs/guides/embeddings) werden in [dieser Fallstudie](https://juliasilge.com/blog/horror-embeddings/) verwendet. Sehr schön!\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}