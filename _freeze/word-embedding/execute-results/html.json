{
  "hash": "688e0992d466d3c81f6364653005fe78",
  "result": {
    "markdown": "# Word Embedding\n\n\n![Text als Datenbasis pr√§diktiver Modelle](img/text-mining-1476780_640.png){width=10%}\nBild von <a href=\"https://pixabay.com/de/users/mcmurryjulie-2375405/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780\">mcmurryjulie</a> auf <a href=\"https://pixabay.com/de//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780\">Pixabay</a>\n\n\n\n## Vorab\n\n\n### Lernziele\n\n\n\n- Die grundlegenden Konzepte der Informationstheorie erkl√§ren k√∂nnen\n- Die vorgestellten Techniken des Textminings mit R anwenden k√∂nnen\n\n\n\n### Vorbereitung\n\n- Lesen Sie [diesen Text](https://www.science4all.org/article/shannons-information-theory/) als Vorbereitung\n- Arbeiten Sie @smltar, [Kap. 5](https://smltar.com/embeddings.html) durch.\n\n\n\n\n\n\n### Ben√∂tigte R-Pakete\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-1_79e2c8a2fc606b5672cedc7ed4d513f6'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(easystats)  # Komfort f√ºr deskriptive Statistiken, wie `describe_distribution`\nlibrary(tidytext)\nlibrary(hcandersenr)   # Textdaten\nlibrary(slider)  # slide\nlibrary(widyr)  # pairwise_pmi\nlibrary(furrr)  # mehrere Kerne gleichzeitig nutzen\nlibrary(textdata)  # Worteinbettungen, vorgekocht\nlibrary(entropy)  # Entropie berechnen\n```\n:::\n\n\n\n\n\n\n## Informationstheorie\n\n\n\n\n\n\n### Einf√ºhrung\n\n\nDie Informationstheorie ist eine der Sternstunden der Wissenschaft. [Manche sagen](http://www.science4all.org/article/shannons-information-theory/) dass Claude Shannon, der Autor der Theorie, auf einer Stufe mit Darwin und Einstein stehen sollte:\n\n>    In this single paper, Shannon introduced this new fundamental theory. He raised the right questions, which no one else even thought of asking. This would have been enough to make this contribution earthshaking. But amazingly enough, Shannon also provided most of the right answers with class and elegance. In comparison, it took decades for a dozen of top physicists to define the basics of quantum theory. Meanwhile, Shannon constructed something equivalent, all by himself, in a single paper.\nShannon‚Äôs theory has since transformed the world like no other ever had, from information technologies to telecommunications, from theoretical physics to economical globalization, from everyday life to philosophy. (...)\nI don‚Äôt think Shannon has had the credits he deserves. He should be right up there, near Darwin and Einstein, among the few greatest scientists mankind has ever had the chance to have. \n\n\nF√ºr die Statistik ist die Informationstheorie von hoher Bedeutung.\nIm Folgenden schauen wir uns einige Grundlagen an.\n\n\n\n\n### Shannon-Information\n\nMit der *Shannon-Information* (Information, Selbstinformation) quantifizieren wir, wie viel \"√úberraschung\" sich in einem Ereignis verbirgt [@shannon_1948].\n\nEin Ereignis mit ...\n\n- *geringer* Wahrscheinlichkeit: *Viel* √úberraschung (Information)\n- *hoher* Wahrscheinlichkeit: *Wenig* √úberraschung (Information)\n\n\n\nWenn wir also erfahren, dass ein unwahrscheinliches Ereignis eingetreten ist (Schnee im Sommer), sind wir √ºberraschter als wenn wir h√∂hen, dass ein wahrscheinliches Ereignis eingetreten ist (Schnee im Winter).\n\nDie Information eines Ereignis ist also eng verbunden mit seiner Wahrscheinlichkeit oder auch mit den Odds eines Ereignisses.\n\nDie Shannon-Information ist die einzige Gr√∂√üe, die einige w√ºnschenswerte Anforderungen^[Desiderata, sagt man] erf√ºllt:\n\n1. Stetig\n2. Je mehr Ereignisse in einem Zufallsexperiment m√∂glich sind, desto h√∂her die Information, wenn ein bestimmtes Ereignis eintritt\n3. Additiv: Die Summe der Information zweier Teilereignisse ist gleich der Information des Gesamtereignis\n\n\n\n:::{#def-info}\n\n## Shannon-Information\n\n\nDie Information ist so definiert:\n\n\n$$I(x) = - \\log_2 \\left( Pr(x) \\right)$$\n\n:::\n\nAndere Logaritmusbasen sind m√∂glich. Bei einem bin√§ren Logarithmus nennt man die Einheit *Bit*^[oder *shannon*].\n\n\nEin M√ºnwzurf^[wie immer, als fair angenommen, wenn sonst nichts anderes angegeben ist] hat *1 Bit* Information:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-2_8aa06ce3a559e9b2a99a545d488ab943'}\n\n```{.r .cell-code}\n-log(1/2, base = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1\n```\n:::\n:::\n\n\n\n\n\nDamit gilt: $I = \\frac{1}{Pr(x)}$\n\nDie Information ist eng verwandt mit den Odds bzw. Log-Odds (Logits):\n\n\n$\\text{log-odds}(x)=\\log \\left({\\frac {p(x)}{p(\\lnot x)}}\\right)$\n\nLogits k√∂nnen als Differenz zweier Shannon-Infos ausgedr√ºckt werden:\n\n\n$\\text{log-odds}(x)=I(\\lnot x)-I(x)$\n\n\n\nDie Information zweier unabh√§ngiger Ereignisse ist additiv.\n\nDie gemeinsame Wahrscheinlichkeit zweier unabh√§ngiger Ereignisse ist das Produkt der einzelnen Wahrscheinlichkeiten:\n\n$Pr(x,y) = Pr(x) \\cdot Pr(y)$\n\nDie *gemeinsame Information* ist dann\n\n$$\n{\\displaystyle {\\begin{aligned}\\operatorname {I}(x,y)&=-\\log _{2}\\left[p(x,y)\\right]=-\\log _{2}\\left[p(x)p(y)\\right]\\\\[5pt]&=-\\log _{2}\\left[p{(x)}\\right]-\\log _{2}\\left[p{(y)}\\right]\\\\[5pt]&=\\operatorname {I} (x)+\\operatorname {I} (y)\\end{aligned}}}\n$$\n\n\n\n\n\n:::{#exm-info1}\n\n\n## Information eines wahrscheinlichen Ereignisses\n\nDie Information eines fast sicheren Ereignisses ist gering.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-3_b3ffdb6fb3fab73e9d2d34a7055db5b9'}\n\n```{.r .cell-code}\n-log(99/100, base = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.01449957\n```\n:::\n:::\n\n\n\n:::\n\n\n\n\n\n:::{#exm-info2}\n\n\n## Information eines unwahrscheinlichen Ereignisses\n\nDie Information eines unwahrscheinlichen Ereignisses ist hoch.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-4_a4438963111710a841089c1b5d43bc86'}\n\n```{.r .cell-code}\n-log(01/100, base = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6.643856\n```\n:::\n:::\n\n\n\n:::\n\n\n\n\n\n\n\n:::{#exm-info3}\n\n\n## Information eines W√ºrfelwurfs\n\n\nDie Wahrscheinlichkeitsfunktion eines W√ºrfel ist\n\n${\\displaystyle Pr(k)={\\begin{cases}{\\frac {1}{6}},&k\\in \\{1,2,3,4,5,6\\}\\\\0,&{\\text{ansonsten}}\\end{cases}}}$\n\n\n\nDie Wahrscheinlichkeit, eine 6 zu w√ºrfeln, ist $Pr(X=6) = \\frac{1}{6}$.\n\n\n\nDie Information von $X=6$ betr√§gt also\n\n\n$I(X=6) = -\\log_2 \\left( Pr(X=6) \\right) = -\\log_2(1/6) \\approx 2.585 \\, \\text{bits}$.\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-5_0a5822206486d127da4bfb2ea152b40f'}\n\n```{.r .cell-code}\n-log(1/6, base = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.584963\n```\n:::\n:::\n\n\n\n:::\n\n\n\n\n\n\n\n:::{#exm-info3}\n\n\n## Information zweier  W√ºrfelwurfe\n\n\n\n\n\n\n\nDie Wahrscheinlichkeit, mit zwei W√ºrfeln, $X$ und $Y$, jeweils *6* zu w√ºrfeln, \nbetr√§gt $Pr(X=6, Y=6) = \\frac{1}{36}$\n\n\n\nDie Information betr√§gt also\n\n\n$I(X=6, Y=6) = -\\log_2 \\left( Pr(6,6) \\right)$\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-6_e79b94732bd7d511ee15b869ca4c2393'}\n\n```{.r .cell-code}\n-log(1/36, base = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 5.169925\n```\n:::\n:::\n\n\n\nAufgrund der Additivit√§t der Information gilt\n\n\n$I(6,6) = I(6) + I(6)$\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-7_cd015b8f1f3620edcaab684c332a50f1'}\n\n```{.r .cell-code}\n-log(1/6, base = 2) + -log(1/6, base = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 5.169925\n```\n:::\n:::\n\n\n\n\n:::\n\n\n\n\n\n\n\n\n\n### Entropie\n\n\n(Informations)entropie ist die Summe der Informationen der Ereignisse einer Zufallsvariablen, $X$.\n\n\n\n:::{#def-entropie}\n\n\n## Informationsentropie\n\n\n*Informationsentropie*  ist so definiert:\n\n$$H(p) = - \\text{E log} (p_i) = - \\sum_{i = 1}^n p_i \\text{log} (p_i) = E\\left[I(X) \\right]$$\n\n:::\n\nDie Informationsentropie ist also die \"mittlere\" oder \"erwartete Information einer Zufallsvariablen.\n\n\nDie Entropie eines M√ºnzwurf-Versuchs (Bernoulli-Experiment) ist dann maximal (1 bit), wenn die Trefferwahrscheinlichkeit 50% betr√§gt: $Pr(X=x) = 1/2$, s. Abb. @fig-bernoulli-entropy.\n\n\n![Der Zusammenhang von Wahrscheinlichkeit und Entropie bei einem Bernoulli-Versuch, Quelle: Wikipedia, CC-BY-SA, Brona, Rubber Duck](img/Binary_entropy_plot.svg.png){#fig-bernoulli-entropy width=\"30%\"}\n\n\n\n### Gemeinsame Information\n\nDie *gemeinsame Information* (mutual information, MI) zweier Zufallsvariablen $X$ und $Y$, $I(X,Y)$, quantifiziert die Informationsmenge, die man √ºber $Y$ erh√§lt, wenn man $X$ beobachtet. Mit anderen Worten: Die MI ist ein Ma√ü des Zusammenhangs zweier (nominaler) Variablen. Im Gegensatz zur Korrelation ist die MI nicht auf lineare Abh√§ngigkeiten beschr√§nkt.\n\n\n\nDie MI quantifiziert den Unterschied zwischen der gemeinsamen Verteilung $Pr(X,Y)$ und dem Produkt einer einzelnen^[auch als *marginalen* Wahrscheinlichkeiten oder *Randwahrscheinlichkeiten* bezeichnet] Wahrscheinlichkeitsverteilungen, d.h. $Pr(X)$ und $Pr(Y)$.\n\nWenn die beiden Variablen (stochastisch) unabh√§ngig^[F√ºr stochastische Unabh√§ngigkeit kann das Zeichen $\\bot$ verwendet werden] sind, ist ihre gemeinsame Information Null:\n\n$I(X,Y) = 0 \\quad \\text{gdw} \\quad \\bot(X,Y)$.\n\nDann gilt n√§mlich:\n\n$\\log \\left( \\frac{Pr(X,Y)} {Pr(X) \\cdot Pr(Y)} \\right) =\\log(1) = 0$.\n\n\nDas macht intuitiv Sinn: Sind zwei Variablen unabh√§ngig, so erf√§hrt man nichts √ºber die zweite, wenn man die erste kennt. So ist Kenntnis der Sternzeichens einer Person und ihrer K√∂rpergr√∂√üe unabh√§ngig.\n\nDas Gegenteil ist auch wahr: Sind zwei Variablen voneinander komplett abh√§ngig, so wei√ü man alles √ºber die zweite, wenn man die erste kennt.\n\n\nDie gemeinsame Information kann man sich als *Summe der einzelnen gemeinsamen Informationen* von $XY$ sehen (s. @tbl-mi1):\n\n\n::: {#tbl-mi1 .cell tbl-cap='Summe der punktweisen gemeinsamen Informationen' hash='word-embedding_cache/html/tbl-mi1_0555439b9caf393354c855423beaf5b1'}\n\n```{.r .cell-code}\nd <- tibble::tribble(\n     ~x1,    ~x2,    ~x3,\n  \"x1y2\", \"x2y1\", \"x3y1\",\n  \"x2y1\", \"x2y2\", \"x3y2\",\n  \"x1y3\", \"x2y3\", \"x3y3\"\n  )\n```\n:::\n\n\n\n\n$I(X,Y) = \\Sigma_Y \\Sigma_y Pr(x,y) \\underbrace{\\log \\left( \\frac{Pr(X,Y)}{Pr(X) Pr(Y)} \\right)}_\\text{punktweise MI}$ \n\nDie Summanden der gemeinsamen Information bezeichnet man auch als *punktweise gemeinsame Information* (pointwise mutual information, PMI), entsprechend, s. @eq-pmi. MI ist also der Erwartungswert der PMI.\n\n\n$${\\displaystyle \\operatorname {PMI} (x,y)\\equiv \\log_{2}{\\frac {p(x,y)}{p(x)p(y)}}=\\log _{2}{\\frac {p(x|y)}{p(x)}}=\\log _{2}{\\frac {p(y|x)}{p(y)}}}\n$${#eq-pmi}\n\n\nAndere Basen als `log2` sind gebr√§uchlich, vor allem der nat√ºrliche Logarithmus.\n\n\n\n\n::: {.remark}\n\nDie zwei rechten Umformungen in @eq-pmi basieren auf der Umformung der gemeinsamen Wahrscheinlichkeit. \n\nZur Erinnerung: $p(x,y) = p(y)p(x|y) = p(x)p(y|x)$\n:::\n\n\n\n\n::: {#exm-pmi}\n\n## Interpretation der PMI\n\nSei $p(x) = p(y) = 1/10$ und $p(x,y) = 1/10$. W√§ren $x$ und $y$ unabh√§ngig, dann w√§re $p^{\\prime}(x,y) = p(x)p(y) = 1/100$.\nDas Verh√§ltnis der Produkte der einzelnen Wahrscheinlichkeit zur gemeinsamen Wahrscheinlichkeit w√§re dann 1 und der Logarithmus von 1 ist 0. Das Verh√§ltnis von 1 entspricht also der Unabh√§ngigkeit. Ist das Verh√§ltnis z.B. 5, so zeigt das eine gewisse Abh√§ngigkeit an.\nIm obigen Beispiel gilt: $\\frac{1/20}{1/100}=5$.\n\n:::\n\n\nDie MI wird auch √ºber die sog. *Kullback-Leibler-Divergenz* definiert,\ndie die Differenz zwischen gemeinsamer Wahrscheinlichkeitsfunktion bzw. -dichte und dem Produkt der jeweiligen Randwahrscheinlichkeiten bzw. -dichte angibt.\n\n\n\n### Maximumentropie\n\n\n:::{#def-maxent}\n\n\n## Maximumentropie\n\nDie Verteilungsform, f√ºr die es die meisten M√∂glichkeiten (Pfade im Baumdiagramm) gibt,\nhat die h√∂chste Informationsentropie.\n\n:::\n\n@fig-muenz3 zeigt ein Baumdiagramm f√ºr einen 3-fachen M√ºnzwurf.\nIn den \"Bl√§ttern\" (Endknoten) sind die Ergebnisse des Experiments dargestellt\nsowie die Zufallsvariable $X$, die die Anzahl der \"Treffer\" (Kopf) fasst.\nWie man sieht, vereinen einige Werte der Zufallsvariable mehr Pfade auf sich als andere:\nDer Wert $X=1$ vereinigt 3 Pfade (von 8) auf sich; der Wert $X=3$ nur 1 Pfad.\n\n![Pfade im Baumdiagramm: 3-facher M√ºnzwurf](img/muenz3.png){#fig-muenz3}\n\n\n\n### Ilustration \n\n\nSagen wir, Sie stehen vor 5 Eimern und haben 10 Kieselsteine bei sich, die mit den Nummern 1 bis 10 beschriftet sind [@mcelreath_statistical_2020].\nWeil Sie nichts besseres zu tun haben, werfen Sie die Kiesel in die Eimer und zwar so, \ndass die Wahrscheinlichkeit f√ºr einen Kiesel in einen bestimmten Eimer zu landen f√ºr alle Eimer gleich ist.\nSie werfen also Ihre 10 Kiesel und betrachten das Ergebnis; die Kiesel sind jetzt in einem bestimmten (zuf√§lligen)\nArrangement auf die Eimer verteilt.\nJede Aufteilung (der 10 Kiesel in den 5 Eimern) ist gleich wahrscheinlich^[so √§hnlich wie mit den Lottozahlen] -- \ndie Wahrscheinlichkeit, dass alle 10 Kiesel in Eimer 1 landen ist also gleich hoch wie die Wahrscheinlichkeit,\ndass jeder Eimer einen Kiesel abkriegt.\nJetzt kommt's: Manche Arrangements k√∂nnen auf mehrere Arten erzielt werden als andere. \nSo gibt es nur *eine* Aufteilung f√ºr alle 10 Kiesel in einem Eimer (Teildiagramm a, in @fig-kiesel).\nAber es gibt 90 M√∂glichkeiten, die Kiesel so aufzuteilen, dass 2 in Eimer 2 landen, 8 in Eimer 4 und 2 in Eimer 4,\ns. Teildiagramm b in @fig-kiesel [@kurz_statistical_2021]. \nTeildiagramme c bis e zeigen, dass die Anzahl der Aufteilungen schnell astronomisch hoch wird,\nwenn sich die Kiesel \"gleichm√§√üiger\" auf die Eimer verteilen.\nDie gleichm√§√üigste Aufteilung (Diagramm e) hat die gr√∂√üte Zahl an m√∂glichen Anordnungen.\nEine Aufteilung der Kiesel auch als Pfad durch ein Baumdiagramm beschrieben werden.\n\nHier sind ein paar verschiedene Arrangements, deren Anzahl von Aufteilungen wir hier anschauen:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-9_5d70669a4be8a04f7828bcb0b8a21687'}\n\n```{.r .cell-code}\nd <-\n  tibble(a = c(0, 0, 10, 0, 0),\n         b = c(0, 1, 8, 1, 0),\n         c = c(0, 2, 6, 2, 0),\n         d = c(1, 2, 4, 2, 1),\n         e = 2) \nd\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|  a|  b|  c|  d|  e|\n|--:|--:|--:|--:|--:|\n|  0|  0|  0|  1|  2|\n|  0|  1|  2|  2|  2|\n| 10|  8|  6|  4|  2|\n|  0|  1|  2|  2|  2|\n|  0|  0|  0|  1|  2|\n\n</div>\n:::\n:::\n\n::: {.cell hash='word-embedding_cache/html/fig-kiesel_ef23d0da2ab08eb54c309418452a83d8'}\n::: {.cell-output-display}\n![Anzahl von Aufteilungen der 10 Kiesel in 5 Eimer](word-embedding_files/figure-html/fig-kiesel-1.png){#fig-kiesel width=672}\n:::\n:::\n\n\nHier sind die Wahrscheinlichkeitsverteilungen der 5 Arrangements^[Ist das nicht eine elegante Syntax?! Solomon Kurz, der Autor der Syntax, hielt sich nicht an die aktuelle Version von `dplyr`; `mutate_all` ist eigentlich √ºberholt zugunsten von `mutate` mit `across`, aber die Pr√§gnanz der Syntax hier ist schon beeindruckend, wie ich finde.]:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-10_f33e12b23079203272d79c0b96693cd5'}\n\n```{.r .cell-code}\nd %>% \n  mutate_all(~. / sum(.))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|  a|   b|   c|   d|   e|\n|--:|---:|---:|---:|---:|\n|  0| 0.0| 0.0| 0.1| 0.2|\n|  0| 0.1| 0.2| 0.2| 0.2|\n|  1| 0.8| 0.6| 0.4| 0.2|\n|  0| 0.1| 0.2| 0.2| 0.2|\n|  0| 0.0| 0.0| 0.1| 0.2|\n\n</div>\n:::\n:::\n\n\n\nDann kann man die Wahrscheinlichkeit einfach in Entropie umrechnen^[Syntax aus @kurz_statistical_2021]:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-11_3f4879960810008ace21c7c71e781897'}\n\n```{.r .cell-code}\nd %>% \n  mutate_all(~ . / sum(.)) %>% \n  gather() %>% \n  group_by(key) %>% \n  summarise(h = -sum(ifelse(value == 0, 0, value * log(value))))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|key |         h|\n|:---|---------:|\n|a   | 0.0000000|\n|b   | 0.6390319|\n|c   | 0.9502705|\n|d   | 1.4708085|\n|e   | 1.6094379|\n\n</div>\n:::\n:::\n\n\n\nDas `ifelse` dient nur dazu, eine Wahrscheinlichkeit von 0 eine Entropie von 0 zu verpassen^[Regel von L'Hopital], denn sonst w√ºrden wir ein Problem rennen, wenn wir $log(0)$ ausrechnen.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-12_f6d7e861f940b9ddc306bf96e6ec8a08'}\n\n```{.r .cell-code}\nlog(0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] -Inf\n```\n:::\n:::\n\n\n\n\n## Zufallstext erkennen\n\n\n### Entropie von Zufallstext\n\n\nKann man wohl Zufallstext maschinell erkennen? Sicher gibt es viele Ans√§tze,\num das Problem anzugehen.\nLassen Sie uns einen Ansatz erforschen. \nErforschen hei√üt, *wir* erforschen f√ºr *uns*, es handelt sich um eine didaktische √úbung, \ndas Ziel ist nicht, Neuland f√ºr die Menschheit zu betreten.\n\nAber zuerst m√ºssen wir √ºberlegen, was \"Zufallstext\" bedeuten soll.\n\n\nNehmen wir uns dazu zuerst einen richtigen Text, ein M√§rchen von H.C. Andersen zum Beispiel.\nNehmen wir das Erste aus der Liste in dem Tibble `hcandersen_de`, \"das Feuerzeug\".\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-13_32e6fcc8e59535f44e2ed4edd0b75d62'}\n\n```{.r .cell-code}\ndas_feuerzeug <-\n  hcandersen_de  %>% \n  filter(book == \"Das Feuerzeug\") %>% \n  unnest_tokens(input = text, output = word) %>% \n  pull(word) \n\nhead(das_feuerzeug)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"es\"         \"kam\"        \"ein\"        \"soldat\"     \"die\"       \n[6] \"landstra√üe\"\n```\n:::\n:::\n\n\n\nDas M√§rchen ist 2688 W√∂rter lang.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-14_71ba9954d21cfe317fc569a87ed0d5a9'}\n\n```{.r .cell-code}\nwortliste <- \nhcandersen_de  %>% \n  filter(book == \"Das Feuerzeug\") %>% \n  unnest_tokens(output = word, input = text) %>% \n  pull(word) %>% \n  unique()\n\nhead(wortliste)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"es\"         \"kam\"        \"ein\"        \"soldat\"     \"die\"       \n[6] \"landstra√üe\"\n```\n:::\n:::\n\n\n\nJetzt ziehen wir Stichproben (mit Zur√ºcklegen) aus dieser Liste und erstellen damit eine Art Zufallstext.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-15_abd203a54f3e8fcadbc38c5e4d37b3c1'}\n\n```{.r .cell-code}\nzufallstext <- \n  sample(x = wortliste, size = length(das_feuerzeug)*10^2, replace = TRUE)\nhead(zufallstext)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"hat\"    \"kreide\" \"ins\"    \"komme\"  \"seinen\" \"dort\"  \n```\n:::\n:::\n\n\n\nZ√§hlen wir, wie h√§ufig jedes Wort vorkommt:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-16_c3f27ed56ab922e01cb21196a2b2be9a'}\n\n```{.r .cell-code}\nzufallstext_count <-\ntibble(zufallstext = zufallstext) %>% \n  count(zufallstext)\n\nhead(zufallstext_count)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|zufallstext |   n|\n|:-----------|---:|\n|ab          | 356|\n|abend       | 386|\n|aber        | 347|\n|abflog      | 350|\n|abschlagen  | 388|\n|acht        | 379|\n\n</div>\n:::\n:::\n\n\n\nDer H√§ufigkeitsvektor von `wortliste` besteht nur aus Einsen, \nso haben wir ja gerade die Wortliste definiert:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-17_ae5696da43dc2786911b15218de0991f'}\n\n```{.r .cell-code}\nwortliste_count <-\ntibble(wortliste = wortliste) %>% \n  count(wortliste)\n\nhead(wortliste_count)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|wortliste  |  n|\n|:----------|--:|\n|ab         |  1|\n|abend      |  1|\n|aber       |  1|\n|abflog     |  1|\n|abschlagen |  1|\n|acht       |  1|\n\n</div>\n:::\n:::\n\n\n\nDaher ist ihre Informationsentropy maximal.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-18_753ce5784a3d82555be6bf2185b4b396'}\n\n```{.r .cell-code}\nentropy(wortliste_count$n, unit = \"log2\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9.47978\n```\n:::\n:::\n\n\n\n\nDie H√§ufigkeiten der W√∂rter in `zufallstext` hat eine hohe Entropie.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-19_f956583dbf79979ae6261b315979c689'}\n\n```{.r .cell-code}\nentropy(zufallstext_count$n, unit = \"log2\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9.47792\n```\n:::\n:::\n\n\n\nZ√§hlen wir die H√§ufigkeiten in der Geschichte \"Das Feuerzeug\".\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-20_d1c0f6047444fdc6daf45e48fa267dce'}\n\n```{.r .cell-code}\ndas_feuerzeug_count <-\n  tibble(text = das_feuerzeug) %>% \n  count(text)\n\nhead(das_feuerzeug_count)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|text       |  n|\n|:----------|--:|\n|ab         |  2|\n|abend      |  3|\n|aber       | 21|\n|abflog     |  1|\n|abschlagen |  1|\n|acht       |  1|\n\n</div>\n:::\n:::\n\nUnd berechnen dann die Entropie:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-21_6c93f2b7d0a030e4698ef9d5f0bb6ea9'}\n\n```{.r .cell-code}\nentropy(das_feuerzeug_count$n, unit = \"log2\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 8.075194\n```\n:::\n:::\n\n\n\nDer Zufallstext hat also eine h√∂here Entropie als der echte M√§rchentext.\nDer Zufallstext ist also gleichverteilter in den Worth√§ufigkeiten.\n\n\nPro Bit weniger Entropie halbiert sich die Anzahl der M√∂glichkeiten einer H√§ufigkeitsverteilung.\n\n\n\n### MI von Zufallstext\n\n\n\nLeft as an exercises for the reader^[[Vgl. hier](https://academia.stackexchange.com/questions/20084/is-using-the-phrase-is-left-as-an-exercise-for-the-reader-considered-good)] ü•≥.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Daten\n\n\n### Complaints-Datensatz\n\nDer Datensatz `complaints` stammt aus [dieser Quelle](https://www.consumerfinance.gov/data-research/consumer-complaints/).\n\nDen Datensatz `complaints` kann man [hier](https://github.com/EmilHvitfeldt/smltar/raw/master/data/complaints.csv.gz) herunterladen. Im Buch ist die Webseite nicht (direkt?) angegeben. Die Datei ist mit `gz` gepackt; `read_csv` sollte das automatisch entpacken. Achtung: Die Datei ist recht gro√ü.\n\n\n::: {.cell hash='word-embedding_cache/html/read-complaints-data_c409b292bb4630e8366ac1dd05232d84'}\n\n```{.r .cell-code}\nd_path <- \"https://github.com/EmilHvitfeldt/smltar/raw/master/data/complaints.csv.gz\"\ncomplaints <- read_csv(d_path)\n```\n:::\n\n\nGeschickter als jedes Mal die Datei herunterzuladen, ist es, sie einmal herunterzuladen, und dann lokal zu speichern,\netwa im Unterordner `data` des RStudio-Projektordners.\n\n\nNach dem Importieren wird der Datensatz in eine Tidy-Form gebracht (mit `unnest_tokens`) und dann verschachtelt, mit `nest`.\n\n\n### Complaints verk√ºrzt und geschachtelt\n\nUm ein Herumprobieren zu erleichtern, ist hier der Datensatz `complaints` in zwei verk√ºrzten Formen bereitgestellt:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-22_810f6c1f29ae34c487584999b350aecd'}\n\n```{.r .cell-code}\nnested_words2_path <- \"https://github.com/sebastiansauer/datascience-text/raw/main/data/nested_words2.rds\"\nnested_words3_path <- \"https://github.com/sebastiansauer/datascience-text/raw/main/data/nested_words3.rds\"\n```\n:::\n\n\n\n`nested_words2` enth√§lt die ersten 10% des Datensatz `nested_words`und ist gut 4 MB gro√ü (mit `gz` gezippt); er besteht aus ca. 11 Tausend Beschwerden.\n`nested_words3` enth√§lt nur die ersten 10 Beschwerden, was ihn gut zum Handhaben macht.\n\nBeide sind verschachtelt und aus `tidy_complaints` (s. [Kap. 5.1](https://smltar.com/embeddings.html#motivatingsparse)) hervorgegangen.\n\n\n\n::: {.cell hash='word-embedding_cache/html/read-rds-nested-data_c88ffa3ec00426f49ded9c22547b6571'}\n\n```{.r .cell-code}\nnested_words3 <- read_rds(nested_words3_path)\n```\n:::\n\n\n\nDas sieht dann so aus:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-23_5306c91bc18a5b8a67c20e5a2babc4e6'}\n\n```{.r .cell-code}\nnested_words3 %>% \n  head(3)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| complaint_id|words                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |\n|------------:|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|      3384392|systems   , inc       , is        , trying    , to        , collect   , a         , debt      , that      , is        , not       , mine      , not       , owed      , and       , is        , inaccurate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |\n|      3417821|i            , would        , like         , to           , request      , the          , of           , the          , following    , items        , from         , my           , credit       , report       , which        , are          , the          , result       , of           , my           , victim       , to           , identity     , theft        , this         , information  , does         , not          , to           , transactions , that         , i            , have         , made         , accounts     , that         , i            , have         , opened       , as           , the          , attached     , supporting   , documentation, can          , as           , such         , it           , should       , be           , blocked      , from         , on           , my           , credit       , report       , pursuant     , to           , section      , of           , the          , fair         , credit       , reporting    , act |\n|      3433198|over      , the       , past      , 2         , weeks     , i         , have      , been      , receiving , amounts   , of        , telephone , calls     , from      , the       , company   , listed    , in        , this      , complaint , the       , calls     , between   , xxxx      , xxxx      , and       , xxxx      , xxxx      , to        , my        , cell      , and       , at        , my        , job       , the       , company   , does      , not       , have      , the       , right     , to        , me        , at        , work      , and       , i         , want      , this      , to        , stop      , it        , is        , extremely , to        , be        , told      , 5         , times     , a         , day       , that      , i         , have      , a         , call      , from      , this      , collection, agency    , while     , at        , work                                                                                    |\n\n</div>\n:::\n:::\n\nWerfen wir einen Blick in den TExt der ersten Beschwerde des Datensatzes mit der ID `nested_words3_path$complaint_id[1]`.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-24_da7357e8851ee8124b1d54413e5698ae'}\n\n```{.r .cell-code}\nbeschwerde1_text <- nested_words3$words[[1]]\n```\n:::\n\n\nDas ist ein Tibble mit einer Spalte und 17 W√∂rtern; \nda wir schon auf Unigramme aufgeteilt haben, ist jedes Wort ein Element des Vektors `word`: \n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-25_4ee48c79fd485dee3c81dd5e28241ba1'}\n\n```{.r .cell-code}\nbeschwerde1_text %>% \n  head()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|word    |\n|:-------|\n|systems |\n|inc     |\n|is      |\n|trying  |\n|to      |\n|collect |\n\n</div>\n:::\n:::\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-26_9184357c6afde11114e5ce4e5c730121'}\n\n```{.r .cell-code}\nbeschwerde1_text$word\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"systems\"    \"inc\"        \"is\"         \"trying\"     \"to\"        \n [6] \"collect\"    \"a\"          \"debt\"       \"that\"       \"is\"        \n[11] \"not\"        \"mine\"       \"not\"        \"owed\"       \"and\"       \n[16] \"is\"         \"inaccurate\"\n```\n:::\n:::\n\n\n\n\n## Kommentare und Hilfestellungen\n\n\n\n\n\n\n### PMI berechnen\n\n\nRufen Sie sich die Definition der PMI ins Ged√§chtnis, s. @eq-pmi.\n\nMit R kann man die PMI z.B. so berechnen, s. `? pairwise_pmi` aus dem Paket `{widyr}`.\n\n\nZum Paket `widyr` von Robinson und Silge:\n\n>   This package wraps the pattern of un-tidying data into a wide matrix, performing some processing, then turning it back into a tidy form. This is useful for several mathematical operations such as co-occurrence counts, correlations, or clustering that are best done on a wide matrix.\n\n\n[Quelle](https://juliasilge.github.io/widyr/)\n\nErzeugen wir uns Dummy-Daten:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-27_6fbd3724100ce7df990284127e7712ff'}\n\n```{.r .cell-code}\ndat <- tibble(feature = rep(1:5, each = 2),\n              item = c(\"a\", \"b\",\n                       \"a\", \"c\",\n                       \"a\", \"c\",\n                       \"b\", \"e\",\n                       \"b\", \"f\"))\n\ndat\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| feature|item |\n|-------:|:----|\n|       1|a    |\n|       1|b    |\n|       2|a    |\n|       2|c    |\n|       3|a    |\n|       3|c    |\n|       4|b    |\n|       4|e    |\n|       5|b    |\n|       5|f    |\n\n</div>\n:::\n:::\n\n\nAus der Hilfe der Funktion:\n\n>   Find pointwise mutual information of pairs of items in a column, based on a \"feature\" column that links them together. This is an example of the spread-operate-retidy pattern.\n\nDie Argumente der Funktion sind:\n\n*item*\n\nItem to compare; will end up in item1 and item2 columns\n\n*feature*\t\n\nColumn describing the feature that links one item to others\n\n\nManche Berechnungen (Operationen) lassen sich vielleicht leichter nicht in der Tidy-Form (Langform), sondern in der \"breiten\" oder Matrixform ausf√ºhren.\nWandeln wir mal `dat` von der Langform in die Breitform um:\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-28_c48cdc131a6d6e4e5f3a254a5b0ac086'}\n\n```{.r .cell-code}\ntable(dat$item, dat$feature)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   \n    1 2 3 4 5\n  a 1 1 1 0 0\n  b 1 0 0 1 1\n  c 0 1 1 0 0\n  e 0 0 0 1 0\n  f 0 0 0 0 1\n```\n:::\n:::\n\n\nSilge und Robinson verdeutlichen das Prinzip von `widyr` so, s. @fig-widyr.\n\n\n![Die Funktionsweise von widyr, Quelle: Silge und Robinson](img/widyr.jpeg){#fig-widyr}\n\n(Vgl. auch die [Erkl√§rung hier](https://bookdown.org/Maxine/tidy-text-mining/counting-and-correlating-pairs-of-words-with-widyr.html).)\n\nBauen wir das mal von Hand nach.\n\n\n\nRandwahrscheinlichkeiten von `a` und `c` sowie deren Produkt, `p_a_p_c`:\n\n\n::: {.cell hash='word-embedding_cache/html/p_a_und_p_c_cb9d1c4dd674d63725e290cb7ecfe130'}\n\n```{.r .cell-code}\np_a <- 3/5\np_c <- 2/5\n\np_a_p_c <- p_a * p_c\np_a_p_c\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.24\n```\n:::\n:::\n\n\n\nGemeinsame Wahrscheinlichkeit von `a` und `c`:\n\n\n::: {.cell hash='word-embedding_cache/html/p_ac_9d3e2000f4997d5a67ea625b29577fc2'}\n\n```{.r .cell-code}\np_ac <- 2/5\n```\n:::\n\n\n\nPMI von Hand berechnet:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-29_9dcafe4fe8438a34869a324e9fe3ee32'}\n\n```{.r .cell-code}\nlog(p_ac/p_a_p_c)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5108256\n```\n:::\n:::\n\n\nMan beachte, dass hier als Basis $e$, der nat√ºrliche Logarithmus, verwendet wurde (nicht 2).\n\nJetzt berechnen wir die PMI mit `pairwise_pmi`.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-30_4c32a90400cbd80b70a90668a0632d56'}\n\n```{.r .cell-code}\npairwise_pmi(dat, item = item, feature = feature)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1 |item2 |        pmi|\n|:-----|:-----|----------:|\n|b     |a     | -0.5877867|\n|c     |a     |  0.5108256|\n|a     |b     | -0.5877867|\n|e     |b     |  0.5108256|\n|f     |b     |  0.5108256|\n|a     |c     |  0.5108256|\n|b     |e     |  0.5108256|\n|b     |f     |  0.5108256|\n\n</div>\n:::\n:::\n\n\nWie man sieht, entspricht unserer Berechnung von Hand der Berechnung mit `pairwise_pmi`. \n\n\n\n\n\n### Sliding\n\nSliding ist ein interessantes Konzept, aber man braucht vielleicht etwas Zeit, \num sein Hirn um das Konzept zu wickeln...\n\nHier eine Illustration:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-31_01b89f2ac57a47ab5158f42153a0f8a4'}\n\n```{.r .cell-code}\ntxt_vec <- \"Das ist ein Test, von dem nicht viel zu erwarten ist\"\n\nslider::slide(txt_vec, ~ .x, .before = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n[1] \"Das ist ein Test, von dem nicht viel zu erwarten ist\"\n```\n:::\n:::\n\n\n\nOh, da passiert nichts?! Kaputt? Nein, wir m√ºssen jedes Wort als *ein Element* des Vektors auffassen.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-32_3259e770d90e6ae2d000d73963062b8c'}\n\n```{.r .cell-code}\ntxt_df <-\n  tibble(txt = txt_vec) %>% \n  unnest_tokens(input = txt, output = word)\n\nhead(txt_df)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|word |\n|:----|\n|das  |\n|ist  |\n|ein  |\n|test |\n|von  |\n|dem  |\n\n</div>\n:::\n:::\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-33_a34ef1420c83a15cad31e783077d833e'}\n\n```{.r .cell-code}\nslider::slide(txt_df$word, ~ .x, .before = 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n[1] \"das\"\n\n[[2]]\n[1] \"das\" \"ist\"\n\n[[3]]\n[1] \"das\" \"ist\" \"ein\"\n\n[[4]]\n[1] \"ist\"  \"ein\"  \"test\"\n\n[[5]]\n[1] \"ein\"  \"test\" \"von\" \n\n[[6]]\n[1] \"test\" \"von\"  \"dem\" \n\n[[7]]\n[1] \"von\"   \"dem\"   \"nicht\"\n\n[[8]]\n[1] \"dem\"   \"nicht\" \"viel\" \n\n[[9]]\n[1] \"nicht\" \"viel\"  \"zu\"   \n\n[[10]]\n[1] \"viel\"     \"zu\"       \"erwarten\"\n\n[[11]]\n[1] \"zu\"       \"erwarten\" \"ist\"     \n```\n:::\n:::\n\n\n\nAh!\n\n\nDas Aufteilen in einzelne W√∂rter pro Element des Vektors k√∂nnte man auch so erreichen:\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-34_ac0cff5f7c2d5622e41c16e324ab0af8'}\n\n```{.r .cell-code}\ntxt_vec2 <- str_split(txt_vec, pattern = boundary(\"word\")) %>% \n  simplify() \n\nslide(txt_vec2, .f = ~.x, .before = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nShifting non-numeric variables is not possible.\n  Try using 'to_numeric()' and specify the 'lowest' argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Das\"      \"ist\"      \"ein\"      \"Test\"     \"von\"      \"dem\"     \n [7] \"nicht\"    \"viel\"     \"zu\"       \"erwarten\" \"ist\"     \n```\n:::\n:::\n\n\n\n\n\nIn unserem Beispiel mit den Beschwerden:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-35_432ef4c78ac17709b38ba41647dc4bc1'}\n\n```{.r .cell-code}\nslide(beschwerde1_text$word,  ~.x, .before = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nShifting non-numeric variables is not possible.\n  Try using 'to_numeric()' and specify the 'lowest' argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"systems\"    \"inc\"        \"is\"         \"trying\"     \"to\"        \n [6] \"collect\"    \"a\"          \"debt\"       \"that\"       \"is\"        \n[11] \"not\"        \"mine\"       \"not\"        \"owed\"       \"and\"       \n[16] \"is\"         \"inaccurate\"\n```\n:::\n:::\n\n\n\n\n### Funktion `slide_windows`\n\n\nDie Funktion `slide_windows` im [Kapitel 5.2](https://smltar.com/embeddings.html#understand-word-embeddings-by-finding-them-yourself) ist recht kompliziert. In solchen F√§llen ist es hilfreich, sich jeden Schritt einzeln ausf√ºhren zu lassen. Sind die Schritte in einer Funktion zusammengefasst, kann man mit `debug(fun)` sich die Schritte innerhalb der Funktion einzeln ausf√ºhren lassen.\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-36_af20fc2b859b43b702466e7af1d17cf2'}\n\n```{.r .cell-code}\nslide_windows <- function(tbl, window_size) {\n  skipgrams <- slider::slide(\n    tbl, \n    ~.x, \n    .after = window_size - 1, \n    .step = 1, \n    .complete = TRUE\n  )\n  \n  safe_mutate <- safely(mutate)\n  \n  out <- map2(skipgrams,\n              1:length(skipgrams),\n              ~ safe_mutate(.x, window_id = .y))\n  \n  out %>%\n    transpose() %>%\n    pluck(\"result\") %>%\n    compact() %>%\n    bind_rows()\n}\n```\n:::\n\n\n\n\nErschwerend kommt eine gro√üe Datenmenge und eine lange Berechnungszeit dazu, was das Debuggen (Nachvollziehen und Durchdenken) der Schritte zus√§tzlich erschwert.\nIn solchen F√§llen hilft die goldende Regel: Mach es dir so einfach wie m√∂glich (aber nicht einfacher).\nWir nutzen also den stark verkleinerten Datensatz `nested_words3`, den wir oben importiert haben.\n\n\nHier ist der Syntax-Auszug:\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-37_c4d73506a95449971503323235702761'}\n\n```{.r .cell-code}\nlibrary(widyr)\nlibrary(furrr)\n\nplan(multisession)  ## for parallel processing\n\n#debug(slide_windows)  # um sich die Schritte in `slide_windows` einzeln anzuschauen.\n\ntidy_pmi <- nested_words3 %>%  # <--- Kleiner Datensatz!\n  mutate(words = future_map(words, slide_windows, 4L)) %>%\n  unnest(words) %>%\n  unite(window_id, complaint_id, window_id) %>%\n  pairwise_pmi(word, window_id)\n\ntidy_pmi %>% \n  head()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1   |item2   |      pmi|\n|:-------|:-------|--------:|\n|inc     |systems | 5.728498|\n|is      |systems | 2.838126|\n|trying  |systems | 5.035351|\n|systems |inc     | 5.728498|\n|is      |inc     | 2.838126|\n|trying  |inc     | 5.035351|\n\n</div>\n:::\n:::\n\n\n\n\n### SVD\n\n\nDie *Singul√§rwertzerlegung* (singular value decomposition, SVD) ist ein Verfahren zur Verringerung der Spaltenzahl (Dimension), vergleichbar zur Faktorenanalyse.\nZur Anschaulichkeit - und ohne substanziellen Hintergrund - sei folgendes Beispiel genannt:\nDie Verben \"gehen\", \"rennen\", \"laufen\", \"schwimmen\", \"fahren\", \"rutschen\" k√∂nnten zu einer gemeinsamen Dimension, etwa \"fortbewegen\" reduziert werden.\nJedes einzelne der eingehenden Verben erh√§lt eine Zahl von 0 bis 1, das die konzeptionelle N√§he des Verbs\nzur \"dahinterliegenden\" Dimension (fortbewegen) quantifiziert; \ndie Zahl nennt man auch die \"Ladung\" des Items (Worts) auf die Dimension.\nSagen wir, wir identifizieren 10 Dimensionen.\nMan erh√§lt dann f√ºr jedes unique Wort im Corpus einen Vektor mit den Ladungen auf die Dimensionsen.\nIm genannten Beispiel w√§re es ein 10-stelliger Vektor.\nSo wie ein 3-stelliger Vektor die Position einer Biene im Raum beschreibt^[Man k√∂nnte erg√§nzen: plus eine 4. Dimension f√ºr Zeit, plus noch ein paar Weitere f√ºr die Beschleunigung in verschiedene Richtungen...],\nbeschreibt hier unser 10-stelliger Vektor die \"Position\" eines Worts in unserem *Einbettungsvektor*.\n\n\nDie Syntax dazu ist dieses Mal einfach:\n\n\n\n\n::: {.cell hash='word-embedding_cache/html/widely-svd_0d6a1d676a38c10b6e7d5d212db344ba'}\n\n```{.r .cell-code}\ntidy_word_vectors <- \n  tidy_pmi %>%\n  widely_svd(\n    item1, item2, pmi,\n    nv = 100\n  )\n\ntidy_word_vectors %>% \n  (head)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1   | dimension|      value|\n|:-------|---------:|----------:|\n|inc     |         1| -0.0378963|\n|is      |         1| -0.1132069|\n|trying  |         1| -0.0512764|\n|systems |         1| -0.0333332|\n|to      |         1| -0.1203434|\n|collect |         1| -0.0554211|\n\n</div>\n:::\n:::\n\n\n\nMit `nv = 100` haben wir die Anzahl (`n`) der Dimensionen (Variablen, `v`) auf 100 bestimmt.\n\n\n\n### Wort√§hnlichkeit\n\n\nJetzt, da wir mit der SVD jedes Wort in einem Koordinatensystem verortet haben, k√∂nnen wir die Abst√§nde der W√∂rter im Koordinatensystem bestimmen.\nDas geht mit Hilfe des alten Pythagoras, s. @fig-euklid-distance.\nDer Abstand, den man mit Hilfe des Satz des Pythagoras berechnet, nennt man auch *euklidische Distanz*.\n\n\n![Euklidische Distanz in 2D, Quelle: Wikipedia, CC BY4.0, Kmhkmh](img/euklid-distance.png){#fig-euklid-distance width=50%}\n\nOkay, wir sind in einem Raum mit vielen Dimensionen, was mein Hirn nicht mitmacht, [aber der Algebra ist das egal](https://mathworld.wolfram.com/Distance.html). \nPythagoras' Satz l√§sst sich genauso anwenden, wenn es mehr als Dimensionen sind.\n\n\n\n\n\nDie Autoren basteln sich selber eine Funktion in [Kap. 5.3](https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings),\naber der Einfachheit halber nehme ich (erstmal) die entsprechende Funktion aus `widyr`:\n\n\n\n::: {.cell hash='word-embedding_cache/html/pairwise-dist_177476962fa68331a32177a2dd2f332d'}\n\n```{.r .cell-code}\nword_neighbors <- \ntidy_word_vectors %>% \n  pairwise_dist(item1, dimension, value)\n\nword_neighbors %>% \n  head()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1   |item2 |  distance|\n|:-------|:-----|---------:|\n|is      |inc   | 1.0220141|\n|trying  |inc   | 0.9332851|\n|systems |inc   | 0.4161215|\n|to      |inc   | 1.0913872|\n|collect |inc   | 0.5221759|\n|a       |inc   | 1.0309566|\n\n</div>\n:::\n:::\n\n\n\nWas sind die Nachbarn von \"inaccurate\"?\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-38_13585c6203c526b381f3fee4416e06c2'}\n\n```{.r .cell-code}\nword_neighbors %>% \n  filter(item1 == \"inaccurate\") %>% \n  arrange(distance) %>% \n  head()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1      |item2 |  distance|\n|:----------|:-----|---------:|\n|inaccurate |mine  | 0.5248868|\n|inaccurate |score | 0.5310116|\n|inaccurate |oh    | 0.5400913|\n|inaccurate |ny    | 0.5400913|\n|inaccurate |dob   | 0.5801281|\n|inaccurate |cell  | 0.6093670|\n\n</div>\n:::\n:::\n\n\nHier ist die Datenmenge zu klein, um vern√ºnftige Schl√ºsse zu ziehen.\nAber \"incorrectly\", \"correct\", \"balance\" sind wohl plausible Nachbarn von \"inaccurate\".\n\n\n\n\n\n### Word-Embeddings vorgekocht: Glove6B\n\nIn [Kap. 5.4](https://smltar.com/embeddings.html#glove) schreiben die Autoren:\n\n>   If your data set is too small, you typically cannot train reliable word embeddings.\n\nEin paar Millionen W√∂rter sollte der Corpus schon enthalten, so die Autoren.\nDa solche \"Worteinbettungen\" (word embedings) aufw√§ndig zu erstellen sind, \nkann man fertige, \"vorgekochte\" Produkte nutzen.\n\nGlove6B wurde anhand von Wikipedia und anderen Datenquellen erstellt [@pennington_glove_2014].\n\n:::callout-note\nDie zugeh√∂rigen Daten sind recht gro√ü; f√ºr [`glove6b`](https://nlp.stanford.edu/projects/glove/) [@pennington_glove_2014] ist fast ein Gigabyte f√§llig.\nSie sollten sich die Daten in einem ruhigen Moment (mit stabiler Internetverbindung) herunterladen und in einem Verzeichnis meiner Wahl abgespeichert (`datasets`).\nDa bei mir Download abbrach, als ich `embedding_glove6b(dimensions = 100)` aufrief, habe ich die Daten manuell heruntergeladen, s.u.\n:::\n\n\n\n\n::: {.cell hash='word-embedding_cache/html/load-glove_04ef018bb908c2cd22a5a09c67ce0076'}\n\n```{.r .cell-code}\nglove6b <- embedding_glove6b(dir = \"~/datasets\", dimensions = 10, manual_download = TRUE)\nglove6b %>% \n  head()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|token |        d1|        d2|       d3|        d4|        d5|       d6|        d7|        d8|       d9|       d10|       d11|      d12|      d13|      d14|      d15|      d16|     d17|       d18|      d19|      d20|      d21|       d22|     d23|       d24|        d25|       d26|       d27|      d28|       d29|       d30|       d31|      d32|      d33|       d34|      d35|       d36|     d37|     d38|       d39|       d40|      d41|      d42|       d43|      d44|       d45|       d46|      d47|      d48|      d49|      d50|        d51|      d52|      d53|     d54|       d55|     d56|       d57|       d58|    d59|     d60|      d61|     d62|       d63|     d64|     d65|       d66|       d67|       d68|       d69|       d70|       d71|      d72|       d73|       d74|       d75|        d76|       d77|       d78|      d79|       d80|     d81|       d82|      d83|     d84|     d85|      d86|       d87|       d88|       d89|      d90|       d91|       d92|       d93|      d94|      d95|      d96|       d97|      d98|     d99|      d100|\n|:-----|---------:|---------:|--------:|---------:|---------:|--------:|---------:|---------:|--------:|---------:|---------:|--------:|--------:|--------:|--------:|--------:|-------:|---------:|--------:|--------:|--------:|---------:|-------:|---------:|----------:|---------:|---------:|--------:|---------:|---------:|---------:|--------:|--------:|---------:|--------:|---------:|-------:|-------:|---------:|---------:|--------:|--------:|---------:|--------:|---------:|---------:|--------:|--------:|--------:|--------:|----------:|--------:|--------:|-------:|---------:|-------:|---------:|---------:|------:|-------:|--------:|-------:|---------:|-------:|-------:|---------:|---------:|---------:|---------:|---------:|---------:|--------:|---------:|---------:|---------:|----------:|---------:|---------:|--------:|---------:|-------:|---------:|--------:|-------:|-------:|--------:|---------:|---------:|---------:|--------:|---------:|---------:|---------:|--------:|--------:|--------:|---------:|--------:|-------:|---------:|\n|the   | -0.038194| -0.244870| 0.728120| -0.399610|  0.083172| 0.043953| -0.391410|  0.334400| -0.57545|  0.087459|  0.287870| -0.06731|  0.30906| -0.26384| -0.13231| -0.20757| 0.33395| -0.338480| -0.31743| -0.48336| 0.146400| -0.373040| 0.34577|  0.052041|  0.4494600| -0.469710|  0.026280| -0.54155| -0.155180| -0.141070| -0.039722|  0.28277|  0.14393|  0.234640| -0.31021|  0.086173| 0.20397| 0.52624|  0.171640| -0.082378| -0.71787| -0.41531|  0.203350| -0.12763|  0.413670|  0.551870| 0.579080| -0.33477| -0.36559| -0.54857| -0.0628920|  0.26584|  0.30205| 0.99775| -0.804810| -3.0243|  0.012540| -0.369420| 2.2167| 0.72201| -0.24978| 0.92136|  0.034514| 0.46745| 1.10790| -0.193580| -0.074575|  0.233530| -0.052062| -0.220440|  0.057162| -0.15806| -0.307980| -0.416250|  0.379720|  0.1500600| -0.532120| -0.205500| -1.25260|  0.071624| 0.70565|  0.497440| -0.42063| 0.26148| -1.5380| -0.30223| -0.073438| -0.283120|  0.371040| -0.25217|  0.016215| -0.017099| -0.389840|  0.87424| -0.72569| -0.51058| -0.520280| -0.14590| 0.82780|  0.270620|\n|,     | -0.107670|  0.110530| 0.598120| -0.543610|  0.673960| 0.106630|  0.038867|  0.354810|  0.06351| -0.094189|  0.157860| -0.81665|  0.14172|  0.21939|  0.58505| -0.52158| 0.22783| -0.166420| -0.68228|  0.35870| 0.425680|  0.190210| 0.91963|  0.575550|  0.4618500|  0.423630| -0.095399| -0.42749| -0.165670| -0.056842| -0.295950|  0.26037| -0.26606| -0.070404| -0.27662|  0.158210| 0.69825| 0.43081|  0.279520| -0.454370| -0.33801| -0.58184|  0.223640| -0.57780| -0.268620| -0.204250| 0.563940| -0.58524| -0.14365| -0.64218|  0.0054697| -0.35248|  0.16162| 1.17960| -0.476740| -2.7553| -0.132100| -0.047729| 1.0655| 1.10340| -0.22080| 0.18669|  0.131770| 0.15117| 0.71310| -0.352150|  0.913480|  0.617830|  0.709920|  0.239550| -0.145710| -0.37859| -0.045959| -0.473680|  0.238500|  0.2053600| -0.189960|  0.325070| -1.11120| -0.363410| 0.98679| -0.084776| -0.54008| 0.11726| -1.0194| -0.24424|  0.127710|  0.013884|  0.080374| -0.35414|  0.349510| -0.722600|  0.375490|  0.44410| -0.99059|  0.61214| -0.351110| -0.83155| 0.45293|  0.082577|\n|.     | -0.339790|  0.209410| 0.463480| -0.647920| -0.383770| 0.038034|  0.171270|  0.159780|  0.46619| -0.019169|  0.414790| -0.34349|  0.26872|  0.04464|  0.42131| -0.41032| 0.15459|  0.022239| -0.64653|  0.25256| 0.043136| -0.194450| 0.46516|  0.456510|  0.6858800|  0.091295|  0.218750| -0.70351|  0.167850| -0.350790| -0.126340|  0.66384| -0.25820|  0.036542| -0.13605|  0.402530| 0.14289| 0.38132| -0.122830| -0.458860| -0.25282| -0.30432| -0.112150| -0.26182| -0.224820| -0.445540| 0.299100| -0.85612| -0.14503| -0.49086|  0.0082973| -0.17491|  0.27524| 1.44010| -0.212390| -2.8435| -0.279580| -0.457220| 1.6386| 0.78808| -0.55262| 0.65000|  0.086426| 0.39012| 1.06320| -0.353790|  0.483280|  0.346000|  0.841740|  0.098707| -0.242130| -0.27053|  0.045287| -0.401470|  0.113950|  0.0062226|  0.036673|  0.018518| -1.02130| -0.208060| 0.64072| -0.068763| -0.58635| 0.33476| -1.1432| -0.11480| -0.250910| -0.459070| -0.096819| -0.17946| -0.063351| -0.674120| -0.068895|  0.53604| -0.87773|  0.31802| -0.392420| -0.23394| 0.47298| -0.028803|\n|of    | -0.152900| -0.242790| 0.898370|  0.169960|  0.535160| 0.487840| -0.588260| -0.179820| -1.35810|  0.425410|  0.153770|  0.24215|  0.13474|  0.41193|  0.67043| -0.56418| 0.42985| -0.012183| -0.11677|  0.31781| 0.054177| -0.054273| 0.35516| -0.302410|  0.3143400| -0.338460|  0.717150| -0.26855| -0.158370| -0.474670|  0.051581| -0.33252|  0.15003| -0.129900| -0.54617| -0.378430| 0.64261| 0.82187| -0.080006|  0.078479| -0.96976| -0.57741|  0.564910| -0.39873| -0.057099|  0.197430| 0.065706| -0.48092| -0.20125| -0.40834|  0.3945600| -0.02642| -0.11838| 1.01200| -0.531710| -2.7474| -0.042981| -0.748490| 1.7574| 0.59085|  0.04885| 0.78267|  0.384970| 0.42097| 0.67882|  0.103370|  0.632800| -0.026595|  0.586470| -0.443320|  0.330570| -0.12022| -0.556450|  0.073611|  0.209150|  0.4339500| -0.012761|  0.089874| -1.79910|  0.084808| 0.77112|  0.631050| -0.90685| 0.60326| -1.7515|  0.18596| -0.506870| -0.702030|  0.665780| -0.81304|  0.187120| -0.018488| -0.267570|  0.72700| -0.59363| -0.34839| -0.560940| -0.59100| 1.00390|  0.206640|\n|to    | -0.189700|  0.050024| 0.190840| -0.049184| -0.089737| 0.210060| -0.549520|  0.098377| -0.20135|  0.342410| -0.092677|  0.16100| -0.13268| -0.28160|  0.18737| -0.42959| 0.96039|  0.139720| -1.07810|  0.40518| 0.505390| -0.550640| 0.48440|  0.380440| -0.0029055| -0.349420| -0.099696| -0.78368|  1.036300| -0.231400| -0.471210|  0.57126| -0.21454|  0.359580| -0.48319|  1.087500| 0.28524| 0.12447| -0.039248| -0.076732| -0.76343| -0.32409| -0.574900| -1.08930| -0.418110|  0.451200| 0.121120| -0.51367| -0.13349| -1.13780| -0.2876800|  0.16774|  0.55804| 1.53870|  0.018859| -2.9721| -0.242160| -0.924950| 2.1992| 0.28234| -0.34780| 0.51621| -0.433870| 0.36852| 0.74573|  0.072102|  0.279310|  0.925690| -0.050336| -0.858560| -0.135800| -0.92551| -0.339910| -1.039400| -0.067203| -0.2137900| -0.476900|  0.213770| -0.84008|  0.052536| 0.59298|  0.296040| -0.67644| 0.13916| -1.5504| -0.20765|  0.722200|  0.520560| -0.076221| -0.15194| -0.131340|  0.058617| -0.318690| -0.61419| -0.62393| -0.41548| -0.038175| -0.39804| 0.47647| -0.159830|\n|and   | -0.071953|  0.231270| 0.023731| -0.506380|  0.339230| 0.195900| -0.329430|  0.183640| -0.18057|  0.289630|  0.204480| -0.54960|  0.27399|  0.58327|  0.20468| -0.49228| 0.19974| -0.070237| -0.88049|  0.29485| 0.140710| -0.100900| 0.99449|  0.369730|  0.4455400|  0.289980| -0.137600| -0.56365| -0.029365| -0.412200| -0.252690|  0.63181| -0.44767|  0.243630| -0.10813|  0.251640| 0.46967| 0.37550| -0.236130| -0.141290| -0.44537| -0.65737| -0.042421| -0.28636| -0.288110|  0.063766| 0.202810| -0.53542|  0.41307| -0.59722| -0.3861400|  0.19389| -0.17809| 1.66180| -0.011819| -2.3737|  0.058427| -0.269800| 1.2823| 0.81925| -0.22322| 0.72932| -0.053211| 0.43507| 0.85011| -0.429350|  0.926640|  0.390510|  1.058500| -0.245610| -0.182650| -0.53280|  0.059518| -0.660190|  0.189910|  0.2883600| -0.243400|  0.527840| -0.65762| -0.140810| 1.04910|  0.513400| -0.23816| 0.69895| -1.4813| -0.24870| -0.179360| -0.059137| -0.080560| -0.48782|  0.014487| -0.625900| -0.323670|  0.41862| -1.08070|  0.46742| -0.499310| -0.71895| 0.86894|  0.195390|\n\n</div>\n:::\n:::\n\n\nIn eine Tidyform bringen:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-39_ae88ef4926dbf0717235dad48e2f63b7'}\n\n```{.r .cell-code}\ntidy_glove <- \n  glove6b %>%\n  pivot_longer(contains(\"d\"),\n               names_to = \"dimension\") %>%\n  rename(item1 = token)\n\nhead(tidy_glove)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1 |dimension |     value|\n|:-----|:---------|---------:|\n|the   |d1        | -0.038194|\n|the   |d2        | -0.244870|\n|the   |d3        |  0.728120|\n|the   |d4        | -0.399610|\n|the   |d5        |  0.083172|\n|the   |d6        |  0.043953|\n\n</div>\n:::\n:::\n\n\nGanz sch√∂n gro√ü: \n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-40_3a405c64566b9ad57665b95b558f4e5e'}\n\n```{.r .cell-code}\nobject.size(tidy_glove)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n983837536 bytes\n```\n:::\n:::\n\n\nIn Megabyte^[$1024 \\cdot 1024$ Byte, und $1024 =2^10$, daher $2^{10} \\cdot 2^{10} = 2^{20}$]\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-41_06aaab927a96383d01ee0e7000261ffa'}\n\n```{.r .cell-code}\nobject.size(tidy_glove) / 2^20\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n938.3 bytes\n```\n:::\n:::\n\n\nEinfacher und genauer geht es so:\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-42_6d7c9e0198f960ba3236a35152f35dff'}\n\n```{.r .cell-code}\npryr::object_size(tidy_glove)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n983.83 MB\n```\n:::\n:::\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-43_3ddadeebca76d766e2d9b29481c9fe43'}\n\n```{.r .cell-code}\npryr::mem_used()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n1.51 GB\n```\n:::\n:::\n\n\n\n\nUm Speicher zu sparen, k√∂nnte man `glove6b` wieder direkt l√∂schen, wenn man nur mit der Tidyform weiterarbeitet.\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-44_3aa443ae265214ee896682dbd4ffebd8'}\n\n```{.r .cell-code}\nrm(glove6b)\n```\n:::\n\n\n\n\nJetzt k√∂nnen wir wieder nach Nachbarn fragen, im euklidischen Sinne, wie oben.\nProbieren wir aus, welche W√∂rter nah zu \"inaccurate\" stehen.\n\n\n:::callout-note\nWie wir oben gesehen haben, ist der Datensatz riesig^[zugegeben, ein subjektiver Ausdruck],\nwas die Berechnungen (zeitaufw√§ndig) und damit nervig machen k√∂nnen.\nDar√ºber hinaus kann es n√∂tig sein, dass Sie mehr Speicher auf Ihrem Computer zur Verf√ºgung stellen m√ºssen^[Kaufen...].\nWir m√ºssen noch `maximum_size = NULL`, um das Jonglieren mit riesigen Matrixen zu erlauben.\nM√∂ge der Gott der RAMs und Arbeitsspeicher uns gn√§dig sein!\n:::\n\n\n\n\n\nMit `pairwise_dist` dauert die Berechnung sehr lange und braucht wohl sehr viel Speicher.\nMitunter kam folgender Fehler auf: \"R error: vector memory exhausted (limit reached?)\".\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-45_6f9c4e71aa051dca4041fa4efec69e9f'}\n\n```{.r .cell-code}\nword_neighbors_glove6b <- \ntidy_glove %>% \n  slice_head(prop = .1) %>% \n  pairwise_dist(item1, dimension, value, maximum_size = NULL)\n\nhead(word_neighbors_glove6b)\n\ntidy_glove %>% \n  filter(item1 == \"inaccurate\") %>% \n  arrange(-value) %>% \n  slice_head(n = 5)\n```\n:::\n\n\n\n\nDeswegen probieren wir doch die Funktion `nearest_neighbors`, so wies im Buch vorgeschlagen wird.\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-46_48c2033e8dc510db68657668a44d4129'}\n\n```{.r .cell-code}\nnearest_neighbors <- function(df, token) {\n  df %>%\n    widely(\n      ~ {\n        y <- .[rep(token, nrow(.)), ]\n        res <- rowSums(. * y) / \n          (sqrt(rowSums(. ^ 2)) * sqrt(sum(.[token, ] ^ 2)))\n        matrix(res, ncol = 1, dimnames = list(x = names(res)))\n      },\n      sort = TRUE,\n      maximum_size = NULL\n    )(item1, dimension, value) %>%\n    select(-item2)\n}\n```\n:::\n\n::: {.cell hash='word-embedding_cache/html/tidy-glove-nearest-neighbors_05b693e829b70dcc6e4b599ceb0a4ab8'}\n\n```{.r .cell-code}\ntidy_glove %>%\n  # slice_head(prob = .1) %>% \n  nearest_neighbors(\"error\") %>% \n  head()\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|item1     |     value|\n|:---------|---------:|\n|error     | 1.0000000|\n|errors    | 0.7916719|\n|mistake   | 0.6641135|\n|correct   | 0.6205814|\n|incorrect | 0.6132556|\n|fault     | 0.6068035|\n\n</div>\n:::\n:::\n\n\n\nEntschachteln wir unsere Daten zu `complaints`: \n\n\n\n::: {.cell hash='word-embedding_cache/html/unnest-tidy-complaints3_57759d8c6482927be07e0a20a76e8e46'}\n\n```{.r .cell-code}\ntidy_complaints3 <-\n  nested_words3 %>% \n  unnest(words)\n```\n:::\n\n\n\n\nDann erstellen wir uns eine Tabelle, in der nur die Schnittmenge der W√∂rter aus den Beschwerden und Glove vorkommen.\nDazu nutzen winr einen [inneren Join](https://github.com/gadenbuie/tidyexplain/blob/main/images/inner-join.gif)\n\n![Inner Join, Quelle: Garrick Adenbuie](img/inner-join.gif)\n\n[Quelle](https://github.com/gadenbuie/tidyexplain)\n\n\n\n\n::: {.cell hash='word-embedding_cache/html/join-complaints-glove_7e7e9d1b161457af12ef8d773a573e2f'}\n\n```{.r .cell-code}\ncomplaints_glove <- \ntidy_complaints3 %>% \n  inner_join(by = \"word\", \n  tidy_glove %>% \n  distinct(item1) %>% \n  rename(word = item1)) \n\nhead(complaints_glove)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| complaint_id|word    |\n|------------:|:-------|\n|      3384392|systems |\n|      3384392|inc     |\n|      3384392|is      |\n|      3384392|trying  |\n|      3384392|to      |\n|      3384392|collect |\n\n</div>\n:::\n:::\n\n\nWie viele unique (distinkte) W√∂rter gibt es in unserem Corpus?\n\n\n::: {.cell hash='word-embedding_cache/html/tidy_complaints3_distinct_words_n_46d25d8395197d57ba7f62e8a684053b'}\n\n```{.r .cell-code}\ntidy_complaints3_distinct_words_n <- \ntidy_complaints3 %>% \n  distinct(word) %>% \n  nrow()\n\ntidy_complaints3_distinct_words_n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 222\n```\n:::\n:::\n\n\n\nIn `tidy_complaints` gibt es √ºbrigens 222 verschiedene W√∂rter.\n\n\n\n\n::: {.cell hash='word-embedding_cache/html/word_matrix_515d7820fa89ea3207aa9996d743b1c2'}\n\n```{.r .cell-code}\nword_matrix <- tidy_complaints3 %>%\n  inner_join(by = \"word\",\n             tidy_glove %>%\n               distinct(item1) %>%\n               rename(word = item1)) %>%\n  count(complaint_id, word) %>%\n  cast_sparse(complaint_id, word, n)\n\n#word_matrix\n```\n:::\n\n\n`word_matrix` z√§hlt f√ºr jede der 10 Beschwerden, welche W√∂rter (und wie h√§ufig) vorkommen.\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-47_41663adad6f1f8484f93386aacd77d66'}\n\n```{.r .cell-code}\ndim(word_matrix)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  10 222\n```\n:::\n:::\n\n\n10 Beschwerden (Dokumente) und 222 unique W√∂rter.\n\n\n\n::: {.cell hash='word-embedding_cache/html/glove_matrix_eb9668131fa8217619c77afb1d502521'}\n\n```{.r .cell-code}\nglove_matrix <- tidy_glove %>%\n  inner_join(by = \"item1\",\n             tidy_complaints3 %>%\n               distinct(word) %>%\n               rename(item1 = word)) %>%\n  cast_sparse(item1, dimension, value)\n\n#glove_matrix\n```\n:::\n\n\n\n`glove_matrix` gibt f√ºr jedes unique Wort den Einbettungsvektor an.\n\n\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-48_6110adb674068746b9e82e25ea504825'}\n\n```{.r .cell-code}\ndim(glove_matrix)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 222 100\n```\n:::\n:::\n\n\nDas sind 222 unique W√∂rter und 100 Dimensionen des Einbettungsvektors.\n\n\n\nJetzt k√∂nnen wir noch pro Dokument (10 in diesem Beispiel) die mittlere \"Position\" jedes Dokuments im Einbettungsvektor ausrechnen.\nBildlich gesprochen: Was ist der mittlere Raumpunkt (Zentroid) des Bienenschwarms, wobei eine Biene ein Dokument darstellt und die Raumachsen die Dimensionen des Einbettungsvektors.\n\nDazu gewichten wir jedes Wort eines Dokuments mit den Ladungen des Einbettungsvektor und summieren diese Terme.\nEs resultiert eine Matrix mit einem Einbettungsvektor pro Dokument.\nDiese Matrix k√∂nnen wir jetzt als Pr√§diktorenmatrix hernehmen.\n\n\n::: {.cell hash='word-embedding_cache/html/doc_matrix_0d6b8b779ddfebe4003e7986bb8f3e2f'}\n\n```{.r .cell-code}\ndoc_matrix <- word_matrix %*% glove_matrix\n#doc_matrix %>% head()\n```\n:::\n\n::: {.cell hash='word-embedding_cache/html/unnamed-chunk-49_5d19f865977e601841ec3de61f5a5178'}\n\n```{.r .cell-code}\ndim(doc_matrix)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  10 100\n```\n:::\n:::\n\n\n\nDie Anzahl der Dokumente ist 10 und die Anzahl der Dimensionen (des Einbettungsvektors) ist 100.\n\n\n## Fazit\n\nWorteinbettungen sind eine aufw√§ndige Angelegenheit. \nPositiv gesprochen kann ein Analysti die Muskeln spielen lassen und zeigen, was sie oder er so alles drauf hat.\nIst ja schon cooles Zeugs, die Word Embeddings.\nEs besteht die Chance, dass man mit dieser Methode bessere Vorhersagen erreicht, als mit anderen, einfachen\nAns√§tzen wir Worth√§ufigkeiten oder tf-idf.\nAuf der anderen Seite ist es oft sinnvoll, mit einfachen Ans√§tzen zu starten,\nund zu sehen, wie weit man kommt.\nVielleicht ja weit genug.\n\n\n\n\n\n\n## Literatur\n\n\n### Wikipedia\n\nEs gibt eine Reihe n√ºtzlicher (und recht informationsdichter) Wikipedia-Eintr√§ge zum Thema Informationstheorie.\n\n- [Wikipedia: Pointwise Mutual Information](https://en.wikipedia.org/wiki/Pointwise_mutual_information)\n- [Wikipedia: Mutual information](https://en.wikipedia.org/wiki/Mutual_information)\n- [Wikipedia: Information theory](https://en.wikipedia.org/wiki/Information_theory)\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}