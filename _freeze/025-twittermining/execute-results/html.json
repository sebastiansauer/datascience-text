{
  "hash": "01ff4d0c3cdc69a2a52321d813f62b4c",
  "result": {
    "markdown": "\n\n\n![Text als Datenbasis pr√§diktiver Modelle](img/text-mining-1476780_640.png){width=10%}\n\nBild von <a href=\"https://pixabay.com/de/users/mcmurryjulie-2375405/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780\">mcmurryjulie</a> auf <a href=\"https://pixabay.com/de//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780\">Pixabay</a>\n\n# Twitter Mining\n\n\n\n## Vorab\n\n\n### Lernziele\n\n\n- Twitterdaten via API von Twitter auslesen\n\n\n\n### Vorbereitung\n\n- Lesen Sie in @smltar Kap. 1.\n- Legen Sie sich ein Konto bei [Github](https://github.com/) an.\n- Legen Sie sich ein Konto bei [Twitter](twitter.com) an.\n- Lesen Sie [diesen Artikel zur Anmeldung bei der Twitter API](https://docs.ropensci.org/rtweet/articles/auth.html)^[Sie k√∂nnen [hier](https://www.howtogeek.com/343877/what-is-an-api/) nachlesen, was eine API ist.]\n\n\n\n\n### Ben√∂tigte R-Pakete\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-1_3acc0511e641244d5769b89ee262a5ed'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(rtweet)\nlibrary(rio)  \nlibrary(glue)\nlibrary(tweetbotornot)  # optional\nlibrary(keyring)  # optional\nlibrary(askpass)  # optional\nlibrary(academictwitteR)\n```\n:::\n\n\n![R-Paket {rtweet}](https://docs.ropensci.org/rtweet/logo.png){width=10%}\n\n\nEinen √úberblick √ºber die Funktionen des Pakets (function reference) findet sich [hier](https://docs.ropensci.org/rtweet/reference/index.html).\n\n\n\n## Anmelden bei Twitter\n\n\n### Welche Accounts interessieren uns? {#sec-politicians-accounts}\n\n\nHier ist eine (subjektive) Auswahl von deutschen Politikern^[Stand November 2022],\ndie einen Startpunkt gibt zur Analyse von Art und Ausma√ü von Hate Speech gerichtet an deutsche Politiker:innen.\n\n\n::: {.cell hash='025-twittermining_cache/html/politicians-df-load_fc98929c4753a2af23bf86958763e19c'}\n\n```{.r .cell-code}\nd_path <- \"data/twitter-german-politicians.csv\"\n\npoliticians <- import(d_path)\npoliticians\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"party\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"screenname\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"comment\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"Karl Lauterbach\",\"2\":\"SPD\",\"3\":\"Karl_Lauterbach\",\"4\":\"NA\",\"_rn_\":\"1\"},{\"1\":\"Olaf Scholz\",\"2\":\"SPD\",\"3\":\"OlafScholz\",\"4\":\"NA\",\"_rn_\":\"2\"},{\"1\":\"Annalena Baerback\",\"2\":\"Gruene\",\"3\":\"ABaerbock\",\"4\":\"NA\",\"_rn_\":\"3\"},{\"1\":\"Bundesministerium f√ºr Wirtschaft und Klimaschutz\",\"2\":\"Gruene\",\"3\":\"BMWK\",\"4\":\"Robert Habeck ist der Minister im BMWK\",\"_rn_\":\"4\"},{\"1\":\"Friedrich Merz\",\"2\":\"CDU\",\"3\":\"_FriedrichMerz\",\"4\":\"CDU-Chef\",\"_rn_\":\"5\"},{\"1\":\"Markus S√∂der\",\"2\":\"CSU\",\"3\":\"Markus_Soeder\",\"4\":\"CSU-Chef\",\"_rn_\":\"6\"},{\"1\":\"Cem √ñzdemir\",\"2\":\"Gruene\",\"3\":\"cem_oezdemir\",\"4\":\"BMEL\",\"_rn_\":\"7\"},{\"1\":\"Janine Wissler\",\"2\":\"Linke\",\"3\":\"Janine_Wissler\",\"4\":\"Linke-Chefin\",\"_rn_\":\"8\"},{\"1\":\"Martin Schirdewan\",\"2\":\"Linke\",\"3\":\"schirdewan\",\"4\":\"Linke-Chef\",\"_rn_\":\"9\"},{\"1\":\"Christian Lindner\",\"2\":\"FDP\",\"3\":\"c_lindner\",\"4\":\"FDP-Chef\",\"_rn_\":\"10\"},{\"1\":\"Marie-Agnes Strack-Zimmermann\",\"2\":\"FDP\",\"3\":\"MAStrackZi\",\"4\":\"Vorsitzende Verteidigungsausschuss\",\"_rn_\":\"11\"},{\"1\":\"Tino Chrupalla\",\"2\":\"AFD\",\"3\":\"Tino_Chrupalla\",\"4\":\"AFD-Bundessprecher\",\"_rn_\":\"12\"},{\"1\":\"Alice Weidel\",\"2\":\"AFD\",\"3\":\"Alice_Weidel\",\"4\":\"AFD-Bundessprecherin\",\"_rn_\":\"13\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n### Twitter App erstellen\n\n[Tutorial](https://cran.r-project.org/web/packages/rtweet/vignettes/auth.html)\n\n[Auf der Twitter Developer Seite](https://developer.twitter.com/en/portal/dashboard) k√∂nnen Sie sich ein Konto erstellen und dann anmelden.\n\n\n### Intro\n\nDie Seite von [rtweet](https://docs.ropensci.org/rtweet/) gibt eine gute Starthilfe in die Benutzung des Pakets.\n\n\n### Zugangsdaten\n\n\nZugangsdaten sollte man gesch√ºtzt speichern, also z.B. *nicht* in einem geteilten Ordner.\n\n\n\n::: {.cell hash='025-twittermining_cache/html/source-credentials-twitter_d52572e52037992263b2a558867ff239'}\n\n```{.r .cell-code}\nsource(\"/Users/sebastiansaueruser/credentials/hate-speech-analysis-v01-twitter.R\")\n```\n:::\n\n\n\nAnmelden:\n\n\n::: {.cell hash='025-twittermining_cache/html/oauth-twitter_77beed63775e2a57adc491527b36d9be'}\n\n```{.r .cell-code}\nauth <- rtweet_bot(api_key = API_Key,\n                   api_secret = API_Key_Secret,\n                   access_token = Access_Token,\n                   access_secret = Access_Token_Secret)\n```\n:::\n\n\n\n\n\n\n\nAlternativ kann man sich auch als `App` anmelden,\ndamit kann man z.B. nicht posten, aber daf√ºr mehr herunterladen [Quelle](https://docs.ropensci.org/rtweet/articles/auth.html).\n\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-2_e87079d4d4d99fd57b6631b4b6db6898'}\n\n```{.r .cell-code}\nauth <- rtweet_app(bearer_token = Bearer_Token)\n```\n:::\n\n\n\nJetzt haben wir ein Anmeldeobjekt, \ndas wir f√ºr die weiteren Anfragen dieser Session nutzen k√∂nnen.\nDas sagen wir jetzt der Twitter-API:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-3_091e4826beb72262c1b0a401034980fc'}\n\n```{.r .cell-code}\nauth_as(auth)\n```\n:::\n\n\n\nInfos √ºber Ihre aktuellen Raten kann man sich mittels\n`rate_limit()` ausgeben lassen.\n\n\n### Sch√ºtzen Sie Ihre Zugangsdaten\n\n\nAchtung, Sicherheitshinweis ...\nPassw√∂rter und andere sensitive (Anmelde-)Informationen muss man sch√ºtzen,\ndas wei√ü jeder.\nKonkret bedeutet es, dass Sie diese Daten *nicht* in einem √∂ffentlichen oder\ngeteilten Repo herumliegen lassen.\nAchten Sie auch darauf, dass, wenn Sie diese Information `source`en,\nso wie ich gerade, diese dann ungesch√ºtzt in Ihrem RStudio  `Environment` Fenster\nzu sehen sind. Falls Sie also den Bildschirm teilen,\noder Ihnen jemand √ºber die Schulter schaut,\nsind Ihre Zugangsdaten nicht gesch√ºtzt.\n\n\nEin √§hnlicher Fehler w√§re, die History-Dateien von R in ein √∂ffentliches Repo einzustellen (z.B. via Git).\nIn der Datei `.gitignore` sollten  daher folgende Dateien aufgef√ºhrt sein:\n\n```\n.Rhistory\n.Rapp.history\n````\n\n[Ein Rat von `rtweet` dazu](https://docs.ropensci.org/rtweet/articles/auth.html):\n\n>   It‚Äôs good practice to only provide secrets interactively, because that makes it harder to accidentally share them in either your .Rhistory or an .R file.\n\n\nEinen alternativen, sichereren Zugang bietet z.B. das [Paket `keyring`](https://r-lib.github.io/keyring/index.html).\nDieses Paket bietet eine Anbindung zur Schl√ºsselbundverwaltung Ihres Betriebssystems:\n\n\n>   Platform independent API to access the operating systems credential store. \n\n\nIm MacOS wird die zentrale Schl√ºsselbundverwaltung genutzt, in Windows und Linux die analoge Vorrichtungen.\n\n\nWir erstellen uns einen Schl√ºsselbund:\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-4_6c965b2c6d5e107abd9f991d07c4c695'}\n\n```{.r .cell-code}\nkeyring_create(keyring = \"hate-speech-twitter\")\n```\n:::\n\n\n\nDann k√∂nnen wir einen Eintrag im Schl√ºsselbund erstellen.\nEs √∂ffnet sich eine Maske, die nach einem Passwort fragt.\nGeben Sie dort die sensitiven Informationen ein, etwa die Client-ID.\nGgf. werden Sie noch nach dem Passwort des Schl√ºsselbunds an sich gefragt^[was beruhigend ist: Man darf nicht ohne Erlaubnis in Ihrer Passwort-Sammlung herumfuhrwerken.]\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-5_a856a4903f2ce1423d7e8c8e70a43303'}\n\n```{.r .cell-code}\nkey_set(service = \"client_id\",\n        keyring = \"hate-speech-twitter\")\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-6_510f82bf753bdd86eb8695855abaf353'}\n\n```{.r .cell-code}\nkey_set(service = \"client_secret\",\n        keyring = \"hate-speech-twitter\")\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-7_e316f35c494efdc07273eb6aeec8353a'}\n\n```{.r .cell-code}\nkey_set(service = \"bearer_token\",\n        keyring = \"hate-speech-twitter\")\n```\n:::\n\n\n\n\n\nK√ºnftig k√∂nnen wir dann die Passw√∂rter aus dem Schl√ºsselbund abrufen:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-8_047c473d3edfbd4f46c4ca5b8147c79a'}\n\n```{.r .cell-code}\nkey_get(service = \"client_id\",\n        keyring = \"hate-speech-twitter\")\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-9_366547e707dc5c4b09b589198cabc795'}\n\n```{.r .cell-code}\nkey_get(service = \"bearer_token\",\n        keyring = \"hate-speech-twitter\")\n```\n:::\n\n\n## Tweets einlesen\n\n\nZu beachten ist, dass es Limits gibt, wie viele Informationen (pro Zeiteinheit) man √ºber die Twitter-API auslesen darf.\nInformationen dazu findet man z.B. [hier](https://developer.twitter.com/en/docs/twitter-api/rate-limits) oder auch mit `rate_limit()`.\n\n\n\n\n\nEin g√§ngiges Limit der Twitter-API sind 900 Anfragen (z.B. Tweets auslesen) pro 15 Minuten.\n\n### Timeline einlesen einzelner Accounts\n\nMal ein paar Tweets zur Probe:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-10_5f74de80980402176e53b11f5b8831be'}\n\n```{.r .cell-code}\nsesa_test <- get_timeline(user = \"sauer_sebastian\", n = 3) %>% \n  select(full_text)\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-11_a7f57d898ae7ee2591226b64bc2a8549'}\n\n```\n## RT @pia_lamberty: Ein Ansatz, der sich beim Debunking wissenschaftlich als erfolgreich herausgestellt hat, ist das sog. Faktensandwich: htt‚Ä¶\n## RT @ianbremmer: sure, it‚Äôs the hottest summer europe has ever had in history \n## \n## but look at the upside\n## \n## it‚Äôs one of the coolest summers euro‚Ä¶\n## RT @twisteddoodles: Balanced news reporting https://t.co/O1iiItEQrs\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/get-timeline1_361a2f4a404bb7fd9013a270e193444c'}\n\n```{.r .cell-code}\ntweets <- get_timeline(user = politicians$screenname)\nsaveRDS(tweets, file = \"data/tweets/tweets01.rds\")\n```\n:::\n\n\n\n[Michael Kearney](https://rtweet-workshop.mikewk.com/#25) r√§t uns:\n\n>   PRO TIP #4: (for developer accounts only) Use `bearer_token()` to increase rate limit to 45,000 per fifteen minutes.\n\n### Retweets einlesen\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/get-retweets1_280a336c44d172797fc0db2d35e7ccf5'}\n\n```{.r .cell-code}\ntweets01_retweets <- \n  tweets$id_str %>% \n  head(3) %>% \n  map_dfr( ~ get_retweets(status_id = .x, retryonratelimit = TRUE))\n```\n:::\n\n\n\n\nDa die meisten Retweets aber nix sagen, sondern nur auf das einen Tweet wiederholen, ist das Sammeln der Retweets ziemlich langweilig.\n\n\nM√∂chte man `retry on rate limit` im Standard auf `TRUE` setzen, \nso kann man das √ºber die Optionen von R tun.\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-12_ea0a51dbaea3e5c6b650a8486a1711fa'}\n\n```{.r .cell-code}\noptions(rtweet.retryonratelimit = TRUE)\n```\n:::\n\n\n\n\n### EPINetz Twitter Politicians 2021\n\n\n@konig_epinetz_2022 [Volltext hier](https://link.springer.com/article/10.1007/s11615-022-00405-7) haben einen Datensatz mit knapp 2500 Twitter Accounts deutscher Politiker zusammengestellt, zum Stand 2021.\n\n\nDer Datensatz kann √ºber [Gesis](https://search.gesis.org/research_data/SDN-10.7802-2415?doi=10.7802/2415) bezogen werden.\n\nAuf der gleichen Seite findet sich auch eine [Dokumentation des Vorgehens](https://access.gesis.org/sharing/2415/3675).\n\nNachdem wir den Datensatz heruntergeladen haben, k√∂nnen wir ihn einlesen:\n\n\n::: {.cell hash='025-twittermining_cache/html/read-epinetz_eef141a2cb040b38c743c1af47647459'}\n\n```{.r .cell-code}\npoliticians_path <- \"data/tweets/EPINetz_TwitterPoliticians_2021.RDs\"\npoliticians_twitter <- read_rds(politicians_path)\n\nhead(politicians_twitter)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"ID\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"official_name\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"party\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"region\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"institution\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"office\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"user_id\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"twitter_name\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"twitter_handle\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"from\"],\"name\":[10],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"until\"],\"name\":[11],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"year_of_birth\"],\"name\":[12],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"abgeordnetenwatch_id\"],\"name\":[13],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"gender\"],\"name\":[14],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"wikidata_id\"],\"name\":[15],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"535\",\"2\":\"Manja Sch√ºle\",\"3\":\"SPD\",\"4\":\"Brandenburg\",\"5\":\"State Parliament\",\"6\":\"Parliamentarian\",\"7\":\"827090742162100224\",\"8\":\"Manja Sch√ºle\",\"9\":\"ManjaSchuele\",\"10\":\"2019-09-25\",\"11\":\"<NA>\",\"12\":\"1976\",\"13\":\"146790\",\"14\":\"female\",\"15\":\"Q40974942\"},{\"1\":\"962\",\"2\":\"Petra Pau\",\"3\":\"DIE LINKE\",\"4\":\"Federal\",\"5\":\"Federal Parliament\",\"6\":\"Parliamentarian\",\"7\":\"1683845126\",\"8\":\"Team PetraPau\",\"9\":\"TeamPetraPau\",\"10\":\"2017-10-24\",\"11\":\"<NA>\",\"12\":\"1963\",\"13\":\"79091\",\"14\":\"female\",\"15\":\"Q77195\"},{\"1\":\"864\",\"2\":\"Dagmar Schmidt\",\"3\":\"SPD\",\"4\":\"Federal\",\"5\":\"Federal Parliament\",\"6\":\"Parliamentarian\",\"7\":\"1377117206\",\"8\":\"Team #dieschmidt\",\"9\":\"TeamDieSchmidt\",\"10\":\"2017-10-24\",\"11\":\"<NA>\",\"12\":\"1973\",\"13\":\"79036\",\"14\":\"female\",\"15\":\"Q15433815\"},{\"1\":\"2517\",\"2\":\"Bernd Buchholz\",\"3\":\"FDP\",\"4\":\"Schleswig-Holstein\",\"5\":\"State Parliament\",\"6\":\"Parliamentarian\",\"7\":\"1073605033\",\"8\":\"Bernd Buchholz\",\"9\":\"BerndBuchholz\",\"10\":\"2017-06-06\",\"11\":\"<NA>\",\"12\":\"1961\",\"13\":\"121092\",\"14\":\"male\",\"15\":\"Q823715\"},{\"1\":\"1378\",\"2\":\"Ingrid Remmers\",\"3\":\"DIE LINKE\",\"4\":\"Federal\",\"5\":\"Federal Parliament\",\"6\":\"Parliamentarian\",\"7\":\"551802475\",\"8\":\"Ingrid Remmers MdB\",\"9\":\"ingrid_remmers\",\"10\":\"2017-10-24\",\"11\":\"<NA>\",\"12\":\"1965\",\"13\":\"120775\",\"14\":\"female\",\"15\":\"Q1652660\"},{\"1\":\"1116\",\"2\":\"Reinhard Brandl\",\"3\":\"CSU\",\"4\":\"Federal\",\"5\":\"Federal Parliament\",\"6\":\"Parliamentarian\",\"7\":\"262730721\",\"8\":\"Reinhard Brandl\",\"9\":\"reinhardbrandl\",\"10\":\"2017-10-24\",\"11\":\"<NA>\",\"12\":\"1977\",\"13\":\"79427\",\"14\":\"male\",\"15\":\"Q111160\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nDann lesen wir die Timelines (die Tweets) dieser Konten aus;\nin diesem Beispiel nur 10 Tweets pro Account:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/get-timeline2_080c5ea3b350377cc2c3529e9aebdbd9'}\n\n```{.r .cell-code}\nepi_tweets <- get_timeline(user = head(politicians_twitter$twitter_name), n = 10)\nhead(epi_tweets)\n```\n:::\n\n\n\nNat√ºrlich k√∂nnte man auch mehr als 10 Tweets pro Konto einsammeln, braucht nur seine Zeit.\n\n### Followers suchen\n\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/save-followers1_e2570e426993672fe7cf932f454fd839'}\n\n```{.r .cell-code}\nfollowers01 <-\n  politicians$screenname %>% \n map_dfr( ~ get_followers(user = .x, retryonratelimit = TRUE))\n\n```\n:::\n\n\n\nDa es dauern kann, Daten auszulesen (wir d√ºrfen pro 15 Min. nur eine begrenzte Zahl an Information abrufen), kann es Sinn machen, die Daten lokal zu speichern.\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/save-flllowers01_a8bb0b2c967e23bdf25b6c4669150f3b'}\n\n```{.r .cell-code}\nsaveRDS(followers01, file = \"data/tweets/followers01.rds\")\n```\n:::\n\n\n\nUnd ggf. wieder importieren:\n\n\n::: {.cell hash='025-twittermining_cache/html/read-flllowers0_118bd341b0449d0a187862b02a8b5a24'}\n\n```{.r .cell-code}\nfollowers01 <- read_rds(file = \"data/tweets/followers01.rds\")\n```\n:::\n\n\n\nWie viele unique Followers haben wir identifiziert?\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-13_ace6f1bf08c68377df27f11807d9ea23'}\n\n```{.r .cell-code}\nfollowers02 <- \n  followers01 %>% \n  distinct(from_id)\n```\n:::\n\n\n\nDie Screennames w√§ren noch n√ºtzlich:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-14_cd70802d6181258137a21d11ad03ecd2'}\n\n```{.r .cell-code}\nlookup_users(users = \"1690868335\")\n```\n:::\n\n\n\nDie Anzahl der Users, die man nachschauen kann, ist begrenzt auf 180 pro 15 Minuten.\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-15_55625029c83efe322805f968f283c30a'}\n\n```{.r .cell-code}\nfollowers03 <-\n  followers02 %>% \n  mutate(screenname = \n           list(lookup_users(users = from_id, retryonratelimit = TRUE,verbose = TRUE)))\n```\n:::\n\n\n\n\n\nEntsprechend kann man wieder einlesen:\n\n\n\n\nDamit haben wir eine Liste an Followers, deren Tweets wir einlesen und analysieren k√∂nnen,\nz.B. nach Hate Speech.\n\nIm Gegensatz zu Followers hei√üen bei Twitter die Accounts, denen ei Nutzi folgt \"Friends\".\n\n\nLesen wir mal die Followers von `karl_lauterbach` ein:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-16_9b156ad410a7ae16e8a383d84e20da19'}\n\n```{.r .cell-code}\nkarl_followers <- get_followers(user = \"karl_lauterbach\", verbose = TRUE)\n```\n:::\n\n\n\nUm nicht jedes Mal aufs Neue die Daten herunterzuladen, \nbietet es sich an, die Daten lokal zu speichern:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-17_d72e726898c5ecda21da88748ead0abc'}\n\n```{.r .cell-code}\nwrite_rds(karl_followers, file = \"data/tweets/karl_followers.rds\",\n          compress = \"gz\")\n```\n:::\n\n\nEntsprechend kann man die Daten dann auch wieder einlesen:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/read-karl-followers_ec34e3c6b246fc786e476b84aa118afc'}\n\n```{.r .cell-code}\nkarl_followers <- read_rds(file = \"data/tweets/karl_followers.rds\")\n```\n:::\n\n\n\n\n\n### Follower Tweets einlesen\n\n\n\n::: {.cell hash='025-twittermining_cache/html/get-timeline3_bd2e01db9650d9c2e46c24c5d5f68ae5'}\n\n```{.r .cell-code}\nfollowers_tweets <- get_timeline(user = head(followers01$from_id), n = 10)\n```\n:::\n\n\n\n\n### Tweets nach Stichwort suchen\n\n\nUm nach einem Stichwort, allgemeiner nach einem bestimmten Text,\nin einem Tweet zu suchen,\nkann man die Funktion `search_tweets` nutzen:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-18_841c7d465581eb179579dc1b65efe2ae'}\n\n```{.r .cell-code}\nmy_tweet <- search_tweets(\"Sebastian Sauer\", n = 1)\nmy_tweet$full_text\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-19_0c7a856adf47b5a7d0fbae1c251a5a62'}\n\n:::\n\n\n\n\nSchaut man sich das zur√ºckgelieferte Objekt (einen Tibble) n√§her an,\nentdeckt man eine F√ºlle an Informationen.\nSatte 43 Spalten (teilweise Listenspalten) finden sich dort:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-20_ba8b80b1c92debac9e34d328535c8ed0'}\n\n```{.r .cell-code}\nnames(my_tweet)\n##  [1] \"created_at\"                    \"id\"                           \n##  [3] \"id_str\"                        \"full_text\"                    \n##  [5] \"truncated\"                     \"display_text_range\"           \n##  [7] \"entities\"                      \"metadata\"                     \n##  [9] \"source\"                        \"in_reply_to_status_id\"        \n## [11] \"in_reply_to_status_id_str\"     \"in_reply_to_user_id\"          \n## [13] \"in_reply_to_user_id_str\"       \"in_reply_to_screen_name\"      \n## [15] \"geo\"                           \"coordinates\"                  \n## [17] \"place\"                         \"contributors\"                 \n## [19] \"retweeted_status\"              \"is_quote_status\"              \n## [21] \"quoted_status_id\"              \"quoted_status_id_str\"         \n## [23] \"retweet_count\"                 \"favorite_count\"               \n## [25] \"favorited\"                     \"retweeted\"                    \n## [27] \"lang\"                          \"possibly_sensitive\"           \n## [29] \"quoted_status\"                 \"text\"                         \n## [31] \"favorited_by\"                  \"scopes\"                       \n## [33] \"display_text_width\"            \"quoted_status_permalink\"      \n## [35] \"quote_count\"                   \"timestamp_ms\"                 \n## [37] \"reply_count\"                   \"filter_level\"                 \n## [39] \"query\"                         \"withheld_scope\"               \n## [41] \"withheld_copyright\"            \"withheld_in_countries\"        \n## [43] \"possibly_sensitive_appealable\"\n```\n:::\n\n\n\nDie Tweet-ID dieses Tweets bekommen Sie,\nwenn Sie die Variable `id_str` auslesen:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-21_ff95c53de7a1933e89e107e61409ca27'}\n\n```{.r .cell-code}\nmy_tweet$id_str\n## [1] \"1593598440675500032\"\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-22_7ebf0a9012c47ea7cf44f489f38d7b19'}\n\n```{.r .cell-code}\nmy_tweet$source\n## [1] \"<a href=\\\"https://mobile.twitter.com\\\" rel=\\\"nofollow\\\">Twitter Web App</a>\"\n```\n:::\n\n\n\n\n\nDabei ist `source` nicht etwa die Person, die tweetet,\nwie man vielleicht meinen k√∂nnte,\nsondern das Frontend, das dabei verwendet wurde,\nalso z.B. die iphone-App oder die Twitter-Webseite.\n\nLeider sucht man den `screenname` zu einen Tweet vergeblich in `my_tweet`.\n\nGegeben eines Dataframes mit Tweets kann man sich aber wie folgt den Nutzernamen (`screen_name`) ausgeben lassen.\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-23_3fe4f7acc264d370a5aa7757e70eaf53'}\n\n```{.r .cell-code}\nusers_data(my_tweet)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"id_str\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"name\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"screen_name\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"location\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"description\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"url\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"protected\"],\"name\":[8],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"followers_count\"],\"name\":[9],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"friends_count\"],\"name\":[10],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"listed_count\"],\"name\":[11],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"created_at\"],\"name\":[12],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"favourites_count\"],\"name\":[13],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"verified\"],\"name\":[14],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"statuses_count\"],\"name\":[15],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"profile_image_url_https\"],\"name\":[16],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"profile_banner_url\"],\"name\":[17],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"default_profile\"],\"name\":[18],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"default_profile_image\"],\"name\":[19],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"withheld_in_countries\"],\"name\":[20],\"type\":[\"list\"],\"align\":[\"right\"]},{\"label\":[\"derived\"],\"name\":[21],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"withheld_scope\"],\"name\":[22],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"entities\"],\"name\":[23],\"type\":[\"list\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1690868335\",\"2\":\"1690868335\",\"3\":\"Sebastian Sauer üá∫üá¶\",\"4\":\"sauer_sebastian\",\"5\":\"N√ºrnberg, Deutschland\",\"6\":\"Data Science\",\"7\":\"https://t.co/zwh3dCw3Dc\",\"8\":\"FALSE\",\"9\":\"485\",\"10\":\"346\",\"11\":\"34\",\"12\":\"Thu Aug 22 11:49:09 +0000 2013\",\"13\":\"7517\",\"14\":\"FALSE\",\"15\":\"1241\",\"16\":\"https://pbs.twimg.com/profile_images/853024804676521984/VQ5YBKVu_normal.jpg\",\"17\":\"https://pbs.twimg.com/profile_banners/1690868335/1453724621\",\"18\":\"TRUE\",\"19\":\"FALSE\",\"20\":\"<list [0]>\",\"21\":\"NA\",\"22\":\"NA\",\"23\":\"<named list [2]>\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\nAu√üerdem gibt es einen \"Trick\" [laut dieser Quelle](https://www.bram.us/2017/11/22/accessing-a-tweet-using-only-its-id-and-without-the-twitter-api/), vgl. auch [diesen SO-Post](https://stackoverflow.com/questions/897107/can-i-fetch-the-tweet-from-twitter-if-i-know-the-tweets-id): \nGibt man in die URL eines Tweets einen beliebigen Nutzernamen - \ndas kann ein Fantasiename sein - \nso wird man automatisch zum richtigen Nutzer geleitet.\n\n\nDie Rohform der URL sieht also so aus:\n\n`https://twitter.com/irgendeinnutzer/status/<id_str>`\n\nGeben Sie also z.B. Folgende URL in Ihren Browser sein:\n\n`https://twitter.com/irgendeinnutzer/status/1593598440675500032`\n\nUnd Sie werden zum Nutzer `sauer_sebastian` weitergeleitet bzw.\nzu seinem Tweet mit obiger ID.\n\n\n### Der Volltext ist manchmal abgeschniten\n\nManchmal ist der Volltext abgeschnitten\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-24_3ea929932a45a6947d21de2096773a34'}\n\n```{.r .cell-code}\nmy_tweet$full_text\n```\n:::\n\n\n```\nHier steht der Beginn des Tweet-Textes, aber dann endet der Text abrup...\"\n```\n\n\nGl√ºcklicherweise - sofern man bei einer so umst√§ndlichen Darstellung  von Gl√ºck reden kann - findet man den kompletten Text andernorts [Quelle](https://stackoverflow.com/questions/47211501/twitter-streaming-api-not-return-full-tweets?noredirect=1&lq=1).\n\n\nDazu schreibt [in diesem SO-Post](https://stackoverflow.com/questions/47211501/twitter-streaming-api-not-return-full-tweets?noredirect=1&lq=1) der Nutzer `Jonas`: \n\n\n>   You will need to check if the tweet is a retweet. If it is, use the retweet's full_text. If it is not, use the tweet's full_text. ‚Äì Jonas,  Nov 13, 2017 at 15:00\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-25_e95bd98349c6ea77ffb0c68f7d1711ae'}\n\n```{.r .cell-code}\nmy_tweet$retweeted_status[[1]][[\"full_text\"]]\n```\n:::\n\n\n\n```\nHier steht der Beginn des Tweet-Textes, aber dann endet der Text abrupt? \nNein,er geht weiter und irgendwann ist der dann wirklich aus.\"\n```\n\n\n\n\n\n\n### Tweets nach ID suchen\n\nMit `lookup_tweets(id_des_tweets)` k√∂nnen Sie sich die Informationen zu einen Tweet ausgeben lassen.\nDas ist nat√ºrlich prim√§r der Volltext:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-26_fbfe8417ca30dce5990badd3cc71f980'}\n\n```{.r .cell-code}\ntweet_example <- lookup_tweets(\"1593598440675500032\")\ntweet_example$full_text\n```\n:::\n\n\nAber auch die √ºbrigen Informationen k√∂nnen interessant sein.\n\n\n\n## Tweets verarbeiten\n\n\n### Grundlegende Verarbeitung\n\nSind die Tweets eingelesen, kann man z.B. eine Sentimentanalyse, s. @sec-sentimentanalyse, durchf√ºhren, oder schlicht vergleichen, welche Personen welche W√∂rter h√§ufig verwenden, s. @sec-woerterzaehlen.\n\n\n\n\n\n\n### Bot or not?\n\nEine interessante Methode, Tweets zu verarbeiten, bietet das R-Paket `tweetbotornot` von [M. Kearney](https://github.com/mkearney/tweetbotornot).\n\n\nAus der `Readme`: \n\n\n>   Due to Twitter‚Äôs REST API rate limits, users are limited to only 180 estimates per every 15 minutes. To maximize the number of estimates per 15 minutes (at the cost of being less accurate), use the fast = TRUE argument. This method uses only users-level data, which increases the maximum number of estimates per 15 minutes to 90,000! Due to losses in accuracy, this method should be used with caution!\n\n\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-27_e8fe70cbc0b4e74263af01d296f84d07'}\n\n```{.r .cell-code}\nusers <- c(\"sauer_sebastian\")\nbot01 <-\n  tweetbotornot(users)\n```\n:::\n\n\n\n\n:::callout-important\nIch habe ein Fehlermeldung bekommen bei `tweetbotornot`.\nDa k√∂nnte ein technisches Problem in der Funktion vorliegen.\n:::\n\n\n\n\n\n\n## Cron Jobs\n\n\n\n### Was ist ein Cron Job?\n\n[Cron](https://en.wikipedia.org/wiki/Cron) ist ein Programm auf Unix-artigen Betriebssystemen, das Skripte zu eingestellten Zeiten (wiederholt) ausf√ºhrt, das sind dann \"Cron Jobs\".\nAuf Windows gibt es aber analoge Funktionen.\nCron Jobs sind praktisch, da man nicht jedes Mal selber z.B. Tweets, die heute zu einem Thema getweetet wurden, herunterladen muss.\nDas wird dann vom Cron Job √ºbernommen.\n\nIn R gibt es eine API zum Programm Cron mit dem Paket `{cronR}`, s. [Anleitung hier](https://github.com/bnosac/cronR).\n\nDas analoge R-Paket f√ºr Windows hei√üt [`{taskscheduleR}`](https://github.com/bnosac/taskscheduleR).\n\n\n\n### Beispiel f√ºr einen Cron Job\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-28_d6fb5b146a60e3c0a7f85e87dc6ed902'}\n\n```{.r .cell-code}\nlibrary(cronR)\n\nscrape_script <- cron_rscript(\"scrape_tweets.R\")\n\n# Cron Job hinzuf√ºgen:\ncron_add(command = scrape_script, \n         frequency = 'daily', \n         at = \"10AM\",\n         id = 'Hate Speech')  # Name des Cron Jobs\n\ncron_clear(ask = FALSE)  # Alle Cron Jobs l√∂schen\ncron_ls()  # Liste aller Cron Jobs\n```\n:::\n\n\n\nIm obigen Beispiel wird das R-Skript `scrape_tweets.R` t√§glich um 10h ausgef√ºhrt.\n\n\n\n\nDer Inhalt von `scrape_tweets.R` k√∂nnte dann, in Grundz√ºgen, so aussehen:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-29_cd6c70379a44d420a54c6f766370d009'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(rtweet)\nfollowers_lauterbach <-\n  followers01 %>% \n  filter(to_id == \"Karl_Lauterbach\")\n\nfollowers_lauterbach_tweets <- \n  get_timeline(user = followers_lauterbach$from_id[1:10], n = 10, retryonratelimit = TRUE, verbose = FALSE)\n\n\npath_output <- \"/Users/sebastiansaueruser/Google Drive/RRRing/Scrape-Tweets/tweets/\"\n\nwrite_csv(x = followers_lauterbach_tweets,\n          file = paste0(path_output, \"followers_lauterbach_tweets.csv\"),\n          append = TRUE)\n\n```\n:::\n\n\n\nWir schreiben nicht jedes Mal (jeden Tag) eine neue CSV-Datei, sondern wir h√§ngen hier die neu ausgelesenen Daten an die Datei an.\n\nLeider ist es mit `rtweet` nicht m√∂glich, ein Datum anzugeben, ab dem man Tweets auslesen m√∂chte^[Mit dem R-Paket `twitteR`, das mittlerweile zugunsten von `rtweet` aufgegeben wurde, war das m√∂glich. Allerdings zeigt ein [Blick in die Dokumentation der Twitter-API](https://developer.twitter.com/en/docs/twitter-api/v1/tweets/timelines/api-reference/get-statuses-home_timeline), das Datumsangaben offenbar gar nicht unterst√ºtzt werden.]\n\n\n## Datenbank an Tweets aufbauen\n\n\n### Stamm an bisherigen Tweets\n\nIn diesem Abschnitt k√ºmmern wir uns in gr√∂√üerem Detail um das Aufbauen einer Tweets-Datenbank.\n\n\nDiese Pakete ben√∂tigen wir:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-30_82e5113b7278a67292f2f346b5ec3f7d'}\n\n```{.r .cell-code}\nlibrary(rtweet)\nlibrary(tidyverse)\nlibrary(rio)  # R Data import/export\n```\n:::\n\n\n\nDann melden wir uns an:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-31_072bdf2367c4976b4252bf742d8f0590'}\n\n```{.r .cell-code}\nsource(\"/Users/sebastiansaueruser/credentials/hate-speech-analysis-v01-twitter.R\")\nauth <- rtweet_app(bearer_token = Bearer_Token)\n```\n:::\n\n\n\nDann brauchen wir eine Liste an Twitterkonten,\ndie uns interessieren.\nIm Kontext von Hate Speech soll uns hier interessieren,\nwelche Tweets *an* deutsche Spitzenpolitikis^[zur Zeit, als diese Zeilen geschrieben wurden] gesendet werden.\nWir suchen also nach Tweets mit dem Text `@karl_lauterbach`,\num ein Beispiel f√ºr einen Spitzenpolitiker zu nennen, der vermutlich von Hate Speech in h√∂herem Ma√üe betroffen ist.\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-32_377a9c088c43663aeba8829542f968ba'}\n\n```{.r .cell-code}\npoliticians_twitter_path <- \"/Users/sebastiansaueruser/github-repos/datascience-text/data/twitter-german-politicians.csv\"\n\npoliticians_twitter <- rio::import(file = politicians_twitter_path)\n```\n:::\n\n\n\n\nIn der Liste befinden sich 13 Politiker.\nEs macht die Sache vielleicht einfacher,\nwenn wir die Rate nicht √ºberziehen.\nBleiben wir daher bei 1000 Tweets pro Politiki:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-33_417b2f0e24bbc3528021feed676b3234'}\n\n```{.r .cell-code}\nn_tweets_per_politician <- 1e3\n```\n:::\n\n\n\nDie R-Syntax, die die Arbeit leistet,\nist in Funktionen ausgelagert,\nder √úbersichtlichkeit halber.\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-34_83f3f556662dea16305d0be25c4330aa'}\n\n```{.r .cell-code}\nsource(\"funs/filter_recent_tweets.R\")\nsource(\"funs/download_recent_tweets.R\")\nsource(\"funs/add_tweets_to_tweet_db.R\")\nsource(\"funs/sanitize_tweets.R\")\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-35_c0b7fa3c4ad407dd88fce3dee92c9884'}\n\n:::\n\n\nJetzt laden wir einfach die aktuellsten 1000 Tweets\npro Konto herunter,\ndaher brauchen wir keine Tweet-ID angeben,\ndie ein Mindest- oder Maximum-Datum (bzw. ID) f√ºr einen \nTweet angibt:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-36_25c81efb0e00d4dc29fb79b6bb844e5e'}\n\n```{.r .cell-code}\ntweets_older <-\n  download_recent_tweets(screenname = politicians_twitter$screenname,\n                         max_or_since_id_str = NULL,\n                         n = n_tweets_per_politician,\n                         strip_columns = TRUE,\n                         reverse = TRUE)\n```\n:::\n\n\n\nWie weit in die Vergangenheit reicht unsere Tweet-Sammlung?\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-37_27bb939a77000105140135b7f6030493'}\n\n```{.r .cell-code}\noldest_tweets <- filter_recent_tweets(tweets_older, max_or_min_id_str = is_min_id_str)\noldest_tweets\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id_str\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"screenname\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"created_at\"],\"name\":[3],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"is_min_id_str\"],\"name\":[4],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"is_max_id_str\"],\"name\":[5],\"type\":[\"lgl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1590754620649115648\",\"2\":\"Karl_Lauterbach\",\"3\":\"2022-11-10 18:13:51\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1589837879693352960\",\"2\":\"OlafScholz\",\"3\":\"2022-11-08 05:31:02\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1590485330742083585\",\"2\":\"ABaerbock\",\"3\":\"2022-11-10 00:23:47\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1589983737621942272\",\"2\":\"BMWK\",\"3\":\"2022-11-08 15:10:38\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1590646264433373184\",\"2\":\"_FriedrichMerz\",\"3\":\"2022-11-10 11:03:16\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1588595577360875520\",\"2\":\"Markus_Soeder\",\"3\":\"2022-11-04 19:14:34\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1590097264613425152\",\"2\":\"cem_oezdemir\",\"3\":\"2022-11-08 22:41:45\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1588082031656898560\",\"2\":\"Janine_Wissler\",\"3\":\"2022-11-03 09:13:56\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1588082031656898560\",\"2\":\"schirdewan\",\"3\":\"2022-11-03 09:13:56\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1590628128791007233\",\"2\":\"c_lindner\",\"3\":\"2022-11-10 09:51:13\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1589277825152208898\",\"2\":\"MAStrackZi\",\"3\":\"2022-11-06 16:25:35\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1587964349993422848\",\"2\":\"Tino_Chrupalla\",\"3\":\"2022-11-03 01:26:18\",\"4\":\"TRUE\",\"5\":\"FALSE\"},{\"1\":\"1589696708447186945\",\"2\":\"Alice_Weidel\",\"3\":\"2022-11-07 20:10:05\",\"4\":\"TRUE\",\"5\":\"FALSE\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nWas sind die neuesten Tweets, die wir habven?\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-38_1d296280761c65993ce1a9e8835ab7cf'}\n\n```{.r .cell-code}\nmost_recent_tweets <- filter_recent_tweets(oldest_tweets)\nmost_recent_tweets\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"id_str\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"screenname\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"created_at\"],\"name\":[3],\"type\":[\"dttm\"],\"align\":[\"right\"]},{\"label\":[\"is_min_id_str\"],\"name\":[4],\"type\":[\"lgl\"],\"align\":[\"right\"]},{\"label\":[\"is_max_id_str\"],\"name\":[5],\"type\":[\"lgl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"1590754620649115648\",\"2\":\"Karl_Lauterbach\",\"3\":\"2022-11-10 18:13:51\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1589837879693352960\",\"2\":\"OlafScholz\",\"3\":\"2022-11-08 05:31:02\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1590485330742083585\",\"2\":\"ABaerbock\",\"3\":\"2022-11-10 00:23:47\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1589983737621942272\",\"2\":\"BMWK\",\"3\":\"2022-11-08 15:10:38\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1590646264433373184\",\"2\":\"_FriedrichMerz\",\"3\":\"2022-11-10 11:03:16\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1588595577360875520\",\"2\":\"Markus_Soeder\",\"3\":\"2022-11-04 19:14:34\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1590097264613425152\",\"2\":\"cem_oezdemir\",\"3\":\"2022-11-08 22:41:45\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1588082031656898560\",\"2\":\"Janine_Wissler\",\"3\":\"2022-11-03 09:13:56\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1588082031656898560\",\"2\":\"schirdewan\",\"3\":\"2022-11-03 09:13:56\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1590628128791007233\",\"2\":\"c_lindner\",\"3\":\"2022-11-10 09:51:13\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1589277825152208898\",\"2\":\"MAStrackZi\",\"3\":\"2022-11-06 16:25:35\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1587964349993422848\",\"2\":\"Tino_Chrupalla\",\"3\":\"2022-11-03 01:26:18\",\"4\":\"TRUE\",\"5\":\"TRUE\"},{\"1\":\"1589696708447186945\",\"2\":\"Alice_Weidel\",\"3\":\"2022-11-07 20:10:05\",\"4\":\"TRUE\",\"5\":\"TRUE\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\nJetzt laden wir die *neueren* Tweets herunter,\nalso mit einer ID *gr√∂√üer* als die gr√∂√üte in unserer Sammlung:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-39_c9756504a45167cca511c193fa8c64fa'}\n\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-40_0c9233fcd3aebd7afefd9329b0438440'}\n\n```{.r .cell-code}\ntweets_new <- \n  download_recent_tweets(screenname = most_recent_tweets$screenname,\n                         max_or_since_id_str = most_recent_tweets$id_str)\n\ntweets_new %>% \n  select(screenname, created_at, id_str) %>% \n  head()\n```\n:::\n\n\n\n\nJetzt - und jedes Mal, wenn wir Tweets herunterladen - \nf√ºgen wir diese einer Datenbank (oder zumindest einer \"Gesamt-Tabelle\") hinzu:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-41_0c288536a8056a52c328efc456fb53d4'}\n\n```{.r .cell-code}\ntweets_db <- add_tweets_to_tweets_db(tweets_new, tweets_older)\n\nnrow(tweets_db)\n## [1] 10969\n```\n:::\n\n\n\nSchlie√ülich sollten wir nicht vergessen\ndiese in einer Datei zu speichern:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-42_69606152ecdba82453b9af399fdeaca6'}\n\n```{.r .cell-code}\nwrite_rds(tweets_db, file = \"~/datasets/Twitter/tweets-db-2022-11-11.rds\")\n```\n:::\n\n\n\n\n... ... So, einige Zeit ist vergangen.\nLaden wir noch √§ltere Tweets herunter und f√ºgen Sie unserer Datenbank hinzu:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-43_e2f0fc3b1bdea9fed77604d96d2a89aa'}\n\n```{.r .cell-code}\ntweets_older2 <-\n  download_recent_tweets(screenname = politicians_twitter$screenname,\n                         max_or_since_id_str = oldest_tweets$id_str,\n                         n = 1e3,\n                         strip_columns = TRUE,\n                         reverse = TRUE)\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-44_60165235dc621115ca1b28d26d12688d'}\n\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-45_a7a4b891ba2efa9fb06a3e0948cccf0d'}\n\n```{.r .cell-code}\ntweets_db <- add_tweets_to_tweets_db(tweets_new, tweets_older2)\n\nnrow(tweets_db)\n## [1] 10011\n```\n:::\n\n\n\nUnd wieder speichern wir die vergr√∂√üerte Datenbasis auf der Festplatte:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-46_d04fb41e73f397048deb9b82ef14c5de'}\n\n```{.r .cell-code}\nwrite_rds(tweets_db, file = \"~/datasets/Twitter/hate-speech-twitter.rds\")\n```\n:::\n\n\nLeider ist die Datenbasis nicht mehr deutlich gewachsen.\nEine plausible Ursache ist, dass Twitter den Zugriff auf alte Tweets einschr√§nkt.\n\nAus der Hilfe von `search_tweets`:\n\n>   Returns Twitter statuses matching a user provided search query. ONLY RETURNS DATA FROM THE PAST 6-9 DAYS.\n\n\nMit Hilfe des [Academic Research Access](https://developer.twitter.com/en/products/twitter-api/academic-research) sind deutlich h√∂here Raten m√∂glich.\n\n\n\n\n\n### Neue Tweets per Cron Job\n\n\nWie oben schon ausprobiert,\nlegen wir uns einen Cron Job an.\n\nDas ist √ºbrigens auch eine komfortable L√∂sung.\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-47_fb66aa9bb2188dd52fdb21687a93da4a'}\n\n```{.r .cell-code}\nlibrary(cronR)\n\nscrape_script <- cron_rscript(\"/Users/sebastiansaueruser/github-repos/datascience-text/funs/get_tweets_politicians.R\")\n\n# Cron Job hinzuf√ºgen:\ncron_add(command = scrape_script, \n         frequency = 'daily', \n         at = \"10AM\",\n         id = 'Hate Speech')  # Name des Cron Jobs\n\n```\n:::\n\n\n\nDas Skript `get_tweets_politicians.R` birgt die Schritte,\ndie wir in diesem Abschnitt ausprobiert haben, [hier](https://github.com/sebastiansauer/datascience-text/blob/main/specifics/get_tweets_politicians.R) liegt es.\nKurz gesagt sucht es nach neuen Tweets, die \nalso noch nicht in Ihrer \"Datenbank\" vorhanden sind,\nund l√§dt diese herunter.\nDabei werden maximal 1000 Tweets pro Konto (derer sind es 13)\nheruntergeladen.\n\nBei einem Cronjob sollten *absolute* Pfade angegeben werden, da der Cronjob *nicht* aus dem aktuellen Projekt-Repo startet.\n\nDie Ergebnisse eines Cronjob-Durchlaufs werden in einer Log-Datei abgelegt, und \nzwar in dem Ordner, in dem auch das Skript liegt, das \nim Rahmen des Cronjobs durchgef√ºhrt wird.\n\n\n\n\n:::callout-note\nSchauen Sie sich die Funktionen im Ordner `/funs` einmal in Ruhe an.\n[Hier](https://github.com/sebastiansauer/datascience-text/tree/main/funs) geht es zu dem Ordner im Github-Repo.\nEs ist alles keine Zauberei,\naber im Detail gibt es immer wieder Schwierigkeiten.\nAm meisten lernt man,\nwenn man selber Hand anlegt.\n:::\n\n\n\n\n\nM√∂chte man den Cron Job wieder l√∂schen, so kann man das so tun:\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-48_a5728ae8fdcfb49c3911d2d514206845'}\n\n```{.r .cell-code}\ncron_clear(ask = FALSE)  # Alle Cron Jobs l√∂schen\ncron_ls()  # Liste aller Cron Jobs\n```\n:::\n\n\n\nUm die Tweets \"h√§ndisch\" herunterzuladen,\nkann man `get_tweets_politicians()` aufrufen:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-49_c269ab14b3b656a9eaab73eceb0784ee'}\n\n```{.r .cell-code}\nsource(\"funs/get_tweets_politicians.R\")\nget_tweets_politicians()\n```\n:::\n\n\n### Tweets in Excel exportieren\n\nUm pr√§diktive Modelle zu erstellen, braucht man ein\nTrainingsset, Tweets also, die schon vorklassifiziert sind, \nz.B. im Hinblick auf Hassrede mit `ja` oder `nein`.\nTechnisch bietet sich ein `1` vs. `0` an.\n\nDazu laden wir einen Datensatz mit Tweets,\nz.B. diesen hier:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-50_d7c57b685f2aa382cfdf79bbaf0d8906'}\n\n```{.r .cell-code}\ntweets_to_kl <- import(\"/Users/sebastiansaueruser/datasets/Twitter/tweets_to_karl_lauterbach.rds\")\n```\n:::\n\n\n\nDa es viele Spalten gibt, die teilweise Listenspalten sind,\nalso komplex, begrenzen wir uns auf das Wesentliche,\nden Tweet-Text und die ID des Tweets.\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-51_4f666de2c172da42d83fd1fe3675d4d6'}\n\n```{.r .cell-code}\ntweets_to_kl2 <-\n  tweets_to_kl %>% \n  select(id_str, full_text) \n```\n:::\n\n\n\n:::callout-note\nDie Tweet-ID wird einmal als String und einmal als Integer gespeichert.\nAllerdings √ºbersteigt die Anzahl der Ziffern die Speichergr√∂√üe von (normalen) Integer-Formaten in R. \nDaher ist die Twitter-ID als Integer *nicht* zuverl√§ssig;\nals Text hingegen schon.\n:::\n\nUnd schlie√ülich k√∂nnen wir die Excel-Datei importieren.\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-52_d0fd3b6b377a0c0ef2f3a8d632037e64'}\n\n```{.r .cell-code}\nexport(tweets_to_kl2, file = \"~/datasets/Twitter/tweets_to_kl.xlsx\")\n```\n:::\n\n\nDie Excel-Tabelle k√∂nnen wir dann bequem hernehmen,\num Tweets manuell zu klassifizieren.\n\n\n\n### Twitterkonten f√ºr Wissenschaftler \n\nTwitter stellt spezielle [Konten f√ºr Wissentschaftlis](https://developer.twitter.com/en/products/twitter-api/academic-research) bereit,\ndie √ºber [h√∂here Raten und mehr Funktionen](https://developer.twitter.com/en/products/twitter-api/academic-research/product-details) verf√ºgen,\nalso mehr Tweets herunterladen k√∂nnen,\nz.B. 10 Millionen Tweets pro Monat pro Projekt.\n\n\n\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-53_c8448bbae5c5615e0ab8650bb752e0d5'}\n\n```{.r .cell-code}\nauth_academic <- rtweet_app(bearer_token = askpass::askpass(\"bearer token\"))\nauth_academic\n```\n:::\n\n\nDas R-Paket `{askpass}` stellt eine weitere M√∂glichkeit bereit,\num Zugangsdaten zu sch√ºtzen.\nEs √∂ffnet eine Maske,\ndie interaktiv und als Punkte gesch√ºtzte Buchstaben nach einem Passwort fragt,\nin diesem Fall nach dem Bearer-Token.\n\nAus der Hilfe:\n\n\n>   Prompt the user for a password to authenticate or read a protected key. By default, this function automatically uses the most appropriate method based on the user platform and front-end. Users or IDEs can override this and set a custom password entry function via the askpass option.\n\n\n\n\nTwitter bietet [in diesem Repo](https://github.com/twitterdev/getting-started-with-the-twitter-api-v2-for-academic-research) einen n√ºtzlichen Kurs an,\num sich mit der API vertraut zu machen.\n\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-54_318f38029d6d6fa1c2537639ed781f57'}\n\n```{.r .cell-code}\ntweets_to__FriedrichMerz_2022 <-\n  get_all_tweets(query = \"to:_FriedrichMerz -is:retweet\",\n                 start_tweets = \"2022-01-01T00:00:00Z\",\n                 end_tweets = \"2022-11-23T23:59:59Z\",\n                 bearer_token = askpass(\"Bearer token\"),\n                 file = \"~/datasets/Twitter/tweets-to-_FriedrichMerz_2022.rds\",\n                 n = 1e5)\n```\n:::\n\n\n\n\nOder als Funktion,\ndas ist praktischer, wenn man die Syntax mehrfach verwendet:\n\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-55_503af2eb125796e20347715aec6cf69d'}\n\n```{.r .cell-code}\nget_all_tweets_politicians <- function(screenname, bearer_token, n = 1e5) {\n  get_all_tweets(query = paste0(\"to:\", screenname, \" -is:retweet\"),\n                 start_tweets = \"2021-01-01T00:00:00Z\",\n                 end_tweets = \"2021-12-31T23:59:59Z\",\n                 bearer_token = bearer_token,\n                 file = glue::glue(\"~/datasets/Twitter/tweets_to_{screenname}_2021.rds\"),\n                 data_path = glue::glue(\"~/datasets/Twitter/{screenname}\"),\n                 n = n)\n}\n```\n:::\n\n::: {.cell hash='025-twittermining_cache/html/unnamed-chunk-56_3815536361c0d0eedfa01b597d04f0fd'}\n\n```{.r .cell-code}\n#debug(get_all_tweets_politicians)\nget_all_tweets_politicians(screenname = politicians$screenname[5],\n                           bearer_token = askpass(\"Bearer token\"),\n                           n = 1e05)\n```\n:::\n\n\nDann kann man die Objekte abespeichern, etwas als RDS-Datei oder als Feather-Datei.\n\n\nDen Datensatz `politicians` hatten wir oben angelegt, s. @sec-politicians-accounts.\nEr beinhaltet die Kontonamen (`screennames`) einiger deutscher Politikis.\n\n\n\nWichtig ist, mit den Lizenzregeln in Einklang zu bleiben.\n\nZentral ist dabei sicherlich die Frage, ob und wie man Tweets weitergeben darf.\nDazu:\n\n>   Academic researchers are permitted to distribute an unlimited number of Tweet IDs and/or User IDs if they are doing so for the purposes of non-commercial research and to validate or replicate previous academic studies. You should not share the entire Tweet text directly. Instead, you can build a list of Tweet IDs and share those. The researchers who you share this set of Tweet IDs with, can then use the Twitter API to hydrate and get the full Tweet objects from the Tweet IDs.\n\n[Quelle](https://github.com/twitterdev/getting-started-with-the-twitter-api-v2-for-academic-research/blob/main/modules/7-storage-and-compliance.md)\n\n\nMehr Details finden sich den [Entwicklerrichtlinien von Twitter](https://developer.twitter.com/en/developer-terms/policy).\n\n\nTwitter stellt eine Reihe von [Lehrmaterialien](https://developer.twitter.com/en/use-cases/do-research/academic-research/resources) f√ºr die wissenschaftliche Nutzung von Tweets bereit.\n\n\n\n\n\n## Aufgaben\n\n1. √úberlegen Sie, wie Sie das Ausma√ü an Hate Speech, dem deutsche Politikerinnen und Politiker konfrontiert sind, messen k√∂nnen.\n2. Argumentieren Sie die Vorteile und Nachteile Ihres Ansatzes. Au√üerdem, auf welches Ergebnis dieser Analyse sie gespannt sind bzw. w√§ren.\n3. √úberlegen Sie Korrelate, oder besser noch: (m√∂gliche) Ursachen, des Hasses in den Tweets, gerichtet auf Polikter:innen. Sie k√∂nnen auch Gruppen von Ursachen bilden, etwas personengebundene Variablen der Politiker:innen (z.B. Alter? Geschlecht? Migrationshintergrund?).\n1. Erstellen Sie sich eine Liste an Personen, deren Tweets sich lohnen (k√∂nnten), auf Hate Speech hin analysiert zu werden. Laden Sie deren Tweets (ggf. in Ausz√ºgen) herunter.\n6. Das Skript zu `scrape_tweets.R` k√∂nnte man noch verbessern, in dem man jeden Tag nur die neuesten Tweets herunterl√§dt. Dazu kann man bei [get_timeline()](https://docs.ropensci.org/rtweet/reference/get_timeline.html) mit dem Argument `since_id` eine Untergrenze der ID festlegen, so dass nur neuere Tweets (d.h. mit gr√∂√üerem Wert bei ID) ausgelesen werden. √Ñndern Sie das Skript entsprechend, so dass nur neuerer Tweets gelesen werden.\n7. Erarbeiten Sie die Folien zu diesem [rtweet-Workshop](https://rtweet-workshop.mikewk.com/#1). Eine Menge guter Tipps!\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}