<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science 2: Textdaten als Grundlage prädiktiver Modelle - 5&nbsp; Word Embedding</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./hassrede.html" rel="next">
<link href="./populismus.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Word Embedding</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science 2: Textdaten als Grundlage prädiktiver Modelle</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Hinweise</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pruefung.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Prüfung</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./twittermining.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Twitter Mining</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./textmining1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Textmining1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./populismus.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fallstudie Populismus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./word-embedding.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Word Embedding</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hassrede.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Hassrede</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./klassifikation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Klassifikation von Hatespeech</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hatespeech2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fallstudie Hatespeech</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projektmgt.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Projektmanagement</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
  <li><a href="#vorab" id="toc-vorab" class="nav-link active" data-scroll-target="#vorab"><span class="toc-section-number">5.1</span>  Vorab</a>
  <ul class="collapse">
  <li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="toc-section-number">5.1.1</span>  Lernziele</a></li>
  <li><a href="#vorbereitung" id="toc-vorbereitung" class="nav-link" data-scroll-target="#vorbereitung"><span class="toc-section-number">5.1.2</span>  Vorbereitung</a></li>
  <li><a href="#benötigte-r-pakete" id="toc-benötigte-r-pakete" class="nav-link" data-scroll-target="#benötigte-r-pakete"><span class="toc-section-number">5.1.3</span>  Benötigte R-Pakete</a></li>
  </ul></li>
  <li><a href="#informationstheorie" id="toc-informationstheorie" class="nav-link" data-scroll-target="#informationstheorie"><span class="toc-section-number">5.2</span>  Informationstheorie</a>
  <ul class="collapse">
  <li><a href="#einführung" id="toc-einführung" class="nav-link" data-scroll-target="#einführung"><span class="toc-section-number">5.2.1</span>  Einführung</a></li>
  <li><a href="#wozu-ist-das-gut" id="toc-wozu-ist-das-gut" class="nav-link" data-scroll-target="#wozu-ist-das-gut"><span class="toc-section-number">5.2.2</span>  Wozu ist das gut?</a></li>
  <li><a href="#shannon-information" id="toc-shannon-information" class="nav-link" data-scroll-target="#shannon-information"><span class="toc-section-number">5.2.3</span>  Shannon-Information</a></li>
  <li><a href="#entropie" id="toc-entropie" class="nav-link" data-scroll-target="#entropie"><span class="toc-section-number">5.2.4</span>  Entropie</a></li>
  <li><a href="#gemeinsame-information" id="toc-gemeinsame-information" class="nav-link" data-scroll-target="#gemeinsame-information"><span class="toc-section-number">5.2.5</span>  Gemeinsame Information</a></li>
  <li><a href="#maximumentropie" id="toc-maximumentropie" class="nav-link" data-scroll-target="#maximumentropie"><span class="toc-section-number">5.2.6</span>  Maximumentropie</a></li>
  <li><a href="#ilustration" id="toc-ilustration" class="nav-link" data-scroll-target="#ilustration"><span class="toc-section-number">5.2.7</span>  Ilustration</a></li>
  </ul></li>
  <li><a href="#zufallstext-erkennen" id="toc-zufallstext-erkennen" class="nav-link" data-scroll-target="#zufallstext-erkennen"><span class="toc-section-number">5.3</span>  Zufallstext erkennen</a>
  <ul class="collapse">
  <li><a href="#entropie-von-zufallstext" id="toc-entropie-von-zufallstext" class="nav-link" data-scroll-target="#entropie-von-zufallstext"><span class="toc-section-number">5.3.1</span>  Entropie von Zufallstext</a></li>
  <li><a href="#mi-von-zufallstext" id="toc-mi-von-zufallstext" class="nav-link" data-scroll-target="#mi-von-zufallstext"><span class="toc-section-number">5.3.2</span>  MI von Zufallstext</a></li>
  </ul></li>
  <li><a href="#daten" id="toc-daten" class="nav-link" data-scroll-target="#daten"><span class="toc-section-number">5.4</span>  Daten</a>
  <ul class="collapse">
  <li><a href="#complaints-datensatz" id="toc-complaints-datensatz" class="nav-link" data-scroll-target="#complaints-datensatz"><span class="toc-section-number">5.4.1</span>  Complaints-Datensatz</a></li>
  <li><a href="#complaints-verkürzt-und-geschachtelt" id="toc-complaints-verkürzt-und-geschachtelt" class="nav-link" data-scroll-target="#complaints-verkürzt-und-geschachtelt"><span class="toc-section-number">5.4.2</span>  Complaints verkürzt und geschachtelt</a></li>
  </ul></li>
  <li><a href="#wordembeddings-selber-erstellen" id="toc-wordembeddings-selber-erstellen" class="nav-link" data-scroll-target="#wordembeddings-selber-erstellen"><span class="toc-section-number">5.5</span>  Wordembeddings selber erstellen</a>
  <ul class="collapse">
  <li><a href="#pmi-berechnen" id="toc-pmi-berechnen" class="nav-link" data-scroll-target="#pmi-berechnen"><span class="toc-section-number">5.5.1</span>  PMI berechnen</a></li>
  <li><a href="#sliding" id="toc-sliding" class="nav-link" data-scroll-target="#sliding"><span class="toc-section-number">5.5.2</span>  Sliding</a></li>
  <li><a href="#funktion-slide_windows" id="toc-funktion-slide_windows" class="nav-link" data-scroll-target="#funktion-slide_windows"><span class="toc-section-number">5.5.3</span>  Funktion <code>slide_windows</code></a></li>
  <li><a href="#ähnlichkeit-berechnen" id="toc-ähnlichkeit-berechnen" class="nav-link" data-scroll-target="#ähnlichkeit-berechnen"><span class="toc-section-number">5.5.4</span>  Ähnlichkeit berechnen</a></li>
  <li><a href="#svd" id="toc-svd" class="nav-link" data-scroll-target="#svd"><span class="toc-section-number">5.5.5</span>  SVD</a></li>
  <li><a href="#wortähnlichkeit" id="toc-wortähnlichkeit" class="nav-link" data-scroll-target="#wortähnlichkeit"><span class="toc-section-number">5.5.6</span>  Wortähnlichkeit</a></li>
  <li><a href="#cosinus-ähnlichkeit" id="toc-cosinus-ähnlichkeit" class="nav-link" data-scroll-target="#cosinus-ähnlichkeit"><span class="toc-section-number">5.5.7</span>  Cosinus-Ähnlichkeit</a></li>
  </ul></li>
  <li><a href="#word-embeddings-vorgekocht" id="toc-word-embeddings-vorgekocht" class="nav-link" data-scroll-target="#word-embeddings-vorgekocht"><span class="toc-section-number">5.6</span>  Word-Embeddings vorgekocht</a>
  <ul class="collapse">
  <li><a href="#glove6b" id="toc-glove6b" class="nav-link" data-scroll-target="#glove6b"><span class="toc-section-number">5.6.1</span>  Glove6B</a></li>
  <li><a href="#wordembeddings-für-die-deutsche-sprache" id="toc-wordembeddings-für-die-deutsche-sprache" class="nav-link" data-scroll-target="#wordembeddings-für-die-deutsche-sprache"><span class="toc-section-number">5.6.2</span>  Wordembeddings für die deutsche Sprache</a></li>
  </ul></li>
  <li><a href="#fazit" id="toc-fazit" class="nav-link" data-scroll-target="#fazit"><span class="toc-section-number">5.7</span>  Fazit</a></li>
  <li><a href="#literatur" id="toc-literatur" class="nav-link" data-scroll-target="#literatur"><span class="toc-section-number">5.8</span>  Literatur</a>
  <ul class="collapse">
  <li><a href="#wikipedia" id="toc-wikipedia" class="nav-link" data-scroll-target="#wikipedia"><span class="toc-section-number">5.8.1</span>  Wikipedia</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Word Embedding</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><img src="img/text-mining-1476780_640.png" class="img-fluid" style="width:10.0%" alt="Text als Datenbasis prädiktiver Modelle"> Bild von <a href="https://pixabay.com/de/users/mcmurryjulie-2375405/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780">mcmurryjulie</a> auf <a href="https://pixabay.com/de//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780">Pixabay</a></p>
<section id="vorab" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="vorab"><span class="header-section-number">5.1</span> Vorab</h2>
<section id="lernziele" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="lernziele"><span class="header-section-number">5.1.1</span> Lernziele</h3>
<ul>
<li>Die grundlegenden Konzepte der Informationstheorie erklären können</li>
<li>Die vorgestellten Techniken des Textminings mit R anwenden können</li>
</ul>
</section>
<section id="vorbereitung" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="vorbereitung"><span class="header-section-number">5.1.2</span> Vorbereitung</h3>
<ul>
<li>Lesen Sie <a href="https://www.science4all.org/article/shannons-information-theory/">diesen Text</a> als Vorbereitung</li>
<li>Arbeiten Sie <span class="citation" data-cites="smltar">Hvitfeldt und Silge (<a href="references.html#ref-smltar" role="doc-biblioref">2022</a>)</span>, <a href="https://smltar.com/embeddings.html">Kap. 5</a> durch.</li>
</ul>
</section>
<section id="benötigte-r-pakete" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="benötigte-r-pakete"><span class="header-section-number">5.1.3</span> Benötigte R-Pakete</h3>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-1_bf055aafc6ce7c2f518fe3608bebd04c">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats)  <span class="co"># Komfort für deskriptive Statistiken, wie `describe_distribution`</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hcandersenr)   <span class="co"># Textdaten</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slider)  <span class="co"># slide</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(widyr)  <span class="co"># pairwise_pmi</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)  <span class="co"># mehrere Kerne gleichzeitig nutzen</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(textdata)  <span class="co"># Worteinbettungen, vorgekocht</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(entropy)  <span class="co"># Entropie berechnen</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(widyr)  <span class="co"># Ähnlichkeit berechnen mit widyr_svd</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)  <span class="co"># Mehrere Kerne gleichzeitig</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="informationstheorie" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="informationstheorie"><span class="header-section-number">5.2</span> Informationstheorie</h2>
<section id="einführung" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="einführung"><span class="header-section-number">5.2.1</span> Einführung</h3>
<p>Die Informationstheorie ist eine der Sternstunden der Wissenschaft. <a href="http://www.science4all.org/article/shannons-information-theory/">Manche sagen</a> dass Claude Shannon, der Autor der Theorie, auf einer Stufe mit Darwin und Einstein stehen sollte:</p>
<blockquote class="blockquote">
<p>In this single paper, Shannon introduced this new fundamental theory. He raised the right questions, which no one else even thought of asking. This would have been enough to make this contribution earthshaking. But amazingly enough, Shannon also provided most of the right answers with class and elegance. In comparison, it took decades for a dozen of top physicists to define the basics of quantum theory. Meanwhile, Shannon constructed something equivalent, all by himself, in a single paper. Shannon’s theory has since transformed the world like no other ever had, from information technologies to telecommunications, from theoretical physics to economical globalization, from everyday life to philosophy. (…) I don’t think Shannon has had the credits he deserves. He should be right up there, near Darwin and Einstein, among the few greatest scientists mankind has ever had the chance to have.</p>
</blockquote>
<p>Für die Statistik ist die Informationstheorie von hoher Bedeutung. Im Folgenden schauen wir uns einige Grundlagen an.</p>
</section>
<section id="wozu-ist-das-gut" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="wozu-ist-das-gut"><span class="header-section-number">5.2.2</span> Wozu ist das gut?</h3>
<p>Bevor man sich mit einem Thema wie der Informationtheorie (Informationsentropie mit verwandten Konstrukten oder kurz Entropie) beschäftigt, sollte die Frage geklärt sein, wozu das Thema gut ist. Hier sind drei Antworten dazu:</p>
<ol type="1">
<li>Im Maschinenlernen wird die Informationtheorie verwendet, um die Güte von Klassifikationsmodellen zu berechnen.</li>
<li>Speziell im Textmining wird die Entropie verwendet, um den Zusammenhang von Wörtern zu quantifizieren.</li>
<li>Wenige Theorien haben so viel neue Forschung initiert, wie <span class="citation" data-cites="shannon_1948">Shannon (<a href="references.html#ref-shannon_1948" role="doc-biblioref">1948</a>)</span> berühmtes Paper. Es ist also auf jeden Fall eine Perle der Geistesgeschichte.</li>
</ol>
</section>
<section id="shannon-information" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="shannon-information"><span class="header-section-number">5.2.3</span> Shannon-Information</h3>
<p>Mit der <em>Shannon-Information</em> (Information, Selbstinformation) quantifizieren wir, wie viel “Überraschung” sich in einem Ereignis verbirgt <span class="citation" data-cites="shannon_1948">(<a href="references.html#ref-shannon_1948" role="doc-biblioref">Shannon 1948</a>)</span>.</p>
<p>Ein Ereignis mit …</p>
<ul>
<li><em>geringer</em> Wahrscheinlichkeit: <em>Viel</em> Überraschung (Information)</li>
<li><em>hoher</em> Wahrscheinlichkeit: <em>Wenig</em> Überraschung (Information)</li>
</ul>
<p>Wenn wir also erfahren, dass ein unwahrscheinliches Ereignis eingetreten ist (Schnee im Sommer), sind wir überraschter als wenn wir höhen, dass ein wahrscheinliches Ereignis eingetreten ist (Schnee im Winter).</p>
<p>Die Information eines Ereignis ist also eng verbunden mit seiner Wahrscheinlichkeit oder auch mit den Odds eines Ereignisses.</p>
<p>Die Shannon-Information ist die einzige Größe, die einige wünschenswerte Anforderungen<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> erfüllt:</p>
<ol type="1">
<li>Stetig</li>
<li>Je mehr Ereignisse in einem Zufallsexperiment möglich sind, desto höher die Information, wenn ein bestimmtes Ereignis eintritt</li>
<li>Additiv: Die Summe der Information zweier Teilereignisse ist gleich der Information des Gesamtereignis</li>
</ol>
<div id="def-info" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.1 (Shannon-Information) </strong></span>Die Information ist so definiert:</p>
<p><span class="math display">\[I(x) = - \log_2 \left( Pr(x) \right)\]</span></p>
</div>
<p>Andere Logaritmusbasen sind möglich. Bei einem binären Logarithmus nennt man die Einheit <em>Bit</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Ein Münwzurf<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> hat <em>1 Bit</em> Information:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-2_8aa06ce3a559e9b2a99a545d488ab943">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">base =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>Damit gilt: <span class="math inline">\(I = \frac{1}{Pr(x)}\)</span></p>
<p>Die Information ist eng verwandt mit den Odds bzw. Log-Odds (Logits):</p>
<p><span class="math inline">\(\text{log-odds}(x)=\log \left({\frac {p(x)}{p(\lnot x)}}\right)\)</span></p>
<p>Logits können als Differenz zweier Shannon-Infos ausgedrückt werden:</p>
<p><span class="math inline">\(\text{log-odds}(x)=I(\lnot x)-I(x)\)</span></p>
<p>Die Information zweier unabhängiger Ereignisse ist additiv.</p>
<p>Die gemeinsame Wahrscheinlichkeit zweier unabhängiger Ereignisse ist das Produkt der einzelnen Wahrscheinlichkeiten:</p>
<p><span class="math inline">\(Pr(x,y) = Pr(x) \cdot Pr(y)\)</span></p>
<p>Die <em>gemeinsame Information</em> ist dann</p>
<p><span class="math display">\[
{\displaystyle {\begin{aligned}\operatorname {I}(x,y)&amp;=-\log _{2}\left[p(x,y)\right]=-\log _{2}\left[p(x)p(y)\right]\\[5pt]&amp;=-\log _{2}\left[p{(x)}\right]-\log _{2}\left[p{(y)}\right]\\[5pt]&amp;=\operatorname {I} (x)+\operatorname {I} (y)\end{aligned}}}
\]</span></p>
<div id="exm-info1" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 5.1 (Information eines wahrscheinlichen Ereignisses) </strong></span>Die Information eines fast sicheren Ereignisses ist gering.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-3_b3ffdb6fb3fab73e9d2d34a7055db5b9">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="dv">99</span><span class="sc">/</span><span class="dv">100</span>, <span class="at">base =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01449957</code></pre>
</div>
</div>
</div>
<div id="exm-info2" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 5.2 (Information eines unwahrscheinlichen Ereignisses) </strong></span>Die Information eines unwahrscheinlichen Ereignisses ist hoch.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-4_a4438963111710a841089c1b5d43bc86">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="dv">01</span><span class="sc">/</span><span class="dv">100</span>, <span class="at">base =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.643856</code></pre>
</div>
</div>
</div>
<div id="exm-info3" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 5.3 (Information eines Würfelwurfs) </strong></span>Die Wahrscheinlichkeitsfunktion eines Würfel ist</p>
<p><span class="math inline">\({\displaystyle Pr(k)={\begin{cases}{\frac {1}{6}},&amp;k\in \{1,2,3,4,5,6\}\\0,&amp;{\text{ansonsten}}\end{cases}}}\)</span></p>
<p>Die Wahrscheinlichkeit, eine 6 zu würfeln, ist <span class="math inline">\(Pr(X=6) = \frac{1}{6}\)</span>.</p>
<p>Die Information von <span class="math inline">\(X=6\)</span> beträgt also</p>
<p><span class="math inline">\(I(X=6) = -\log_2 \left( Pr(X=6) \right) = -\log_2(1/6) \approx 2.585 \, \text{bits}\)</span>.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-5_0a5822206486d127da4bfb2ea152b40f">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">base =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.584963</code></pre>
</div>
</div>
</div>
<div id="exm-info3" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 5.4 (Information zweier Würfelwurfe) </strong></span>Die Wahrscheinlichkeit, mit zwei Würfeln, <span class="math inline">\(X\)</span> und <span class="math inline">\(Y\)</span>, jeweils <em>6</em> zu würfeln, beträgt <span class="math inline">\(Pr(X=6, Y=6) = \frac{1}{36}\)</span></p>
<p>Die Information beträgt also</p>
<p><span class="math inline">\(I(X=6, Y=6) = -\log_2 \left( Pr(6,6) \right)\)</span></p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-6_e79b94732bd7d511ee15b869ca4c2393">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">36</span>, <span class="at">base =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.169925</code></pre>
</div>
</div>
<p>Aufgrund der Additivität der Information gilt</p>
<p><span class="math inline">\(I(6,6) = I(6) + I(6)\)</span></p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-7_cd015b8f1f3620edcaab684c332a50f1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">base =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">6</span>, <span class="at">base =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.169925</code></pre>
</div>
</div>
</div>
</section>
<section id="entropie" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="entropie"><span class="header-section-number">5.2.4</span> Entropie</h3>
<p>(Informations)entropie ist die Summe der Informationen der Ereignisse einer Zufallsvariablen, <span class="math inline">\(X\)</span>.</p>
<div id="def-entropie" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.2 (Informationsentropie) </strong></span><em>Informationsentropie</em> ist so definiert:</p>
<p><span class="math display">\[H(p) = - \text{E log} (p_i) = - \sum_{i = 1}^n p_i \text{log} (p_i) = E\left[I(X) \right]\]</span></p>
</div>
<p>Die Informationsentropie ist also die “mittlere” oder “erwartete Information einer Zufallsvariablen.</p>
<p>Die Entropie eines Münzwurf-Versuchs (Bernoulli-Experiment) ist dann maximal (1 bit), wenn die Trefferwahrscheinlichkeit 50% beträgt: <span class="math inline">\(Pr(X=x) = 1/2\)</span>, s. Abb. <a href="#fig-bernoulli-entropy">Abbildung&nbsp;<span>5.1</span></a>.</p>
<div id="fig-bernoulli-entropy" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/Binary_entropy_plot.svg.png" class="img-fluid figure-img" style="width:30.0%"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.1: Der Zusammenhang von Wahrscheinlichkeit und Entropie bei einem Bernoulli-Versuch, Quelle: Wikipedia, CC-BY-SA, Brona, Rubber Duck</figcaption><p></p>
</figure>
</div>
</section>
<section id="gemeinsame-information" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="gemeinsame-information"><span class="header-section-number">5.2.5</span> Gemeinsame Information</h3>
<p>Die <em>gemeinsame Information</em> (mutual information, MI) zweier Zufallsvariablen <span class="math inline">\(X\)</span> und <span class="math inline">\(Y\)</span>, <span class="math inline">\(I(X,Y)\)</span>, quantifiziert die Informationsmenge, die man über <span class="math inline">\(Y\)</span> erhält, wenn man <span class="math inline">\(X\)</span> beobachtet. Mit anderen Worten: Die MI ist ein Maß des Zusammenhangs zweier (nominaler) Variablen. Im Gegensatz zur Korrelation ist die MI nicht auf lineare Abhängigkeiten beschränkt.</p>
<p>Die MI quantifiziert den Unterschied zwischen der gemeinsamen Verteilung <span class="math inline">\(Pr(X,Y)\)</span> und dem Produkt einer einzelnen<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> Wahrscheinlichkeitsverteilungen, d.h. <span class="math inline">\(Pr(X)\)</span> und <span class="math inline">\(Pr(Y)\)</span>.</p>
<p>Wenn die beiden Variablen (stochastisch) unabhängig<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> sind, ist ihre gemeinsame Information Null:</p>
<p><span class="math inline">\(I(X,Y) = 0 \quad \text{gdw} \quad \bot(X,Y)\)</span>.</p>
<p>Dann gilt nämlich:</p>
<p><span class="math inline">\(\log \left( \frac{Pr(X,Y)} {Pr(X) \cdot Pr(Y)} \right) =\log(1) = 0\)</span>.</p>
<p>Das macht intuitiv Sinn: Sind zwei Variablen unabhängig, so erfährt man nichts über die zweite, wenn man die erste kennt. So ist Kenntnis der Sternzeichens einer Person und ihrer Körpergröße unabhängig.</p>
<p>Das Gegenteil ist auch wahr: Sind zwei Variablen voneinander komplett abhängig, so weiß man alles über die zweite, wenn man die erste kennt.</p>
<p>Die gemeinsame Information kann man sich als <em>Summe der einzelnen gemeinsamen Informationen</em> von <span class="math inline">\(XY\)</span> sehen (s. <a href="#tbl-mi1">Tabelle&nbsp;<span>5.1</span></a>):</p>
<div class="cell" data-hash="word-embedding_cache/html/tbl-mi1_11294bd7b269244ede10012a1f517053">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>     <span class="sc">~</span>x1,    <span class="sc">~</span>x2,    <span class="sc">~</span>x3,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"x1y2"</span>, <span class="st">"x2y1"</span>, <span class="st">"x3y1"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"x2y1"</span>, <span class="st">"x2y2"</span>, <span class="st">"x3y2"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"x1y3"</span>, <span class="st">"x2y3"</span>, <span class="st">"x3y3"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<div id="tbl-mi1" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabelle&nbsp;5.1: Summe der punktweisen gemeinsamen Informationen</caption>
<thead>
<tr class="header">
<th style="text-align: left;">x1</th>
<th style="text-align: left;">x2</th>
<th style="text-align: left;">x3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">x1y2</td>
<td style="text-align: left;">x2y1</td>
<td style="text-align: left;">x3y1</td>
</tr>
<tr class="even">
<td style="text-align: left;">x2y1</td>
<td style="text-align: left;">x2y2</td>
<td style="text-align: left;">x3y2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x1y3</td>
<td style="text-align: left;">x2y3</td>
<td style="text-align: left;">x3y3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p><span class="math inline">\(I(X,Y) = \Sigma_Y \Sigma_y Pr(x,y) \underbrace{\log \left( \frac{Pr(X,Y)}{Pr(X) Pr(Y)} \right)}_\text{punktweise MI}\)</span></p>
<p>Die Summanden der gemeinsamen Information bezeichnet man auch als <em>punktweise gemeinsame Information</em> (pointwise mutual information, PMI), entsprechend, s. <a href="#eq-pmi">Gleichung&nbsp;<span>5.1</span></a>. MI ist also der Erwartungswert der PMI.</p>
<p><span id="eq-pmi"><span class="math display">\[{\displaystyle \operatorname {PMI} (x,y)\equiv \log_{2}{\frac {p(x,y)}{p(x)p(y)}}=\log _{2}{\frac {p(x|y)}{p(x)}}=\log _{2}{\frac {p(y|x)}{p(y)}}}
\tag{5.1}\]</span></span></p>
<p>Andere Basen als <code>log2</code> sind gebräuchlich, vor allem der natürliche Logarithmus.</p>
<div class="remark proof">
<p><span class="proof-title"><em>Anmerkung</em>. </span>Die zwei rechten Umformungen in <a href="#eq-pmi">Gleichung&nbsp;<span>5.1</span></a> basieren auf der Umformung der gemeinsamen Wahrscheinlichkeit.</p>
<p>Zur Erinnerung: <span class="math inline">\(p(x,y) = p(y)p(x|y) = p(x)p(y|x)\)</span></p>
</div>
<div id="exm-pmi" class="theorem example">
<p><span class="theorem-title"><strong>Beispiel 5.5 (Interpretation der PMI) </strong></span>Sei <span class="math inline">\(p(x) = p(y) = 1/10\)</span> und <span class="math inline">\(p(x,y) = 1/10\)</span>. Wären <span class="math inline">\(x\)</span> und <span class="math inline">\(y\)</span> unabhängig, dann wäre <span class="math inline">\(p^{\prime}(x,y) = p(x)p(y) = 1/100\)</span>. Das Verhältnis der Produkte der einzelnen Wahrscheinlichkeit zur gemeinsamen Wahrscheinlichkeit wäre dann 1 und der Logarithmus von 1 ist 0. Das Verhältnis von 1 entspricht also der Unabhängigkeit. Ist das Verhältnis z.B. 5, so zeigt das eine gewisse Abhängigkeit an. Im obigen Beispiel gilt: <span class="math inline">\(\frac{1/20}{1/100}=5\)</span>.</p>
</div>
<p>Die MI wird auch über die sog. <em>Kullback-Leibler-Divergenz</em> definiert, die die Differenz zwischen gemeinsamer Wahrscheinlichkeitsfunktion bzw. -dichte und dem Produkt der jeweiligen Randwahrscheinlichkeiten bzw. -dichte angibt.</p>
</section>
<section id="maximumentropie" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="maximumentropie"><span class="header-section-number">5.2.6</span> Maximumentropie</h3>
<div id="def-maxent" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5.3 (Maximumentropie) </strong></span>Die Verteilungsform, für die es die meisten Möglichkeiten (Pfade im Baumdiagramm) gibt, hat die höchste Informationsentropie.</p>
</div>
<p><a href="#fig-muenz3">Abbildung&nbsp;<span>5.2</span></a> zeigt ein Baumdiagramm für einen 3-fachen Münzwurf. In den “Blättern” (Endknoten) sind die Ergebnisse des Experiments dargestellt sowie die Zufallsvariable <span class="math inline">\(X\)</span>, die die Anzahl der “Treffer” (Kopf) fasst. Wie man sieht, vereinen einige Werte der Zufallsvariable mehr Pfade auf sich als andere: Der Wert <span class="math inline">\(X=1\)</span> vereinigt 3 Pfade (von 8) auf sich; der Wert <span class="math inline">\(X=3\)</span> nur 1 Pfad.</p>
<div id="fig-muenz3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/muenz3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.2: Pfade im Baumdiagramm: 3-facher Münzwurf</figcaption><p></p>
</figure>
</div>
</section>
<section id="ilustration" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="ilustration"><span class="header-section-number">5.2.7</span> Ilustration</h3>
<p>Sagen wir, Sie stehen vor 5 Eimern und haben 10 Kieselsteine bei sich, die mit den Nummern 1 bis 10 beschriftet sind <span class="citation" data-cites="mcelreath_statistical_2020">(<a href="references.html#ref-mcelreath_statistical_2020" role="doc-biblioref">McElreath 2020</a>)</span>. Weil Sie nichts besseres zu tun haben, werfen Sie die Kiesel in die Eimer und zwar so, dass die Wahrscheinlichkeit für einen Kiesel in einen bestimmten Eimer zu landen für alle Eimer gleich ist. Sie werfen also Ihre 10 Kiesel und betrachten das Ergebnis; die Kiesel sind jetzt in einem bestimmten (zufälligen) Arrangement auf die Eimer verteilt. Jede Aufteilung (der 10 Kiesel in den 5 Eimern) ist gleich wahrscheinlich<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> – die Wahrscheinlichkeit, dass alle 10 Kiesel in Eimer 1 landen ist also gleich hoch wie die Wahrscheinlichkeit, dass jeder Eimer einen Kiesel abkriegt. Jetzt kommt’s: Manche Arrangements können auf mehrere Arten erzielt werden als andere. So gibt es nur <em>eine</em> Aufteilung für alle 10 Kiesel in einem Eimer (Teildiagramm a, in <a href="#fig-kiesel">Abbildung&nbsp;<span>5.3</span></a>). Aber es gibt 90 Möglichkeiten, die Kiesel so aufzuteilen, dass 2 in Eimer 2 landen, 8 in Eimer 4 und 2 in Eimer 4, s. Teildiagramm b in <a href="#fig-kiesel">Abbildung&nbsp;<span>5.3</span></a>. Teildiagramme c bis e zeigen, dass die Anzahl der Aufteilungen schnell astronomisch hoch wird, wenn sich die Kiesel “gleichmäßiger” auf die Eimer verteilen. Die gleichmäßigste Aufteilung (Diagramm e) hat die größte Zahl an möglichen Anordnungen. Eine Aufteilung der Kiesel auch als Pfad durch ein Baumdiagramm beschrieben werden.</p>
<p>Hier sind ein paar verschiedene Arrangements, deren Anzahl von Aufteilungen wir hier anschauen, s. <a href="#tbl-arr">Tabelle&nbsp;<span>5.2</span></a>:</p>
<div class="cell" data-hash="word-embedding_cache/html/tbl-arr_ecdaf39a3bae598358c8c988150d6d37">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">c =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">0</span>),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">d =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">e =</span> <span class="dv">2</span>) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<div id="tbl-arr" class="anchored">
<table class="table table-sm table-striped">
<caption>Tabelle&nbsp;5.2: Ein paar verschiedene Arrangements (a-e) der Kiesel in den fünf Eimern</caption>
<thead>
<tr class="header">
<th style="text-align: right;">a</th>
<th style="text-align: right;">b</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">d</th>
<th style="text-align: right;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/fig-kiesel_ef23d0da2ab08eb54c309418452a83d8">
<div class="cell-output-display">
<div id="fig-kiesel" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="word-embedding_files/figure-html/fig-kiesel-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.3: Anzahl von Aufteilungen der 10 Kiesel in 5 Eimer</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Hier sind die Wahrscheinlichkeitsverteilungen der 5 Arrangements<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-10_f33e12b23079203272d79c0b96693cd5">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span>. <span class="sc">/</span> <span class="fu">sum</span>(.))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">a</th>
<th style="text-align: right;">b</th>
<th style="text-align: right;">c</th>
<th style="text-align: right;">d</th>
<th style="text-align: right;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.8</td>
<td style="text-align: right;">0.6</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: right;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">0.1</td>
<td style="text-align: right;">0.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Dann kann man die Wahrscheinlichkeit einfach in Entropie umrechnen<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-11_3f4879960810008ace21c7c71e781897">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="fu">sum</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">h =</span> <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">ifelse</span>(value <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, value <span class="sc">*</span> <span class="fu">log</span>(value))))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">key</th>
<th style="text-align: right;">h</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: right;">0.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">b</td>
<td style="text-align: right;">0.6390319</td>
</tr>
<tr class="odd">
<td style="text-align: left;">c</td>
<td style="text-align: right;">0.9502705</td>
</tr>
<tr class="even">
<td style="text-align: left;">d</td>
<td style="text-align: right;">1.4708085</td>
</tr>
<tr class="odd">
<td style="text-align: left;">e</td>
<td style="text-align: right;">1.6094379</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Das <code>ifelse</code> dient nur dazu, eine Wahrscheinlichkeit von 0 eine Entropie von 0 zu verpassen<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>, denn sonst würden wir ein Problem rennen, wenn wir <span class="math inline">\(log(0)\)</span> ausrechnen.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-12_f6d7e861f940b9ddc306bf96e6ec8a08">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">0</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -Inf</code></pre>
</div>
</div>
</section>
</section>
<section id="zufallstext-erkennen" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="zufallstext-erkennen"><span class="header-section-number">5.3</span> Zufallstext erkennen</h2>
<section id="entropie-von-zufallstext" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="entropie-von-zufallstext"><span class="header-section-number">5.3.1</span> Entropie von Zufallstext</h3>
<p>Kann man wohl Zufallstext maschinell erkennen? Sicher gibt es viele Ansätze, um das Problem anzugehen. Lassen Sie uns einen Ansatz erforschen. Erforschen heißt, <em>wir</em> erforschen für <em>uns</em>, es handelt sich um eine didaktische Übung, das Ziel ist nicht, Neuland für die Menschheit zu betreten.</p>
<p>Aber zuerst müssen wir überlegen, was “Zufallstext” bedeuten soll.</p>
<p>Nehmen wir uns dazu zuerst einen richtigen Text, ein Märchen von H.C. Andersen zum Beispiel. Nehmen wir das Erste aus der Liste in dem Tibble <code>hcandersen_de</code>, “das Feuerzeug”.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-13_32e6fcc8e59535f44e2ed4edd0b75d62">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>das_feuerzeug <span class="ot">&lt;-</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  hcandersen_de  <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Das Feuerzeug"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> text, <span class="at">output =</span> word) <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(word) </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(das_feuerzeug)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "es"         "kam"        "ein"        "soldat"     "die"       
[6] "landstraße"</code></pre>
</div>
</div>
<p>Das Märchen ist 2688 Wörter lang.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-14_71ba9954d21cfe317fc569a87ed0d5a9">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>wortliste <span class="ot">&lt;-</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>hcandersen_de  <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(book <span class="sc">==</span> <span class="st">"Das Feuerzeug"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input =</span> text) <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(word) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wortliste)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "es"         "kam"        "ein"        "soldat"     "die"       
[6] "landstraße"</code></pre>
</div>
</div>
<p>Jetzt ziehen wir Stichproben (mit Zurücklegen) aus dieser Liste und erstellen damit eine Art Zufallstext.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-15_abd203a54f3e8fcadbc38c5e4d37b3c1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>zufallstext <span class="ot">&lt;-</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="at">x =</span> wortliste, <span class="at">size =</span> <span class="fu">length</span>(das_feuerzeug)<span class="sc">*</span><span class="dv">10</span><span class="sc">^</span><span class="dv">2</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(zufallstext)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hat"    "kreide" "ins"    "komme"  "seinen" "dort"  </code></pre>
</div>
</div>
<p>Zählen wir, wie häufig jedes Wort vorkommt:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-16_c3f27ed56ab922e01cb21196a2b2be9a">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>zufallstext_count <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">zufallstext =</span> zufallstext) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(zufallstext)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(zufallstext_count)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">zufallstext</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ab</td>
<td style="text-align: right;">356</td>
</tr>
<tr class="even">
<td style="text-align: left;">abend</td>
<td style="text-align: right;">386</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aber</td>
<td style="text-align: right;">347</td>
</tr>
<tr class="even">
<td style="text-align: left;">abflog</td>
<td style="text-align: right;">350</td>
</tr>
<tr class="odd">
<td style="text-align: left;">abschlagen</td>
<td style="text-align: right;">388</td>
</tr>
<tr class="even">
<td style="text-align: left;">acht</td>
<td style="text-align: right;">379</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Der Häufigkeitsvektor von <code>wortliste</code> besteht nur aus Einsen, so haben wir ja gerade die Wortliste definiert:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-17_ae5696da43dc2786911b15218de0991f">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>wortliste_count <span class="ot">&lt;-</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">wortliste =</span> wortliste) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(wortliste)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wortliste_count)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">wortliste</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ab</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">abend</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aber</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">abflog</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">abschlagen</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">acht</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Daher ist ihre Informationsentropy maximal.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-18_753ce5784a3d82555be6bf2185b4b396">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">entropy</span>(wortliste_count<span class="sc">$</span>n, <span class="at">unit =</span> <span class="st">"log2"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.47978</code></pre>
</div>
</div>
<p>Die Häufigkeiten der Wörter in <code>zufallstext</code> hat eine hohe Entropie.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-19_f956583dbf79979ae6261b315979c689">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">entropy</span>(zufallstext_count<span class="sc">$</span>n, <span class="at">unit =</span> <span class="st">"log2"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.47792</code></pre>
</div>
</div>
<p>Zählen wir die Häufigkeiten in der Geschichte “Das Feuerzeug”.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-20_d1c0f6047444fdc6daf45e48fa267dce">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>das_feuerzeug_count <span class="ot">&lt;-</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">text =</span> das_feuerzeug) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(text)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(das_feuerzeug_count)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">text</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ab</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">abend</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aber</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: left;">abflog</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">abschlagen</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">acht</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Und berechnen dann die Entropie:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-21_6c93f2b7d0a030e4698ef9d5f0bb6ea9">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">entropy</span>(das_feuerzeug_count<span class="sc">$</span>n, <span class="at">unit =</span> <span class="st">"log2"</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.075194</code></pre>
</div>
</div>
<p>Der Zufallstext hat also eine höhere Entropie als der echte Märchentext. Der Zufallstext ist also gleichverteilter in den Worthäufigkeiten.</p>
<p>Pro Bit weniger Entropie halbiert sich die Anzahl der Möglichkeiten einer Häufigkeitsverteilung.</p>
</section>
<section id="mi-von-zufallstext" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="mi-von-zufallstext"><span class="header-section-number">5.3.2</span> MI von Zufallstext</h3>
<p>Left as an exercises for the reader<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> 🥳.</p>
</section>
</section>
<section id="daten" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="daten"><span class="header-section-number">5.4</span> Daten</h2>
<section id="complaints-datensatz" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="complaints-datensatz"><span class="header-section-number">5.4.1</span> Complaints-Datensatz</h3>
<p>Der Datensatz <code>complaints</code> stammt aus <a href="https://www.consumerfinance.gov/data-research/consumer-complaints/">dieser Quelle</a>.</p>
<p>Den Datensatz <code>complaints</code> kann man <a href="https://github.com/EmilHvitfeldt/smltar/raw/master/data/complaints.csv.gz">hier</a> herunterladen. Im Buch ist die Webseite nicht (direkt?) angegeben. Die Datei ist mit <code>gz</code> gepackt; <code>read_csv</code> sollte das automatisch entpacken. Achtung: Die Datei ist recht groß.</p>
<div class="cell" data-hash="word-embedding_cache/html/read-complaints-data_c409b292bb4630e8366ac1dd05232d84">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>d_path <span class="ot">&lt;-</span> <span class="st">"https://github.com/EmilHvitfeldt/smltar/raw/master/data/complaints.csv.gz"</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>complaints <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(d_path)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Geschickter als jedes Mal die Datei herunterzuladen, ist es, sie einmal herunterzuladen, und dann lokal zu speichern, etwa im Unterordner <code>data</code> des RStudio-Projektordners.</p>
<p>Nach dem Importieren wird der Datensatz in eine Tidy-Form gebracht (mit <code>unnest_tokens</code>) und dann verschachtelt, mit <code>nest</code>.</p>
</section>
<section id="complaints-verkürzt-und-geschachtelt" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="complaints-verkürzt-und-geschachtelt"><span class="header-section-number">5.4.2</span> Complaints verkürzt und geschachtelt</h3>
<p>Um ein Herumprobieren zu erleichtern, ist hier der Datensatz <code>complaints</code> in zwei verkürzten Formen bereitgestellt:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-22_810f6c1f29ae34c487584999b350aecd">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nested_words2_path <span class="ot">&lt;-</span> <span class="st">"https://github.com/sebastiansauer/datascience-text/raw/main/data/nested_words2.rds"</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>nested_words3_path <span class="ot">&lt;-</span> <span class="st">"https://github.com/sebastiansauer/datascience-text/raw/main/data/nested_words3.rds"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>nested_words2</code> enthält die ersten 10% des Datensatz <code>nested_words</code>und ist gut 4 MB groß (mit <code>gz</code> gezippt); er besteht aus ca. 11 Tausend Beschwerden. <code>nested_words3</code> enthält nur die ersten 10 Beschwerden, was ihn gut zum Handhaben macht.</p>
<p>Beide sind verschachtelt und aus <code>tidy_complaints</code> (s. <a href="https://smltar.com/embeddings.html#motivatingsparse">Kap. 5.1</a>) hervorgegangen.</p>
<div class="cell" data-hash="word-embedding_cache/html/read-rds-nested-data_c88ffa3ec00426f49ded9c22547b6571">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>nested_words3 <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(nested_words3_path)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das sieht dann so aus:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-23_5306c91bc18a5b8a67c20e5a2babc4e6">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>nested_words3 <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 1%">
<col style="width: 98%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">complaint_id</th>
<th style="text-align: left;">words</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">systems , inc , is , trying , to , collect , a , debt , that , is , not , mine , not , owed , and , is , inaccurate</td>
</tr>
<tr class="even">
<td style="text-align: right;">3417821</td>
<td style="text-align: left;">i , would , like , to , request , the , of , the , following , items , from , my , credit , report , which , are , the , result , of , my , victim , to , identity , theft , this , information , does , not , to , transactions , that , i , have , made , accounts , that , i , have , opened , as , the , attached , supporting , documentation, can , as , such , it , should , be , blocked , from , on , my , credit , report , pursuant , to , section , of , the , fair , credit , reporting , act</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3433198</td>
<td style="text-align: left;">over , the , past , 2 , weeks , i , have , been , receiving , amounts , of , telephone , calls , from , the , company , listed , in , this , complaint , the , calls , between , xxxx , xxxx , and , xxxx , xxxx , to , my , cell , and , at , my , job , the , company , does , not , have , the , right , to , me , at , work , and , i , want , this , to , stop , it , is , extremely , to , be , told , 5 , times , a , day , that , i , have , a , call , from , this , collection, agency , while , at , work</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Werfen wir einen Blick in den TExt der ersten Beschwerde des Datensatzes mit der ID <code>nested_words3_path$complaint_id[1]</code>.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-24_da7357e8851ee8124b1d54413e5698ae">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>beschwerde1_text <span class="ot">&lt;-</span> nested_words3<span class="sc">$</span>words[[<span class="dv">1</span>]]</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das ist ein Tibble mit einer Spalte und 17 Wörtern; da wir schon auf Unigramme aufgeteilt haben, ist jedes Wort ein Element des Vektors <code>word</code>:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-25_4ee48c79fd485dee3c81dd5e28241ba1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>beschwerde1_text <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">word</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">systems</td>
</tr>
<tr class="even">
<td style="text-align: left;">inc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is</td>
</tr>
<tr class="even">
<td style="text-align: left;">trying</td>
</tr>
<tr class="odd">
<td style="text-align: left;">to</td>
</tr>
<tr class="even">
<td style="text-align: left;">collect</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-26_9184357c6afde11114e5ce4e5c730121">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>beschwerde1_text<span class="sc">$</span>word</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "systems"    "inc"        "is"         "trying"     "to"        
 [6] "collect"    "a"          "debt"       "that"       "is"        
[11] "not"        "mine"       "not"        "owed"       "and"       
[16] "is"         "inaccurate"</code></pre>
</div>
</div>
</section>
</section>
<section id="wordembeddings-selber-erstellen" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="wordembeddings-selber-erstellen"><span class="header-section-number">5.5</span> Wordembeddings selber erstellen</h2>
<section id="pmi-berechnen" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="pmi-berechnen"><span class="header-section-number">5.5.1</span> PMI berechnen</h3>
<p>Rufen Sie sich die Definition der PMI ins Gedächtnis, s. <a href="#eq-pmi">Gleichung&nbsp;<span>5.1</span></a>.</p>
<p>Mit R kann man die PMI z.B. so berechnen, s. <code>? pairwise_pmi</code> aus dem Paket <code>{widyr}</code>.</p>
<p>Zum Paket <code>widyr</code> von Robinson und Silge:</p>
<blockquote class="blockquote">
<p>This package wraps the pattern of un-tidying data into a wide matrix, performing some processing, then turning it back into a tidy form. This is useful for several mathematical operations such as co-occurrence counts, correlations, or clustering that are best done on a wide matrix.</p>
</blockquote>
<p><a href="https://juliasilge.github.io/widyr/">Quelle</a></p>
<p>Erzeugen wir uns Dummy-Daten:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-27_6fbd3724100ce7df990284127e7712ff">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">feature =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">item =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"a"</span>, <span class="st">"c"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"a"</span>, <span class="st">"c"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"b"</span>, <span class="st">"e"</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">"b"</span>, <span class="st">"f"</span>))</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>dat</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">feature</th>
<th style="text-align: left;">item</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">b</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">a</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">b</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">b</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">f</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Aus der Hilfe der Funktion:</p>
<blockquote class="blockquote">
<p>Find pointwise mutual information of pairs of items in a column, based on a “feature” column that links them together. This is an example of the spread-operate-retidy pattern.</p>
</blockquote>
<p>Die Argumente der Funktion sind:</p>
<p><em>item</em></p>
<p>Item to compare; will end up in item1 and item2 columns</p>
<p><em>feature</em></p>
<p>Column describing the feature that links one item to others</p>
<p>Manche Berechnungen (Operationen) lassen sich vielleicht leichter nicht in der Tidy-Form (Langform), sondern in der “breiten” oder Matrixform ausführen. Wandeln wir mal <code>dat</code> von der Langform in die Breitform um:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-28_c48cdc131a6d6e4e5f3a254a5b0ac086">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dat<span class="sc">$</span>item, dat<span class="sc">$</span>feature)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
    1 2 3 4 5
  a 1 1 1 0 0
  b 1 0 0 1 1
  c 0 1 1 0 0
  e 0 0 0 1 0
  f 0 0 0 0 1</code></pre>
</div>
</div>
<p>Silge und Robinson verdeutlichen das Prinzip von <code>widyr</code> so, s. <a href="#fig-widyr">Abbildung&nbsp;<span>5.4</span></a>.</p>
<div id="fig-widyr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/widyr.jpeg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.4: Die Funktionsweise von widyr, Quelle: Silge und Robinson</figcaption><p></p>
</figure>
</div>
<p>(Vgl. auch die <a href="https://bookdown.org/Maxine/tidy-text-mining/counting-and-correlating-pairs-of-words-with-widyr.html">Erklärung hier</a>.)</p>
<p>Bauen wir das mal von Hand nach.</p>
<p>Randwahrscheinlichkeiten von <code>a</code> und <code>c</code> sowie deren Produkt, <code>p_a_p_c</code>:</p>
<div class="cell" data-hash="word-embedding_cache/html/p_a_und_p_c_cb9d1c4dd674d63725e290cb7ecfe130">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>p_a <span class="ot">&lt;-</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>p_c <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">5</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>p_a_p_c <span class="ot">&lt;-</span> p_a <span class="sc">*</span> p_c</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>p_a_p_c</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.24</code></pre>
</div>
</div>
<p>Gemeinsame Wahrscheinlichkeit von <code>a</code> und <code>c</code>:</p>
<div class="cell" data-hash="word-embedding_cache/html/p_ac_9d3e2000f4997d5a67ea625b29577fc2">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>p_ac <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">5</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>PMI von Hand berechnet:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-29_9dcafe4fe8438a34869a324e9fe3ee32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(p_ac<span class="sc">/</span>p_a_p_c)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5108256</code></pre>
</div>
</div>
<p>Man beachte, dass hier als Basis <span class="math inline">\(e\)</span>, der natürliche Logarithmus, verwendet wurde (nicht 2).</p>
<p>Jetzt berechnen wir die PMI mit <code>pairwise_pmi</code>.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-30_4c32a90400cbd80b70a90668a0632d56">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise_pmi</span>(dat, <span class="at">item =</span> item, <span class="at">feature =</span> feature)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: left;">item2</th>
<th style="text-align: right;">pmi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b</td>
<td style="text-align: left;">a</td>
<td style="text-align: right;">-0.5877867</td>
</tr>
<tr class="even">
<td style="text-align: left;">c</td>
<td style="text-align: left;">a</td>
<td style="text-align: right;">0.5108256</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: left;">b</td>
<td style="text-align: right;">-0.5877867</td>
</tr>
<tr class="even">
<td style="text-align: left;">e</td>
<td style="text-align: left;">b</td>
<td style="text-align: right;">0.5108256</td>
</tr>
<tr class="odd">
<td style="text-align: left;">f</td>
<td style="text-align: left;">b</td>
<td style="text-align: right;">0.5108256</td>
</tr>
<tr class="even">
<td style="text-align: left;">a</td>
<td style="text-align: left;">c</td>
<td style="text-align: right;">0.5108256</td>
</tr>
<tr class="odd">
<td style="text-align: left;">b</td>
<td style="text-align: left;">e</td>
<td style="text-align: right;">0.5108256</td>
</tr>
<tr class="even">
<td style="text-align: left;">b</td>
<td style="text-align: left;">f</td>
<td style="text-align: right;">0.5108256</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Wie man sieht, entspricht unserer Berechnung von Hand der Berechnung mit <code>pairwise_pmi</code>.</p>
</section>
<section id="sliding" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="sliding"><span class="header-section-number">5.5.2</span> Sliding</h3>
<p>Sliding ist ein interessantes Konzept, aber man braucht vielleicht etwas Zeit, um sein Hirn um das Konzept zu wickeln…</p>
<p>Hier eine Illustration:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-31_01b89f2ac57a47ab5158f42153a0f8a4">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>txt_vec <span class="ot">&lt;-</span> <span class="st">"Das ist ein Test, von dem nicht viel zu erwarten ist"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>slider<span class="sc">::</span><span class="fu">slide</span>(txt_vec, <span class="sc">~</span> .x, <span class="at">.before =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "Das ist ein Test, von dem nicht viel zu erwarten ist"</code></pre>
</div>
</div>
<p>Oh, da passiert nichts?! Kaputt? Nein, wir müssen jedes Wort als <em>ein Element</em> des Vektors auffassen.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-32_3259e770d90e6ae2d000d73963062b8c">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>txt_df <span class="ot">&lt;-</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">txt =</span> txt_vec) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">input =</span> txt, <span class="at">output =</span> word)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(txt_df)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">word</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">das</td>
</tr>
<tr class="even">
<td style="text-align: left;">ist</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ein</td>
</tr>
<tr class="even">
<td style="text-align: left;">test</td>
</tr>
<tr class="odd">
<td style="text-align: left;">von</td>
</tr>
<tr class="even">
<td style="text-align: left;">dem</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-33_a34ef1420c83a15cad31e783077d833e">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>slider<span class="sc">::</span><span class="fu">slide</span>(txt_df<span class="sc">$</span>word, <span class="sc">~</span> .x, <span class="at">.before =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "das"

[[2]]
[1] "das" "ist"

[[3]]
[1] "das" "ist" "ein"

[[4]]
[1] "ist"  "ein"  "test"

[[5]]
[1] "ein"  "test" "von" 

[[6]]
[1] "test" "von"  "dem" 

[[7]]
[1] "von"   "dem"   "nicht"

[[8]]
[1] "dem"   "nicht" "viel" 

[[9]]
[1] "nicht" "viel"  "zu"   

[[10]]
[1] "viel"     "zu"       "erwarten"

[[11]]
[1] "zu"       "erwarten" "ist"     </code></pre>
</div>
</div>
<p>Ah!</p>
<p>Das Aufteilen in einzelne Wörter pro Element des Vektors könnte man auch so erreichen:</p>
<div class="cell" data-hash="word-embedding_cache/html/slide2_e5dcc892df2609b57d7d10241f30efd1">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>txt_vec2 <span class="ot">&lt;-</span> <span class="fu">str_split</span>(txt_vec, <span class="at">pattern =</span> <span class="fu">boundary</span>(<span class="st">"word"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">simplify</span>() </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">slide</span>(txt_vec2, <span class="at">.f =</span> <span class="sc">~</span>.x, <span class="at">.before =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Shifting non-numeric variables is not possible.
  Try using 'to_numeric()' and specify the 'lowest' argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Das"      "ist"      "ein"      "Test"     "von"      "dem"     
 [7] "nicht"    "viel"     "zu"       "erwarten" "ist"     </code></pre>
</div>
</div>
<p>In unserem Beispiel mit den Beschwerden:</p>
<div class="cell" data-hash="word-embedding_cache/html/slide3_21831aaa31a8416afe5706135f2634db">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slide</span>(beschwerde1_text<span class="sc">$</span>word,  <span class="sc">~</span>.x, <span class="at">.before =</span> <span class="dv">2</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Shifting non-numeric variables is not possible.
  Try using 'to_numeric()' and specify the 'lowest' argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "systems"    "inc"        "is"         "trying"     "to"        
 [6] "collect"    "a"          "debt"       "that"       "is"        
[11] "not"        "mine"       "not"        "owed"       "and"       
[16] "is"         "inaccurate"</code></pre>
</div>
</div>
</section>
<section id="funktion-slide_windows" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="funktion-slide_windows"><span class="header-section-number">5.5.3</span> Funktion <code>slide_windows</code></h3>
<p>Die Funktion <code>slide_windows</code> im <a href="https://smltar.com/embeddings.html#understand-word-embeddings-by-finding-them-yourself">Kapitel 5.2</a> ist recht kompliziert. In solchen Fällen ist es hilfreich, sich jeden Schritt einzeln ausführen zu lassen. Das machen wir jetzt mal.</p>
<p>Hier ist die Syntax der Funktion <code>slide_windows</code>:</p>
<div class="cell" data-hash="word-embedding_cache/html/fun-slide-win_b983151588f48ae750cec19f48b8e563">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>slide_windows <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, window_size) {</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  skipgrams <span class="ot">&lt;-</span> slider<span class="sc">::</span><span class="fu">slide</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    tbl, </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>.x,  <span class="co"># Syntax ähnlich zu purrr::map()</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> window_size <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.step =</span> <span class="dv">1</span>, </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.complete =</span> <span class="cn">TRUE</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  safe_mutate <span class="ot">&lt;-</span> <span class="fu">safely</span>(mutate)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">map2</span>(skipgrams,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(skipgrams),</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>              <span class="sc">~</span> <span class="fu">safe_mutate</span>(.x, <span class="at">window_id =</span> .y))</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  out <span class="sc">%&gt;%</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transpose</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">"result"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compact</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Erschwerend kommt eine große Datenmenge und eine lange Berechnungszeit dazu, was das Debuggen (Nachvollziehen und Durchdenken) der Schritte zusätzlich erschwert. In solchen Fällen hilft die goldene Regel: Mach es dir so einfach wie möglich (aber nicht einfacher). Wir nutzen also den stark verkleinerten Datensatz <code>nested_words3</code>, den wir oben importiert haben.</p>
<p>Zuerst erlauben wir mal, dasss unsere R-Session mehrere Kerne benutzen darf.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-34_7bbbdaa62e57a8f4b0e00851ae09079e">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)  <span class="do">## for parallel processing</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Funktion <code>slide_windows</code> ist recht kompliziert. Es hilft oft, sich mit <code>debug(fun)</code> eine Funktion Schritt für Schritt anzuschauen.</p>
<p>Gehen wir Schritt für Schritt durch die Syntax von <code>slide_windows</code>.</p>
<p>Werfen wir einen Blick in <code>words</code>, erstes Element (ein Tibble mit einer Spalte). Denn <code>die einzelnen Elemente von</code>words<code>werden an die Funktion</code>slide_windows` als “Futter” übergeben.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-35_80fa3c83b45e49d99ef1ffec69d9e383">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>futter1 <span class="ot">&lt;-</span> nested_words3[[<span class="st">"words"</span>]][[<span class="dv">1</span>]]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>futter1</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">word</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">systems</td>
</tr>
<tr class="even">
<td style="text-align: left;">inc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is</td>
</tr>
<tr class="even">
<td style="text-align: left;">trying</td>
</tr>
<tr class="odd">
<td style="text-align: left;">to</td>
</tr>
<tr class="even">
<td style="text-align: left;">collect</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a</td>
</tr>
<tr class="even">
<td style="text-align: left;">debt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">that</td>
</tr>
<tr class="even">
<td style="text-align: left;">is</td>
</tr>
<tr class="odd">
<td style="text-align: left;">not</td>
</tr>
<tr class="even">
<td style="text-align: left;">mine</td>
</tr>
<tr class="odd">
<td style="text-align: left;">not</td>
</tr>
<tr class="even">
<td style="text-align: left;">owed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">and</td>
</tr>
<tr class="even">
<td style="text-align: left;">is</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inaccurate</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Das ist der Text der ersten Beschwerde.</p>
<p>Okay, also dann geht’s los durch die einzelnen Schritte der Funktion <code>slide_windows</code>.</p>
<p>Zunächst holen wir uns die “Fenster” oder “Skipgrams”:</p>
<div class="cell" data-hash="word-embedding_cache/html/skipgrams1_1f55aab5912f2d65d8dafbd8b4dc6f44">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>skipgrams1 <span class="ot">&lt;-</span> slider<span class="sc">::</span><span class="fu">slide</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>   futter1, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>.x, </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> <span class="dv">3</span>, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.step =</span> <span class="dv">1</span>, </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.complete =</span> <span class="cn">TRUE</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bei <code>slide(tbl, ~.x)</code> geben wir die Funktion an, die auf <code>tbl</code> angewendet werden soll. Daher auch die Tilde, die uns von <code>purrr::map()</code> her bekannt ist. In unserem Fall wollen wir nur die Elemente auslesen; Elemente auslesen erreicht man, in dem man sie mit Namen anspricht, in diesem Fall mit dem Platzhalter <code>.x</code>.</p>
<p>Jedes Element von <code>skipgrams1</code> ist ein 4*1-Tibble und ist ein Skripgram.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-36_856c935827848316a76983ae5b549808">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>skipgrams1 <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 17
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "systems" "inc" "is" "trying"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "inc" "is" "trying" "to"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "is" "trying" "to" "collect"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "trying" "to" "collect" "a"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "to" "collect" "a" "debt"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "collect" "a" "debt" "that"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "a" "debt" "that" "is"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "debt" "that" "is" "not"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "that" "is" "not" "mine"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "is" "not" "mine" "not"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "not" "mine" "not" "owed"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "mine" "not" "owed" "and"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "not" "owed" "and" "is"
 $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ word: chr [1:4] "owed" "and" "is" "inaccurate"
 $ : NULL
 $ : NULL
 $ : NULL</code></pre>
</div>
</div>
<p>Das zweite Skipgram von <code>skipgrams1</code> enthält, naja, das zweite Skipgram.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-37_4f01ccf1d8fe9b0fc6f2b6cbe3805b9e">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>skipgrams1[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [4 × 1] (S3: tbl_df/tbl/data.frame)
 $ word: chr [1:4] "inc" "is" "trying" "to"</code></pre>
</div>
</div>
<p>Und so weiter.</p>
<p>Okay, weiter im Programm. Jetzt mappen wir das Erstellen der Skipgrams</p>
<div class="cell" data-hash="word-embedding_cache/html/skipgrams2_138e1e00287a9332b3e4b1dc951e13aa">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>safe_mutate <span class="ot">&lt;-</span> <span class="fu">safely</span>(mutate)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">&lt;-</span> <span class="fu">map2</span>(skipgrams1,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>             <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(skipgrams1),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>             <span class="sc">~</span> <span class="fu">safe_mutate</span>(.x, <span class="at">window_id =</span> .y))</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>out1 <span class="sc">%&gt;%</span> </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 2
 $ :List of 2
  ..$ result: tibble [4 × 2] (S3: tbl_df/tbl/data.frame)
  .. ..$ word     : chr [1:4] "systems" "inc" "is" "trying"
  .. ..$ window_id: int [1:4] 1 1 1 1
  ..$ error : NULL
 $ :List of 2
  ..$ result: tibble [4 × 2] (S3: tbl_df/tbl/data.frame)
  .. ..$ word     : chr [1:4] "inc" "is" "trying" "to"
  .. ..$ window_id: int [1:4] 2 2 2 2
  ..$ error : NULL</code></pre>
</div>
</div>
<p><code>out1</code> ist eine Liste mit 17 Elementen; jedes Element mit jeweils zwei Elementen: Den Ergebnissen und ob es einen Fehler gab bei <code>safe_mutate</code>. Die 10 Elemente entsprechen den 10 Skipgrams. Wir können aber <code>out1</code> auch “drehen”, transponieren genauer gesagt. so dass wir eine Liste mit <em>zwei</em> Elementen bekommen: das erste Element hat die (zehn) Ergebnisse (nämlich die Skipgrams) und das zweite Elemente, ob es Fehler gab.</p>
<p>Das Prinzip des Transponierens ist in <a href="#fig-Matrix-transpose">Abbildung&nbsp;<span>5.5</span></a> dargestellt.</p>
<div id="fig-Matrix-transpose" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/Matrix_transpose.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.5: Transponieren einer Matrix (“Tabelle”)</figcaption><p></p>
</figure>
</div>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-38_7491d02ba2214d8dc2e79d45da82cc3a">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>out2 <span class="ot">&lt;-</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>out1 <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transpose</span>() </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puh, das ist schon anstrengendes Datenyoga…</p>
<p>Aber jetzt ist es einfach. Wir ziehen das erste der beiden Elemente, die Ergebnisse heraus (<code>pluck</code>), entfernen leere Elemente (<code>compact</code>) und machen einen Tibble daraus (<code>bind_rows</code>):</p>
<div class="cell" data-hash="word-embedding_cache/html/skipgrams3_5369a5f6e299383c4f2ac45355e1c785">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>out2 <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="st">"result"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">compact</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">word</th>
<th style="text-align: right;">window_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">systems</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">trying</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inc</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">is</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Geschafft!</p>
</section>
<section id="ähnlichkeit-berechnen" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="ähnlichkeit-berechnen"><span class="header-section-number">5.5.4</span> Ähnlichkeit berechnen</h3>
<p>Nachdem wir jetzt <code>slide_windows</code> kennen, schauen wir uns die nächsten Schritte an:</p>
<div class="cell" data-hash="word-embedding_cache/html/tidy-pmi1_19987c2a8a31d3389d843383429b46b4">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>tidy_pmi1 <span class="ot">&lt;-</span> nested_words3 <span class="sc">%&gt;%</span>  <span class="co"># &lt;--- Kleiner Datensatz!</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">words =</span> <span class="fu">future_map</span>(words, slide_windows, 4L))</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir werden <code>slide_windows</code> auf die Liste <code>words</code> an, die die Beschwerden enthält. Für jede Beschwerde erstellen wir die Skipgrams; diese Schleife wird realisiert über <code>map</code> bzw. <code>future_map</code>, die uns erlaubt, mehrere Kerne des Rechners gleichzeitig zu nutzen, damit es schneller geht.</p>
<p>Hier sehen wir z.B. die Skipgram-IDs der ersten Beschwerde.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-39_520e3e446b13f2e94ca32d72f07c160a">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>tidy_pmi1[[<span class="st">"words"</span>]][[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">word</th>
<th style="text-align: right;">window_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">systems</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">trying</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inc</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">is</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Genestet siehst es so aus:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-40_b71dbc465e25d3dfedddfd7347c8b75d">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>tidy_pmi1 <span class="sc">%&gt;%</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 0%">
<col style="width: 99%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">complaint_id</th>
<th style="text-align: left;">words</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">systems , inc , is , trying , inc , is , trying , to , is , trying , to , collect , trying , to , collect , a , to , collect , a , debt , collect , a , debt , that , a , debt , that , is , debt , that , is , not , that , is , not , mine , is , not , mine , not , not , mine , not , owed , mine , not , owed , and , not , owed , and , is , owed , and , is , inaccurate, 1 , 1 , 1 , 1 , 2 , 2 , 2 , 2 , 3 , 3 , 3 , 3 , 4 , 4 , 4 , 4 , 5 , 5 , 5 , 5 , 6 , 6 , 6 , 6 , 7 , 7 , 7 , 7 , 8 , 8 , 8 , 8 , 9 , 9 , 9 , 9 , 10 , 10 , 10 , 10 , 11 , 11 , 11 , 11 , 12 , 12 , 12 , 12 , 13 , 13 , 13 , 13 , 14 , 14 , 14 , 14</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Die Listenspalte entschachteln wir mal:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-41_9e2fc9e97d889efd1eb5e925538af57d">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>tidy_pmi2 <span class="ot">&lt;-</span> tidy_pmi1 <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(words)  <span class="co"># entschachtele</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>tidy_pmi2 <span class="sc">%&gt;%</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">complaint_id</th>
<th style="text-align: left;">word</th>
<th style="text-align: right;">window_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">systems</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">is</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">trying</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">is</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Zum Berechnen der Ähnlichkeit brauchen wir eineindeutige IDs, nach dem Prinzip “1. Skipgram der 1. Beschwerde” etc:</p>
<div class="cell" data-hash="word-embedding_cache/html/tidy-pmi3_df33a12b36a516d2cb503e51a793e0ca">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>tidy_pmi3 <span class="ot">&lt;-</span> tidy_pmi2 <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(window_id, complaint_id, window_id)  <span class="co"># führe Spalten zusammen</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>tidy_pmi3 <span class="sc">%&gt;%</span> </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">window_id</th>
<th style="text-align: left;">word</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">3384392_1</td>
<td style="text-align: left;">systems</td>
</tr>
<tr class="even">
<td style="text-align: left;">3384392_1</td>
<td style="text-align: left;">inc</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3384392_1</td>
<td style="text-align: left;">is</td>
</tr>
<tr class="even">
<td style="text-align: left;">3384392_1</td>
<td style="text-align: left;">trying</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3384392_2</td>
<td style="text-align: left;">inc</td>
</tr>
<tr class="even">
<td style="text-align: left;">3384392_2</td>
<td style="text-align: left;">is</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Schließlich berechnen wir die Ähnlichkeit mit <code>pairwise_pmi</code>, das hatten wir uns oben schon mal näher angeschaut:</p>
<div class="cell" data-hash="word-embedding_cache/html/tidy-pmi4_dfcb74e499a5d8d93e0bde3957208976">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>tidy_pmi4 <span class="ot">&lt;-</span> tidy_pmi3 <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_pmi</span>(word, window_id)  <span class="co"># berechne Ähnlichkeit</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>tidy_pmi <span class="ot">&lt;-</span> tidy_pmi4  <span class="co"># mit dem Objekt arbeiten wir dann weiter</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>tidy_pmi <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: left;">item2</th>
<th style="text-align: right;">pmi</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">inc</td>
<td style="text-align: left;">systems</td>
<td style="text-align: right;">5.728498</td>
</tr>
<tr class="even">
<td style="text-align: left;">is</td>
<td style="text-align: left;">systems</td>
<td style="text-align: right;">2.838126</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trying</td>
<td style="text-align: left;">systems</td>
<td style="text-align: right;">5.035351</td>
</tr>
<tr class="even">
<td style="text-align: left;">systems</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">5.728498</td>
</tr>
<tr class="odd">
<td style="text-align: left;">is</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">2.838126</td>
</tr>
<tr class="even">
<td style="text-align: left;">trying</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">5.035351</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="svd" class="level3" data-number="5.5.5">
<h3 data-number="5.5.5" class="anchored" data-anchor-id="svd"><span class="header-section-number">5.5.5</span> SVD</h3>
<p>Die <em>Singulärwertzerlegung</em> (singular value decomposition, SVD) ist ein Verfahren zur Verringerung der Spaltenzahl (Dimension), vergleichbar zur Faktorenanalyse. Zur Anschaulichkeit - und ohne substanziellen Hintergrund - sei folgendes Beispiel genannt: Die Verben “gehen”, “rennen”, “laufen”, “schwimmen”, “fahren”, “rutschen” könnten zu einer gemeinsamen Dimension, etwa “fortbewegen” reduziert werden. Jedes einzelne der eingehenden Verben erhält eine Zahl von 0 bis 1, das die konzeptionelle Nähe des Verbs zur “dahinterliegenden” Dimension (fortbewegen) quantifiziert; die Zahl nennt man auch die “Ladung” des Items (Worts) auf die Dimension. Sagen wir, wir identifizieren 10 Dimensionen. Man erhält dann für jedes unique Wort im Corpus einen Vektor mit den Ladungen auf die Dimensionen. Im genannten Beispiel wäre es ein 10-stelliger Vektor. So wie ein 3-stelliger Vektor die Position einer Biene im Raum beschreibt<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a>, beschreibt hier unser 10-stelliger Vektor die “Position” eines Worts in unserem <em>Einbettungsvektor</em>.</p>
<p>Die Syntax dazu ist dieses Mal einfach:</p>
<div class="cell" data-hash="word-embedding_cache/html/widely-svd_0d6a1d676a38c10b6e7d5d212db344ba">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors <span class="ot">&lt;-</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  tidy_pmi <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">widely_svd</span>(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    item1, item2, pmi,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">nv =</span> <span class="dv">100</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors <span class="sc">%&gt;%</span> </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  (head)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: right;">dimension</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.0378963</td>
</tr>
<tr class="even">
<td style="text-align: left;">is</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.1132069</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trying</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.0512764</td>
</tr>
<tr class="even">
<td style="text-align: left;">systems</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.0333332</td>
</tr>
<tr class="odd">
<td style="text-align: left;">to</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.1203434</td>
</tr>
<tr class="even">
<td style="text-align: left;">collect</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-0.0554211</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Mit <code>nv = 100</code> haben wir die Anzahl (<code>n</code>) der Dimensionen (Variablen, <code>v</code>) auf 100 bestimmt.</p>
</section>
<section id="wortähnlichkeit" class="level3" data-number="5.5.6">
<h3 data-number="5.5.6" class="anchored" data-anchor-id="wortähnlichkeit"><span class="header-section-number">5.5.6</span> Wortähnlichkeit</h3>
<p>Jetzt, da wir mit der SVD jedes Wort in einem Koordinatensystem verortet haben, können wir die Abstände der Wörter im Koordinatensystem bestimmen. Das geht mit Hilfe des alten Pythagoras, s. <a href="#fig-euklid-distance">Abbildung&nbsp;<span>5.6</span></a>. Der Abstand, den man mit Hilfe des Satz des Pythagoras berechnet, nennt man auch <em>euklidische Distanz</em>.</p>
<div id="fig-euklid-distance" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/euklid-distance.png" class="img-fluid figure-img" style="width:50.0%"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.6: Euklidische Distanz in 2D, Quelle: Wikipedia, CC BY4.0, Kmhkmh</figcaption><p></p>
</figure>
</div>
<p>Okay, wir sind in einem Raum mit vielen Dimensionen, was mein Hirn nicht mitmacht, <a href="https://mathworld.wolfram.com/Distance.html">aber der Algebra ist das egal</a>. Pythagoras’ Satz lässt sich genauso anwenden, wenn es mehr als Dimensionen sind.</p>
<p>Die Autoren basteln sich selber eine Funktion in <a href="https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings">Kap. 5.3</a>, aber der Einfachheit halber nehme ich (erstmal) die entsprechende Funktion aus <code>widyr</code>:</p>
<div class="cell" data-hash="word-embedding_cache/html/pairwise-dist_177476962fa68331a32177a2dd2f332d">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>word_neighbors <span class="ot">&lt;-</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_dist</span>(item1, dimension, value)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>word_neighbors <span class="sc">%&gt;%</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: left;">item2</th>
<th style="text-align: right;">distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">is</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1.0220141</td>
</tr>
<tr class="even">
<td style="text-align: left;">trying</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">0.9332851</td>
</tr>
<tr class="odd">
<td style="text-align: left;">systems</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">0.4161215</td>
</tr>
<tr class="even">
<td style="text-align: left;">to</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1.0913872</td>
</tr>
<tr class="odd">
<td style="text-align: left;">collect</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">0.5221759</td>
</tr>
<tr class="even">
<td style="text-align: left;">a</td>
<td style="text-align: left;">inc</td>
<td style="text-align: right;">1.0309566</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Schauen wir uns ein Beispiel an. Was sind die Nachbarn von “inaccurate”?</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-42_5bf9ee49435e6c224f6a12a7fe427b5f">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>word_neighbors <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item1 <span class="sc">==</span> <span class="st">"inaccurate"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(distance) <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: left;">item2</th>
<th style="text-align: right;">distance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">inaccurate</td>
<td style="text-align: left;">mine</td>
<td style="text-align: right;">0.5248868</td>
</tr>
<tr class="even">
<td style="text-align: left;">inaccurate</td>
<td style="text-align: left;">score</td>
<td style="text-align: right;">0.5310116</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inaccurate</td>
<td style="text-align: left;">oh</td>
<td style="text-align: right;">0.5400913</td>
</tr>
<tr class="even">
<td style="text-align: left;">inaccurate</td>
<td style="text-align: left;">ny</td>
<td style="text-align: right;">0.5400913</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inaccurate</td>
<td style="text-align: left;">dob</td>
<td style="text-align: right;">0.5801281</td>
</tr>
<tr class="even">
<td style="text-align: left;">inaccurate</td>
<td style="text-align: left;">cell</td>
<td style="text-align: right;">0.6093670</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Hier ist die Datenmenge zu klein, um vernünftige Schlüsse zu ziehen. Aber “incorrectly”, “correct”, “balance” sind wohl plausible Nachbarn von “inaccurate”.</p>
</section>
<section id="cosinus-ähnlichkeit" class="level3" data-number="5.5.7">
<h3 data-number="5.5.7" class="anchored" data-anchor-id="cosinus-ähnlichkeit"><span class="header-section-number">5.5.7</span> Cosinus-Ähnlichkeit</h3>
<p>Die Nähe zweier Vektoren lässt sich, neben der euklidischen Distanz, auch z.B. über die <a href="https://en.wikipedia.org/wiki/Cosine_similarity">Cosinus-Ähnlichkeit</a> (Cosine similarity) berechnen, vgl. auch <a href="#fig-dotproduct">Abbildung&nbsp;<span>5.7</span></a>:</p>
<div id="fig-dotproduct" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/dotproduct.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.7: Die Cosinus-Ähnlichkeit zweier Vektoren</figcaption><p></p>
</figure>
</div>
<p><a href="https://en.wikipedia.org/wiki/Dot_product#/media/File:Dot_Product.svg">Quelle: Mazin07, Lizenz: PD</a></p>
<p><span class="math display">\[{\displaystyle {\text{Cosinus-Ähnlichkeit}}=S_{C}(A,B):=\cos(\theta )={\mathbf {A} \cdot \mathbf {B}  \over \|\mathbf {A} \|\|\mathbf {B} \|}={\frac {\sum \limits _{i=1}^{n}{A_{i}B_{i}}}{{\sqrt {\sum \limits _{i=1}^{n}{A_{i}^{2}}}}{\sqrt {\sum \limits _{i=1}^{n}{B_{i}^{2}}}}}},}\]</span></p>
<p>wobei <span class="math inline">\(A\)</span> und <span class="math inline">\(B\)</span> zwei Vektoren sind und <span class="math inline">\(\|\mathbf {A} \|\)</span> das Skalarprodukt von A (und B genauso). Das <a href="https://en.wikipedia.org/wiki/Dot_product">Skalarprodukt</a> von <span class="math inline">\(\color {red} {a = {\displaystyle [a_{1},a_{2},\cdots ,a_{n}]}}\)</span> und <span class="math inline">\(\color {blue} {b = {\displaystyle [b_{1},b_{2},\cdots ,b_{n}]}}\)</span> ist so definiert:</p>
<p><span class="math display">\[{\displaystyle \mathbf {\color {red}a} \cdot \mathbf {\color {blue}b} =\sum _{i=1}^{n}{\color {red}a}_{i}{\color {blue}b}_{i}={\color {red}a}_{1}{\color {blue}b}_{1}+{\color {red}a}_{2}{\color {blue}b}_{2}+\cdots +{\color {red}a}_{n}{\color {blue}b}_{n}}\]</span></p>
<p>Entsprechend ist die Funktion <code>nearest_neighbors</code> zu verstehen aus <a href="https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings">Kap. 5.3</a>:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-43_ede12f54d4b747bca93650b8f62b3a3b">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>nearest_neighbors <span class="ot">&lt;-</span> <span class="cf">function</span>(df, token) {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">widely</span>(</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> {</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>        y <span class="ot">&lt;-</span> .[<span class="fu">rep</span>(token, <span class="fu">nrow</span>(.)), ]</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(. <span class="sc">*</span> y) <span class="sc">/</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">sqrt</span>(<span class="fu">rowSums</span>(. <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(.[token, ] <span class="sc">^</span> <span class="dv">2</span>)))</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span>(res, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">names</span>(res)))</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">sort =</span> <span class="cn">TRUE</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    )(item1, dimension, value) <span class="sc">%&gt;%</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wobei mit <code>widely</code> zuerst noch von der Langform in die Breitform umformatiert wird, da die Breitform von der Formel verlangt wird bzw. das Rechnen einfacher macht.</p>
<p>Der eine Vektor ist das Embedding des Tokens, der andere Vektor ist das <em>mittlere</em> Embedding über alle Tokens des Corpus. Wenn die Anzahl der Elemente konstant bleibt, kann man sich das Teilen durch <span class="math inline">\(n\)</span> schenken, wenn man einen Mittelwert berechnen; so hält es auch die Syntax von <code>nearest_neighbors</code>.</p>
<p>Ein nützlicher Post zur Cosinus-Ähnlichkeit findet sich <a href="https://towardsdatascience.com/cosine-similarity-how-does-it-measure-the-similarity-maths-behind-and-usage-in-python-50ad30aad7db">hier</a>. <a href="https://datascience-enthusiast.com/figures/cosine_sim.png">Dieses Bild</a> zeigt das Konzept der Cosinus-Ähnlichkeit anschaulich.</p>
<p>Zur Erinnerung: Der Cosinus eines Winkels ist definiert als Verhältnis der Länge der Ankathete (das ist jene Kathete, die einen Schenkel des Winkels bildet) zur Länge der Hypotenuse<a href="#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a> in einem rechtwinkligen, vgl. <a href="#fig-dreieck">Abbildung&nbsp;<span>5.8</span></a>.</p>
<div id="fig-dreieck" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/dreieck.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Abbildung&nbsp;5.8: Ein rechtwinkliges Dreieck als Grundlage der trigonometrischen Funktionen</figcaption><p></p>
</figure>
</div>
<p>Also: <span class="math inline">\({\displaystyle \cos \alpha ={\frac {b}{c}}}\)</span></p>
<p><a href="https://de.wikipedia.org/wiki/Sinus_und_Kosinus#/media/Datei:RechtwinkligesDreieck.svg">Quelle: PaterSigmund, Wikipedia,dre CC-BY-SA 2.5</a></p>
<p>Hilfreich ist auch <a href="https://de.wikipedia.org/wiki/Sinus_und_Kosinus#/media/Datei:Sinus_und_Kosinus_am_Einheitskreis_1.svg">die Visualisierung von Sinus und Cosinus am Einheitskreis</a>; gerne <a href="https://upload.wikimedia.org/wikipedia/commons/f/f3/Sinus_und_Cosinus_am_Einheitskreis.gif">animiert</a> betrachten.</p>
</section>
</section>
<section id="word-embeddings-vorgekocht" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="word-embeddings-vorgekocht"><span class="header-section-number">5.6</span> Word-Embeddings vorgekocht</h2>
<section id="glove6b" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="glove6b"><span class="header-section-number">5.6.1</span> Glove6B</h3>
<p>In <a href="https://smltar.com/embeddings.html#glove">Kap. 5.4</a> schreiben die Autoren:</p>
<blockquote class="blockquote">
<p>If your data set is too small, you typically cannot train reliable word embeddings.</p>
</blockquote>
<p>Ein paar Millionen Wörter sollte der Corpus schon enthalten, so die Autoren. Da solche “Worteinbettungen” (word embedings) aufwändig zu erstellen sind, kann man fertige, “vorgekochte” Produkte nutzen.</p>
<p>Glove6B wurde anhand von Wikipedia und anderen Datenquellen erstellt <span class="citation" data-cites="pennington_glove_2014">(<a href="references.html#ref-pennington_glove_2014" role="doc-biblioref">Pennington, Socher, und Manning 2014</a>)</span>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Die zugehörigen Daten sind recht groß; für <a href="https://nlp.stanford.edu/projects/glove/"><code>glove6b</code></a> <span class="citation" data-cites="pennington_glove_2014">(<a href="references.html#ref-pennington_glove_2014" role="doc-biblioref">Pennington, Socher, und Manning 2014</a>)</span> ist fast ein Gigabyte fällig. Sie sollten sich die Daten in einem ruhigen Moment (mit stabiler Internetverbindung) herunterladen und in einem Verzeichnis meiner Wahl abgespeichert (<code>datasets</code>). Da bei mir Download abbrach, als ich <code>embedding_glove6b(dimensions = 100)</code> aufrief, habe ich die Daten manuell heruntergeladen, s.u.</p>
</div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/load-glove_d8b599abb68e4895d12c7b99ec8d8dec">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>glove6b <span class="ot">&lt;-</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">embedding_glove6b</span>(<span class="at">dir =</span> <span class="st">"~/datasets"</span>, <span class="at">dimensions =</span> <span class="dv">50</span>, <span class="at">manual_download =</span> <span class="cn">TRUE</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>glove6b <span class="sc">%&gt;%</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">token</th>
<th style="text-align: right;">d1</th>
<th style="text-align: right;">d2</th>
<th style="text-align: right;">d3</th>
<th style="text-align: right;">d4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the</td>
<td style="text-align: right;">0.418000</td>
<td style="text-align: right;">0.249680</td>
<td style="text-align: right;">-0.41242</td>
<td style="text-align: right;">0.121700</td>
</tr>
<tr class="even">
<td style="text-align: left;">,</td>
<td style="text-align: right;">0.013441</td>
<td style="text-align: right;">0.236820</td>
<td style="text-align: right;">-0.16899</td>
<td style="text-align: right;">0.409510</td>
</tr>
<tr class="odd">
<td style="text-align: left;">.</td>
<td style="text-align: right;">0.151640</td>
<td style="text-align: right;">0.301770</td>
<td style="text-align: right;">-0.16763</td>
<td style="text-align: right;">0.176840</td>
</tr>
<tr class="even">
<td style="text-align: left;">of</td>
<td style="text-align: right;">0.708530</td>
<td style="text-align: right;">0.570880</td>
<td style="text-align: right;">-0.47160</td>
<td style="text-align: right;">0.180480</td>
</tr>
<tr class="odd">
<td style="text-align: left;">to</td>
<td style="text-align: right;">0.680470</td>
<td style="text-align: right;">-0.039263</td>
<td style="text-align: right;">0.30186</td>
<td style="text-align: right;">-0.177920</td>
</tr>
<tr class="even">
<td style="text-align: left;">and</td>
<td style="text-align: right;">0.268180</td>
<td style="text-align: right;">0.143460</td>
<td style="text-align: right;">-0.27877</td>
<td style="text-align: right;">0.016257</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Die ersten paar Tokens sind:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-44_714d90f71db53df1a43f3ad2da757aeb">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>glove6b<span class="sc">$</span>token <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "the"  ","    "."    "of"   "to"   "and"  "in"   "a"    "\""   "'s"  
[11] "for"  "-"    "that" "on"   "is"   "was"  "said" "with" "he"   "as"  </code></pre>
</div>
</div>
<p>In eine Tidyform bringen:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-45_1b648c4dbbaf0c3e94ce7b4c3a4fbf28">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>tidy_glove <span class="ot">&lt;-</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  glove6b <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">"d"</span>),</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"dimension"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">item1 =</span> token)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_glove)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: left;">dimension</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">the</td>
<td style="text-align: left;">d1</td>
<td style="text-align: right;">0.418000</td>
</tr>
<tr class="even">
<td style="text-align: left;">the</td>
<td style="text-align: left;">d2</td>
<td style="text-align: right;">0.249680</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the</td>
<td style="text-align: left;">d3</td>
<td style="text-align: right;">-0.412420</td>
</tr>
<tr class="even">
<td style="text-align: left;">the</td>
<td style="text-align: left;">d4</td>
<td style="text-align: right;">0.121700</td>
</tr>
<tr class="odd">
<td style="text-align: left;">the</td>
<td style="text-align: left;">d5</td>
<td style="text-align: right;">0.345270</td>
</tr>
<tr class="even">
<td style="text-align: left;">the</td>
<td style="text-align: left;">d6</td>
<td style="text-align: right;">-0.044457</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Ganz schön groß:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-46_54f0c8fdc49b500dfe5af5a92444a317">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(glove6b)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 400000     51</code></pre>
</div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-47_aeda1d9616721df6e8fd030e150a2087">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(tidy_glove)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>503834736 bytes</code></pre>
</div>
</div>
<p>In Megabyte<a href="#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a></p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-48_ce4e3490870a7c07cc4f7263de90e1ad">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">object.size</span>(tidy_glove) <span class="sc">/</span> <span class="dv">2</span><span class="sc">^</span><span class="dv">20</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>480.5 bytes</code></pre>
</div>
</div>
<p>Einfacher und genauer geht es so:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-49_35852b3d93ff696ae8bcd0324fb52f8f">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">object_size</span>(tidy_glove)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>503.83 MB</code></pre>
</div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-50_051ba459d56dc243a9b520f5fe631d60">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>pryr<span class="sc">::</span><span class="fu">mem_used</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>850 MB</code></pre>
</div>
</div>
<p>Um Speicher zu sparen, könnte man <code>glove6b</code> wieder direkt löschen, wenn man nur mit der Tidyform weiterarbeitet.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-51_1910b3ce3239a39cc849604d32cd07ec">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(glove6b)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Jetzt können wir wieder nach Nachbarn fragen, im euklidischen Sinne, wie oben. Probieren wir aus, welche Wörter nah zu “inaccurate” stehen.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wie wir oben gesehen haben, ist der Datensatz riesig<a href="#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>, was die Berechnungen (zeitaufwändig) und damit nervig machen können. Darüber hinaus kann es nötig sein, dass Sie mehr Speicher auf Ihrem Computer zur Verfügung stellen müssen<a href="#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>. Wir müssen noch <code>maximum_size = NULL</code>, um das Jonglieren mit riesigen Matrixen zu erlauben. Möge der Gott der RAMs und Arbeitsspeicher uns gnädig sein!</p>
</div>
</div>
<p>Mit <code>pairwise_dist</code> dauert die Berechnung sehr lange und braucht wohl sehr viel Speicher. Mitunter kam folgender Fehler auf: “R error: vector memory exhausted (limit reached?)”.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-52_38019fdc68b005dfc34ecb49f02cef38">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>word_neighbors_glove6b <span class="ot">&lt;-</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>tidy_glove <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">prop =</span> .<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_dist</span>(item1, dimension, value, <span class="at">maximum_size =</span> <span class="cn">NULL</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(word_neighbors_glove6b)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>tidy_glove <span class="sc">%&gt;%</span> </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(item1 <span class="sc">==</span> <span class="st">"inaccurate"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>value) <span class="sc">%&gt;%</span> </span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Deswegen probieren wir doch die Funktion <code>nearest_neighbors</code>, so wie es im Buch vorgeschlagen wird, s. <a href="https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings">Kap 5.3</a>.</p>
<div class="cell" data-hash="word-embedding_cache/html/fun-nearest-neighbors2_862a202411f6c34f2f95492024af250c">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>nearest_neighbors <span class="ot">&lt;-</span> <span class="cf">function</span>(df, token) {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">widely</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> {</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>        y <span class="ot">&lt;-</span> .[<span class="fu">rep</span>(token, <span class="fu">nrow</span>(.)), ]</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(. <span class="sc">*</span> y) <span class="sc">/</span> </span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">sqrt</span>(<span class="fu">rowSums</span>(. <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(.[token, ] <span class="sc">^</span> <span class="dv">2</span>)))</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span>(res, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">names</span>(res)))</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">sort =</span> <span class="cn">TRUE</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">maximum_size =</span> <span class="cn">NULL</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    )(item1, dimension, value) <span class="sc">%&gt;%</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/tidy-glove-nearest-neighbors_05b693e829b70dcc6e4b599ceb0a4ab8">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>tidy_glove <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># slice_head(prob = .1) %&gt;% </span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbors</span>(<span class="st">"error"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">item1</th>
<th style="text-align: right;">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">error</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">errors</td>
<td style="text-align: right;">0.7916719</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mistake</td>
<td style="text-align: right;">0.6641135</td>
</tr>
<tr class="even">
<td style="text-align: left;">correct</td>
<td style="text-align: right;">0.6205814</td>
</tr>
<tr class="odd">
<td style="text-align: left;">incorrect</td>
<td style="text-align: right;">0.6132556</td>
</tr>
<tr class="even">
<td style="text-align: left;">fault</td>
<td style="text-align: right;">0.6068035</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Entschachteln wir unsere Daten zu <code>complaints</code>:</p>
<div class="cell" data-hash="word-embedding_cache/html/unnest-tidy-complaints3_57759d8c6482927be07e0a20a76e8e46">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>tidy_complaints3 <span class="ot">&lt;-</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  nested_words3 <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(words)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dann erstellen wir uns eine Tabelle, in der nur die Schnittmenge der Wörter aus den Beschwerden und Glove vorkommen. Dazu nutzen winr einen <a href="https://github.com/gadenbuie/tidyexplain/blob/main/images/inner-join.gif">inneren Join</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/inner-join.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Inner Join, Quelle: Garrick Adenbuie</figcaption><p></p>
</figure>
</div>
<p><a href="https://github.com/gadenbuie/tidyexplain">Quelle</a></p>
<div class="cell" data-hash="word-embedding_cache/html/join-complaints-glove_7e7e9d1b161457af12ef8d773a573e2f">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>complaints_glove <span class="ot">&lt;-</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>tidy_complaints3 <span class="sc">%&gt;%</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="at">by =</span> <span class="st">"word"</span>, </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  tidy_glove <span class="sc">%&gt;%</span> </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(item1) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">word =</span> item1)) </span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(complaints_glove)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">complaint_id</th>
<th style="text-align: left;">word</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">systems</td>
</tr>
<tr class="even">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">inc</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">is</td>
</tr>
<tr class="even">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">trying</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">to</td>
</tr>
<tr class="even">
<td style="text-align: right;">3384392</td>
<td style="text-align: left;">collect</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Wie viele unique (distinkte) Wörter gibt es in unserem Corpus?</p>
<div class="cell" data-hash="word-embedding_cache/html/tidy_complaints3_distinct_words_n_46d25d8395197d57ba7f62e8a684053b">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>tidy_complaints3_distinct_words_n <span class="ot">&lt;-</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>tidy_complaints3 <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(word) <span class="sc">%&gt;%</span> </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>tidy_complaints3_distinct_words_n</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 222</code></pre>
</div>
</div>
<p>In <code>tidy_complaints</code> gibt es übrigens 222 verschiedene Wörter.</p>
<div class="cell" data-hash="word-embedding_cache/html/word_matrix_515d7820fa89ea3207aa9996d743b1c2">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>word_matrix <span class="ot">&lt;-</span> tidy_complaints3 <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="at">by =</span> <span class="st">"word"</span>,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>             tidy_glove <span class="sc">%&gt;%</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">distinct</span>(item1) <span class="sc">%&gt;%</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename</span>(<span class="at">word =</span> item1)) <span class="sc">%&gt;%</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(complaint_id, word) <span class="sc">%&gt;%</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast_sparse</span>(complaint_id, word, n)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co">#word_matrix</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>word_matrix</code> zählt für jede der 10 Beschwerden, welche Wörter (und wie häufig) vorkommen.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-53_b3ee0fa0ea63a0e39e9ddea45a99fe5e">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(word_matrix)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  10 222</code></pre>
</div>
</div>
<p>10 Beschwerden (Dokumente) und 222 unique Wörter.</p>
<div class="cell" data-hash="word-embedding_cache/html/glove_matrix_eb9668131fa8217619c77afb1d502521">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>glove_matrix <span class="ot">&lt;-</span> tidy_glove <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(<span class="at">by =</span> <span class="st">"item1"</span>,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>             tidy_complaints3 <span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">distinct</span>(word) <span class="sc">%&gt;%</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">rename</span>(<span class="at">item1 =</span> word)) <span class="sc">%&gt;%</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cast_sparse</span>(item1, dimension, value)</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co">#glove_matrix</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>glove_matrix</code> gibt für jedes unique Wort den Einbettungsvektor an.</p>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-54_7d3bcadf9b15a36f23c483923542963f">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(glove_matrix)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 222 100</code></pre>
</div>
</div>
<p>Das sind 222 unique Wörter und 100 Dimensionen des Einbettungsvektors.</p>
<p>Jetzt können wir noch pro Dokument (10 in diesem Beispiel) die mittlere “Position” jedes Dokuments im Einbettungsvektor ausrechnen. Bildlich gesprochen: Was ist der mittlere Raumpunkt (Zentroid) des Bienenschwarms, wobei eine Biene ein Dokument darstellt und die Raumachsen die Dimensionen des Einbettungsvektors.</p>
<p>Dazu gewichten wir jedes Wort eines Dokuments mit den Ladungen des Einbettungsvektor und summieren diese Terme. Es resultiert eine Matrix mit einem Einbettungsvektor pro Dokument. Diese Matrix können wir jetzt als Prädiktorenmatrix hernehmen.</p>
<div class="cell" data-hash="word-embedding_cache/html/doc_matrix_0d6b8b779ddfebe4003e7986bb8f3e2f">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>doc_matrix <span class="ot">&lt;-</span> word_matrix <span class="sc">%*%</span> glove_matrix</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co">#doc_matrix %&gt;% head()</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="word-embedding_cache/html/unnamed-chunk-55_feeefb08540864db5642edb5ce62175b">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(doc_matrix)</span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  10 100</code></pre>
</div>
</div>
<p>Die Anzahl der Dokumente ist 10 und die Anzahl der Dimensionen (des Einbettungsvektors) ist 100.</p>
</section>
<section id="wordembeddings-für-die-deutsche-sprache" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="wordembeddings-für-die-deutsche-sprache"><span class="header-section-number">5.6.2</span> Wordembeddings für die deutsche Sprache</h3>
<p>In diesem <a href="https://devmount.github.io/GermanWordEmbeddings/">Github-Projekt</a> finden sich die Materialien für ein deutsches Wordembedding <span class="citation" data-cites="mueller2015">(<a href="references.html#ref-mueller2015" role="doc-biblioref">Müller 2015</a>)</span>.</p>
</section>
</section>
<section id="fazit" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="fazit"><span class="header-section-number">5.7</span> Fazit</h2>
<p>Worteinbettungen sind eine aufwändige Angelegenheit. Positiv gesprochen kann ein Analysti die Muskeln spielen lassen und zeigen, was sie oder er so alles drauf hat. Ist ja schon cooles Zeugs, die Word Embeddings. Es besteht die Chance, dass man mit dieser Methode bessere Vorhersagen erreicht, als mit anderen, einfachen Ansätzen wir Worthäufigkeiten oder tf-idf. Auf der anderen Seite ist es oft sinnvoll, mit einfachen Ansätzen zu starten, und zu sehen, wie weit man kommt. Vielleicht ja weit genug.</p>
</section>
<section id="literatur" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="literatur"><span class="header-section-number">5.8</span> Literatur</h2>
<section id="wikipedia" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="wikipedia"><span class="header-section-number">5.8.1</span> Wikipedia</h3>
<p>Es gibt eine Reihe nützlicher (und recht informationsdichter) Wikipedia-Einträge zum Thema Informationstheorie.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Pointwise_mutual_information">Wikipedia: Pointwise Mutual Information</a></li>
<li><a href="https://en.wikipedia.org/wiki/Mutual_information">Wikipedia: Mutual information</a></li>
<li><a href="https://en.wikipedia.org/wiki/Information_theory">Wikipedia: Information theory</a></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-smltar" class="csl-entry" role="doc-biblioentry">
Hvitfeldt, Emil, und Julia Silge. 2022. <em>Supervised Machine Learning for Text Analysis in R</em>. 1. Aufl. Boca Raton: Chapman; Hall/<span>CRC</span>. <a href="https://doi.org/10.1201/9781003093459">https://doi.org/10.1201/9781003093459</a>.
</div>
<div id="ref-kurz_statistical_2021" class="csl-entry" role="doc-biblioentry">
Kurz, A. Solomon. 2021. <em>Statistical rethinking with brms, ggplot2, and the tidyverse: Second edition</em>. <a href="https://bookdown.org/content/4857/">https://bookdown.org/content/4857/</a>.
</div>
<div id="ref-mcelreath_statistical_2020" class="csl-entry" role="doc-biblioentry">
McElreath, Richard. 2020. <em>Statistical rethinking: a Bayesian course with examples in R and Stan</em>. 2. Aufl. <span>CRC</span> texts in statistical science. Boca Raton: Taylor; Francis, <span>CRC</span> Press.
</div>
<div id="ref-mueller2015" class="csl-entry" role="doc-biblioentry">
Müller, Andreas. 2015. <span>„<span>Analyse von Wort-Vektoren deutscher Textkorpora</span>“</span>. Bachelor's Thesis, Technische Universität Berlin. <a href="https://devmount.github.io/GermanWordEmbeddings">https://devmount.github.io/GermanWordEmbeddings</a>.
</div>
<div id="ref-pennington_glove_2014" class="csl-entry" role="doc-biblioentry">
Pennington, Jeffrey, Richard Socher, und Christopher Manning. 2014. <span>„<span>GloVe</span>: Global Vectors for Word Representation“</span>. In <em>Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (<span>EMNLP</span>)</em>, 1532–43. Doha, Qatar: Association for Computational Linguistics. <a href="https://doi.org/10.3115/v1/D14-1162">https://doi.org/10.3115/v1/D14-1162</a>.
</div>
<div id="ref-shannon_1948" class="csl-entry" role="doc-biblioentry">
Shannon, C. E. 1948. <span>„A Mathematical Theory of Communication“</span>. <em>Bell System Technical Journal</em> 27 (3): 379–423. <a href="https://doi.org/10.1002/j.1538-7305.1948.tb01338.x">https://doi.org/10.1002/j.1538-7305.1948.tb01338.x</a>.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Desiderata, sagt man<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>oder <em>shannon</em><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>wie immer, als fair angenommen, wenn sonst nichts anderes angegeben ist<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>auch als <em>marginalen</em> Wahrscheinlichkeiten oder <em>Randwahrscheinlichkeiten</em> bezeichnet<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Für stochastische Unabhängigkeit kann das Zeichen <span class="math inline">\(\bot\)</span> verwendet werden<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>so ähnlich wie mit den Lottozahlen<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Ist das nicht eine elegante Syntax?! Solomon Kurz, der Autor der Syntax, hielt sich nicht an die aktuelle Version von <code>dplyr</code>; <code>mutate_all</code> ist eigentlich überholt zugunsten von <code>mutate</code> mit <code>across</code>, aber die Prägnanz der Syntax hier ist schon beeindruckend, wie ich finde.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>Syntax aus <span class="citation" data-cites="kurz_statistical_2021">Kurz (<a href="references.html#ref-kurz_statistical_2021" role="doc-biblioref">2021</a>)</span><a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p><a href="https://de.wikipedia.org/wiki/Regel_von_de_L%E2%80%99Hospital">Regel von L’Hospital</a>; <a href="https://www.mathebibel.de/regel-von-lhospital">s. auch hier</a><a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p><a href="https://academia.stackexchange.com/questions/20084/is-using-the-phrase-is-left-as-an-exercise-for-the-reader-considered-good">Vgl. hier</a><a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>Man könnte ergänzen: plus eine 4. Dimension für Zeit, plus noch ein paar Weitere für die Beschleunigung in verschiedene Richtungen…<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>Quelle: https://de.wikipedia.org/wiki/Sinus_und_Kosinus<a href="#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p><span class="math inline">\(1024 \cdot 1024\)</span> Byte, und <span class="math inline">\(1024 =2^{10}\)</span>, daher <span class="math inline">\(2^{10} \cdot 2^{10} = 2^{20}\)</span><a href="#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>zugegeben, ein subjektiver Ausdruck<a href="#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>Kaufen…<a href="#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./populismus.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fallstudie Populismus</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./hassrede.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Hassrede</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>