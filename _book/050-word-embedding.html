<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.478">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Data Science 2: Textdaten als Grundlage prädiktiver Modelle 📚🔮 - 7&nbsp; Word Embedding</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./060-hassrede.html" rel="next">
<link href="./065-Information.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./025-twittermining.html">Textmining</a></li><li class="breadcrumb-item"><a href="./050-word-embedding.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Word Embedding</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science 2: Textdaten als Grundlage prädiktiver Modelle 📚🔮</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Dunkelmodus umschalten"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Organisatorisches</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Zu diesem Buch</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-Hinweise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Hinweise</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./020-pruefung.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Prüfung</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Textmining</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./025-twittermining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Twitter Mining</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./030-textmining1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Textmining 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./040-populismus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fallstudie Populismus</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./065-Information.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Informationstheorie</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./050-word-embedding.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Word Embedding</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./060-hassrede.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hassrede</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./067-miniprojekt1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Miniprojekt</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Tidymodels</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./080-klassifikation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Klassifikation von Hatespeech</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./070-hatespeech2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fallstudie Hatespeech</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./095-miniprojekt2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Miniprojekt</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Deep Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./105-python-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Python 💖 R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./100-nn-quickstart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Einstieg in Neuronale Netze</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-nn-theo1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Theoretische Grundlagen neuronaler Netze</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./120-transformer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Transformer</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Anwendung</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./200-projektmgt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Projektmanagement</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./300-fallstudien.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Fallstudien</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Abschluss</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li>
<a href="#vorab" id="toc-vorab" class="nav-link active" data-scroll-target="#vorab"><span class="header-section-number">7.1</span> Vorab</a>
  <ul class="collapse">
<li><a href="#lernziele" id="toc-lernziele" class="nav-link" data-scroll-target="#lernziele"><span class="header-section-number">7.1.1</span> Lernziele</a></li>
  <li><a href="#begleitliteratur" id="toc-begleitliteratur" class="nav-link" data-scroll-target="#begleitliteratur"><span class="header-section-number">7.1.2</span> Begleitliteratur</a></li>
  <li><a href="#ben%C3%B6tigte-r-pakete" id="toc-benötigte-r-pakete" class="nav-link" data-scroll-target="#ben%C3%B6tigte-r-pakete"><span class="header-section-number">7.1.3</span> Benötigte R-Pakete</a></li>
  </ul>
</li>
  <li>
<a href="#daten" id="toc-daten" class="nav-link" data-scroll-target="#daten"><span class="header-section-number">7.2</span> Daten</a>
  <ul class="collapse">
<li><a href="#complaints-datensatz" id="toc-complaints-datensatz" class="nav-link" data-scroll-target="#complaints-datensatz"><span class="header-section-number">7.2.1</span> Complaints-Datensatz</a></li>
  <li><a href="#complaints-verk%C3%BCrzt-und-geschachtelt" id="toc-complaints-verkürzt-und-geschachtelt" class="nav-link" data-scroll-target="#complaints-verk%C3%BCrzt-und-geschachtelt"><span class="header-section-number">7.2.2</span> Complaints verkürzt und geschachtelt</a></li>
  </ul>
</li>
  <li>
<a href="#wordembeddings-selber-erstellen" id="toc-wordembeddings-selber-erstellen" class="nav-link" data-scroll-target="#wordembeddings-selber-erstellen"><span class="header-section-number">7.3</span> Wordembeddings selber erstellen</a>
  <ul class="collapse">
<li><a href="#pmi-berechnen" id="toc-pmi-berechnen" class="nav-link" data-scroll-target="#pmi-berechnen"><span class="header-section-number">7.3.1</span> PMI berechnen</a></li>
  <li><a href="#sliding" id="toc-sliding" class="nav-link" data-scroll-target="#sliding"><span class="header-section-number">7.3.2</span> Sliding</a></li>
  <li><a href="#funktion-slide_windows" id="toc-funktion-slide_windows" class="nav-link" data-scroll-target="#funktion-slide_windows"><span class="header-section-number">7.3.3</span> Funktion <code>slide_windows</code></a></li>
  <li><a href="#%C3%A4hnlichkeit-berechnen" id="toc-ähnlichkeit-berechnen" class="nav-link" data-scroll-target="#%C3%A4hnlichkeit-berechnen"><span class="header-section-number">7.3.4</span> Ähnlichkeit berechnen</a></li>
  <li><a href="#svd" id="toc-svd" class="nav-link" data-scroll-target="#svd"><span class="header-section-number">7.3.5</span> SVD</a></li>
  <li><a href="#wort%C3%A4hnlichkeit" id="toc-wortähnlichkeit" class="nav-link" data-scroll-target="#wort%C3%A4hnlichkeit"><span class="header-section-number">7.3.6</span> Wortähnlichkeit</a></li>
  <li><a href="#cosinus-%C3%A4hnlichkeit" id="toc-cosinus-ähnlichkeit" class="nav-link" data-scroll-target="#cosinus-%C3%A4hnlichkeit"><span class="header-section-number">7.3.7</span> Cosinus-Ähnlichkeit</a></li>
  </ul>
</li>
  <li>
<a href="#word-embeddings-vorgekocht" id="toc-word-embeddings-vorgekocht" class="nav-link" data-scroll-target="#word-embeddings-vorgekocht"><span class="header-section-number">7.4</span> Word-Embeddings vorgekocht</a>
  <ul class="collapse">
<li><a href="#glove6b" id="toc-glove6b" class="nav-link" data-scroll-target="#glove6b"><span class="header-section-number">7.4.1</span> Glove6B</a></li>
  <li><a href="#wordembeddings-f%C3%BCr-die-deutsche-sprache" id="toc-wordembeddings-für-die-deutsche-sprache" class="nav-link" data-scroll-target="#wordembeddings-f%C3%BCr-die-deutsche-sprache"><span class="header-section-number">7.4.2</span> Wordembeddings für die deutsche Sprache</a></li>
  </ul>
</li>
  <li><a href="#fazit" id="toc-fazit" class="nav-link" data-scroll-target="#fazit"><span class="header-section-number">7.5</span> Fazit</a></li>
  <li><a href="#fallstudie" id="toc-fallstudie" class="nav-link" data-scroll-target="#fallstudie"><span class="header-section-number">7.6</span> Fallstudie</a></li>
  <li><a href="#vertiefung" id="toc-vertiefung" class="nav-link" data-scroll-target="#vertiefung"><span class="header-section-number">7.7</span> Vertiefung</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./025-twittermining.html">Textmining</a></li><li class="breadcrumb-item"><a href="./050-word-embedding.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Word Embedding</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Word Embedding</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><img src="img/text-mining-1476780_640.png" class="img-fluid" style="width:10.0%" alt="Text als Datenbasis prädiktiver Modelle"> Bild von <a href="https://pixabay.com/de/users/mcmurryjulie-2375405/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780">mcmurryjulie</a> auf <a href="https://pixabay.com/de//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1476780">Pixabay</a></p>
<section id="vorab" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="vorab">
<span class="header-section-number">7.1</span> Vorab</h2>
<section id="lernziele" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="lernziele">
<span class="header-section-number">7.1.1</span> Lernziele</h3>
<!-- - Die grundlegenden Konzepte der Informationstheorie erklären können -->
<ul>
<li>Die Erstellung von Word-Embeddings anhand grundlegender R-Funktionen erläutern können.</li>
</ul></section><section id="begleitliteratur" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="begleitliteratur">
<span class="header-section-number">7.1.2</span> Begleitliteratur</h3>
<p>Arbeiten Sie <span class="citation" data-cites="smltar">Hvitfeldt und Silge (<a href="#ref-smltar" role="doc-biblioref">2021</a>)</span>, <a href="https://smltar.com/embeddings.html">Kap. 5</a> vor dem Unterricht durch als Vorbereitung.</p>
</section><section id="benötigte-r-pakete" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="benötigte-r-pakete">
<span class="header-section-number">7.1.3</span> Benötigte R-Pakete</h3>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-1_0ab0a52e64f4186cf6df82e7ac754775">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/easystats/">easystats</a></span><span class="op">)</span>  <span class="co"># Komfort für deskriptive Statistiken, wie `describe_distribution`</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EmilHvitfeldt/hcandersenr">hcandersenr</a></span><span class="op">)</span>   <span class="co"># Textdaten</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/slider">slider</a></span><span class="op">)</span>  <span class="co"># slide</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/widyr">widyr</a></span><span class="op">)</span>  <span class="co"># pairwise_pmi</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span>  <span class="co"># mehrere Kerne gleichzeitig nutzen</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EmilHvitfeldt/textdata">textdata</a></span><span class="op">)</span>  <span class="co"># Worteinbettungen wie Glove6b, vorgekocht</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://strimmerlab.github.io/software/entropy/">entropy</a></span><span class="op">)</span>  <span class="co"># Entropie berechnen</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/widyr">widyr</a></span><span class="op">)</span>  <span class="co"># Ähnlichkeit berechnen mit widyr_svd</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op">)</span>  <span class="co"># Mehrere Kerne gleichzeitig</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="daten" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="daten">
<span class="header-section-number">7.2</span> Daten</h2>
<section id="complaints-datensatz" class="level3" data-number="7.2.1"><h3 data-number="7.2.1" class="anchored" data-anchor-id="complaints-datensatz">
<span class="header-section-number">7.2.1</span> Complaints-Datensatz</h3>
<p>Der Datensatz <code>complaints</code> stammt aus <a href="https://www.consumerfinance.gov/data-research/consumer-complaints/">dieser Quelle</a>.</p>
<p>Den Datensatz <code>complaints</code> kann man <a href="https://github.com/EmilHvitfeldt/smltar/raw/master/data/complaints.csv.gz">hier</a> herunterladen. Im Buch ist die Webseite nicht (direkt?) angegeben. Die Datei ist mit <code>gz</code> gepackt; <code>read_csv</code> sollte das automatisch entpacken. Achtung: Die Datei ist recht groß.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/read-complaints-data_a59ac7326c2d25213916ee3cc3bbd2e0">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_path</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/EmilHvitfeldt/smltar/raw/master/data/complaints.csv.gz"</span></span>
<span><span class="va">complaints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">d_path</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Geschickter als jedes Mal die Datei herunterzuladen, ist es, sie einmal herunterzuladen, und dann lokal zu speichern, etwa im Unterordner <code>data</code> des RStudio-Projektordners.</p>
<p>Nach dem Importieren wird der Datensatz in eine Tidy-Form gebracht (mit <code>unnest_tokens</code>) und dann verschachtelt, mit <code>nest</code>.</p>
</section><section id="complaints-verkürzt-und-geschachtelt" class="level3" data-number="7.2.2"><h3 data-number="7.2.2" class="anchored" data-anchor-id="complaints-verkürzt-und-geschachtelt">
<span class="header-section-number">7.2.2</span> Complaints verkürzt und geschachtelt</h3>
<p>Um ein Herumprobieren zu erleichtern, ist hier der Datensatz <code>complaints</code> in zwei verkürzten Formen bereitgestellt:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-2_7e413a6168a7a56b8cb6ddd5f2c1c5f6">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nested_words2_path</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/sebastiansauer/datascience-text/raw/main/data/nested_words2.rds"</span></span>
<span><span class="va">nested_words3_path</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/sebastiansauer/datascience-text/raw/main/data/nested_words3.rds"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>nested_words2</code> enthält die ersten 10% des Datensatz <code>nested_words</code>und ist gut 4 MB groß (mit <code>gz</code> gezippt); er besteht aus ca. 11 Tausend Beschwerden. <code>nested_words3</code> enthält nur die ersten 10 Beschwerden, was ihn gut zum Handhaben macht.</p>
<p>Beide sind verschachtelt und aus <code>tidy_complaints</code> (s. <a href="https://smltar.com/embeddings.html#motivatingsparse">Kap. 5.1</a>) hervorgegangen.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/read-rds-nested-data_b64b44a82bd7d5c50be2f2945123c60e">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nested_words3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="va">nested_words3_path</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das sieht dann so aus:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-3_ebf9a0184eb5ccc7869c19a66fc45744">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nested_words3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["complaint_id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["words"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"3384392","2":"<tibble[,1]>"},{"1":"3417821","2":"<tibble[,1]>"},{"1":"3433198","2":"<tibble[,1]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Werfen wir einen Blick in den TExt der ersten Beschwerde des Datensatzes mit der ID <code>nested_words3_path$complaint_id[1]</code>.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-4_b81267965b7dd781efe5f6d305c2056f">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beschwerde1_text</span> <span class="op">&lt;-</span> <span class="va">nested_words3</span><span class="op">$</span><span class="va">words</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das ist ein Tibble mit einer Spalte und 17 Wörtern; da wir schon auf Unigramme aufgeteilt haben, ist jedes Wort ein Element des Vektors <code>word</code>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-5_b6a29093bb55aed422c0c5fbac9646aa">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beschwerde1_text</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["word"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"systems"},{"1":"inc"},{"1":"is"},{"1":"trying"},{"1":"to"},{"1":"collect"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-6_2c74f7e02e620de6188defa9d40f86e7">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beschwerde1_text</span><span class="op">$</span><span class="va">word</span></span>
<span><span class="co">##  [1] "systems"    "inc"        "is"         "trying"     "to"        </span></span>
<span><span class="co">##  [6] "collect"    "a"          "debt"       "that"       "is"        </span></span>
<span><span class="co">## [11] "not"        "mine"       "not"        "owed"       "and"       </span></span>
<span><span class="co">## [16] "is"         "inaccurate"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="wordembeddings-selber-erstellen" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="wordembeddings-selber-erstellen">
<span class="header-section-number">7.3</span> Wordembeddings selber erstellen</h2>
<!-- TODO -->
<!-- nette Illustrationen: https://entwickler.de/python/grundsatze-moderner-textklassifizierung-fur-machine-learning-word-embeddings -->
<section id="pmi-berechnen" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="pmi-berechnen">
<span class="header-section-number">7.3.1</span> PMI berechnen</h3>
<p>Rufen Sie sich die Definition der PMI ins Gedächtnis, s. <a href="#eq-pmi" class="quarto-xref">Gleichung&nbsp;<span class="quarto-unresolved-ref">eq-pmi</span></a>.</p>
<p>Mit R kann man die PMI z.B. so berechnen, s. <code><a href="https://juliasilge.github.io/widyr/reference/pairwise_pmi.html">? pairwise_pmi</a></code> aus dem Paket <a href="https://github.com/juliasilge/widyr">widyr</a>.</p>
<p>Zum Paket <code>widyr</code> von Robinson und Silge:</p>
<blockquote class="blockquote">
<p>This package wraps the pattern of un-tidying data into a wide matrix, performing some processing, then turning it back into a tidy form. This is useful for several mathematical operations such as co-occurrence counts, correlations, or clustering that are best done on a wide matrix.</p>
</blockquote>
<p><a href="https://juliasilge.github.io/widyr/">Quelle</a></p>
<p>Erzeugen wir uns Dummy-Daten:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-7_7fc4ce5027dff04820fb41377d770767">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>feature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>              item <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>,</span>
<span>                       <span class="st">"a"</span>, <span class="st">"c"</span>,</span>
<span>                       <span class="st">"a"</span>, <span class="st">"c"</span>,</span>
<span>                       <span class="st">"b"</span>, <span class="st">"e"</span>,</span>
<span>                       <span class="st">"b"</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["feature"],"name":[1],"type":["int"],"align":["right"]},{"label":["item"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"a"},{"1":"1","2":"b"},{"1":"2","2":"a"},{"1":"2","2":"c"},{"1":"3","2":"a"},{"1":"3","2":"c"},{"1":"4","2":"b"},{"1":"4","2":"e"},{"1":"5","2":"b"},{"1":"5","2":"f"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Aus der Hilfe der Funktion:</p>
<blockquote class="blockquote">
<p>Find pointwise mutual information of pairs of items in a column, based on a “feature” column that links them together. This is an example of the spread-operate-retidy pattern.</p>
</blockquote>
<p>Die Argumente der Funktion sind:</p>
<p><em>item</em></p>
<p>Item to compare; will end up in item1 and item2 columns</p>
<p><em>feature</em></p>
<p>Column describing the feature that links one item to others</p>
<p>Manche Berechnungen (Operationen) lassen sich vielleicht leichter nicht in der Tidy-Form (Langform), sondern in der “breiten” oder Matrixform ausführen. Wandeln wir mal <code>dat</code> von der Langform in die Breitform um:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-8_5bcde7bbf8be00d20b0881fcbd8ee0fa">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">item</span>, <span class="va">dat</span><span class="op">$</span><span class="va">feature</span><span class="op">)</span></span>
<span><span class="co">##    </span></span>
<span><span class="co">##     1 2 3 4 5</span></span>
<span><span class="co">##   a 1 1 1 0 0</span></span>
<span><span class="co">##   b 1 0 0 1 1</span></span>
<span><span class="co">##   c 0 1 1 0 0</span></span>
<span><span class="co">##   e 0 0 0 1 0</span></span>
<span><span class="co">##   f 0 0 0 0 1</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Silge und Robinson verdeutlichen das Prinzip von <code>widyr</code> so, s. <a href="#fig-widyr" class="quarto-xref">Abbildung&nbsp;<span class="quarto-unresolved-ref">fig-widyr</span></a>.</p>
<div id="fig-widyr" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-widyr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/widyr.jpeg" class="img-fluid figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-widyr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;7.1: Die Funktionsweise von widyr, Quelle: Silge und Robinson
</figcaption></figure>
</div>
<p>(Vgl. auch die <a href="https://bookdown.org/Maxine/tidy-text-mining/counting-and-correlating-pairs-of-words-with-widyr.html">Erklärung hier</a>.)</p>
<p>Bauen wir das mal von Hand nach.</p>
<p>Randwahrscheinlichkeiten von <code>a</code> und <code>c</code> sowie deren Produkt, <code>p_a_p_c</code>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/p_a_und_p_c_66f24bb2041e530eefdd037fa67b9f16">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_a</span> <span class="op">&lt;-</span> <span class="fl">3</span><span class="op">/</span><span class="fl">5</span></span>
<span><span class="va">p_c</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span></span>
<span></span>
<span><span class="va">p_a_p_c</span> <span class="op">&lt;-</span> <span class="va">p_a</span> <span class="op">*</span> <span class="va">p_c</span></span>
<span><span class="va">p_a_p_c</span></span>
<span><span class="co">## [1] 0.24</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Gemeinsame Wahrscheinlichkeit von <code>a</code> und <code>c</code>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/p_ac_7df88f5285fbc01e3aa9c2670ba06c1e">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">p_ac</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">/</span><span class="fl">5</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>PMI von Hand berechnet:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-9_e6d94978df16605c832e9e159f337d83">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">p_ac</span><span class="op">/</span><span class="va">p_a_p_c</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.5108256</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Man beachte, dass hier als Basis <span class="math inline">\(e\)</span>, der natürliche Logarithmus, verwendet wurde (nicht 2).</p>
<p>Jetzt berechnen wir die PMI mit <code>pairwise_pmi</code>.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-10_a0f1c3605882757f7f5b2f443463b76a">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://juliasilge.github.io/widyr/reference/pairwise_pmi.html">pairwise_pmi</a></span><span class="op">(</span><span class="va">dat</span>, item <span class="op">=</span> <span class="va">item</span>, feature <span class="op">=</span> <span class="va">feature</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["item2"],"name":[2],"type":["chr"],"align":["left"]},{"label":["pmi"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"b","2":"a","3":"-0.5877867"},{"1":"c","2":"a","3":"0.5108256"},{"1":"a","2":"b","3":"-0.5877867"},{"1":"e","2":"b","3":"0.5108256"},{"1":"f","2":"b","3":"0.5108256"},{"1":"a","2":"c","3":"0.5108256"},{"1":"b","2":"e","3":"0.5108256"},{"1":"b","2":"f","3":"0.5108256"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Wie man sieht, entspricht unserer Berechnung von Hand der Berechnung mit <code>pairwise_pmi</code>.</p>
</section><section id="sliding" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="sliding">
<span class="header-section-number">7.3.2</span> Sliding</h3>
<p>Sliding ist ein interessantes Konzept, aber man braucht vielleicht etwas Zeit, um sein Hirn um das Konzept zu wickeln…</p>
<p>Hier eine Illustration:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-11_875ec98ae1993840457cbae6b5672f80">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">txt_vec</span> <span class="op">&lt;-</span> <span class="st">"Das ist ein Test, von dem nicht viel zu erwarten ist"</span></span>
<span></span>
<span><span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html">slide</a></span><span class="op">(</span><span class="va">txt_vec</span>, <span class="op">~</span> <span class="va">.x</span>, .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "Das ist ein Test, von dem nicht viel zu erwarten ist"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Oh, da passiert nichts?! Kaputt? Nein, wir müssen jedes Wort als <em>ein Element</em> des Vektors auffassen.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-12_05fee5da369bd67ef578cdd468a238c7">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">txt_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>txt <span class="op">=</span> <span class="va">txt_vec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">txt</span>, output <span class="op">=</span> <span class="va">word</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">txt_df</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["word"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"das"},{"1":"ist"},{"1":"ein"},{"1":"test"},{"1":"von"},{"1":"dem"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-13_f58fcf814eb3ef5b8951e33903b281d7">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html">slide</a></span><span class="op">(</span><span class="va">txt_df</span><span class="op">$</span><span class="va">word</span>, <span class="op">~</span> <span class="va">.x</span>, .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "das"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] "das" "ist"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] "das" "ist" "ein"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] "ist"  "ein"  "test"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] "ein"  "test" "von" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">## [1] "test" "von"  "dem" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[7]]</span></span>
<span><span class="co">## [1] "von"   "dem"   "nicht"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[8]]</span></span>
<span><span class="co">## [1] "dem"   "nicht" "viel" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[9]]</span></span>
<span><span class="co">## [1] "nicht" "viel"  "zu"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[10]]</span></span>
<span><span class="co">## [1] "viel"     "zu"       "erwarten"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[11]]</span></span>
<span><span class="co">## [1] "zu"       "erwarten" "ist"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ah!</p>
<p>Das Aufteilen in einzelne Wörter pro Element des Vektors könnte man auch so erreichen:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/slide2_0379451ed97fa6185c2743556cba099e">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">txt_vec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="va">txt_vec</span>, pattern <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/modifiers.html">boundary</a></span><span class="op">(</span><span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/as_vector.html">simplify</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html">slide</a></span><span class="op">(</span><span class="va">txt_vec2</span>, .f <span class="op">=</span> <span class="op">~</span><span class="va">.x</span>, .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "Das"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] "Das" "ist"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] "Das" "ist" "ein"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] "ist"  "ein"  "Test"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] "ein"  "Test" "von" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">## [1] "Test" "von"  "dem" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[7]]</span></span>
<span><span class="co">## [1] "von"   "dem"   "nicht"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[8]]</span></span>
<span><span class="co">## [1] "dem"   "nicht" "viel" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[9]]</span></span>
<span><span class="co">## [1] "nicht" "viel"  "zu"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[10]]</span></span>
<span><span class="co">## [1] "viel"     "zu"       "erwarten"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[11]]</span></span>
<span><span class="co">## [1] "zu"       "erwarten" "ist"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In unserem Beispiel mit den Beschwerden:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/slide3_93f158057d60dd2b224b00cf3616ded4">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html">slide</a></span><span class="op">(</span><span class="va">beschwerde1_text</span><span class="op">$</span><span class="va">word</span>,  <span class="op">~</span><span class="va">.x</span>, .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## [[1]]</span></span>
<span><span class="co">## [1] "systems"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">## [1] "systems" "inc"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[3]]</span></span>
<span><span class="co">## [1] "systems" "inc"     "is"     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[4]]</span></span>
<span><span class="co">## [1] "inc"    "is"     "trying"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[5]]</span></span>
<span><span class="co">## [1] "is"     "trying" "to"    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[6]]</span></span>
<span><span class="co">## [1] "trying"  "to"      "collect"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[7]]</span></span>
<span><span class="co">## [1] "to"      "collect" "a"      </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[8]]</span></span>
<span><span class="co">## [1] "collect" "a"       "debt"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[9]]</span></span>
<span><span class="co">## [1] "a"    "debt" "that"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[10]]</span></span>
<span><span class="co">## [1] "debt" "that" "is"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[11]]</span></span>
<span><span class="co">## [1] "that" "is"   "not" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[12]]</span></span>
<span><span class="co">## [1] "is"   "not"  "mine"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[13]]</span></span>
<span><span class="co">## [1] "not"  "mine" "not" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[14]]</span></span>
<span><span class="co">## [1] "mine" "not"  "owed"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[15]]</span></span>
<span><span class="co">## [1] "not"  "owed" "and" </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[16]]</span></span>
<span><span class="co">## [1] "owed" "and"  "is"  </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[17]]</span></span>
<span><span class="co">## [1] "and"        "is"         "inaccurate"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="funktion-slide_windows" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="funktion-slide_windows">
<span class="header-section-number">7.3.3</span> Funktion <code>slide_windows</code>
</h3>
<p>Die Funktion <code>slide_windows</code> im <a href="https://smltar.com/embeddings.html#understand-word-embeddings-by-finding-them-yourself">Kapitel 5.2</a> ist recht kompliziert. In solchen Fällen ist es hilfreich, sich jeden Schritt einzeln ausführen zu lassen. Das machen wir jetzt mal.</p>
<p>Hier ist die Syntax der Funktion <code>slide_windows</code>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/fun-slide-win_c0ab7a4744b0894bf8d593b3e2d4e689">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">slide_windows</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tbl</span>, <span class="va">window_size</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">skipgrams</span> <span class="op">&lt;-</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html">slide</a></span><span class="op">(</span></span>
<span>    <span class="va">tbl</span>, </span>
<span>    <span class="op">~</span><span class="va">.x</span>,  <span class="co"># Syntax ähnlich zu purrr::map()</span></span>
<span>    .after <span class="op">=</span> <span class="va">window_size</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>    .step <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    .complete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">safe_mutate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">safely</a></span><span class="op">(</span><span class="va">mutate</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">skipgrams</span>,</span>
<span>              <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">skipgrams</span><span class="op">)</span>,</span>
<span>              <span class="op">~</span> <span class="fu">safe_mutate</span><span class="op">(</span><span class="va">.x</span>, window_id <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/transpose.html">transpose</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">compact</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Erschwerend kommt eine große Datenmenge und eine lange Berechnungszeit dazu, was das Debuggen (Nachvollziehen und Durchdenken) der Schritte zusätzlich erschwert. In solchen Fällen hilft die goldene Regel: Mach es dir so einfach wie möglich (aber nicht einfacher). Wir nutzen also den stark verkleinerten Datensatz <code>nested_words3</code>, den wir oben importiert haben.</p>
<p>Zuerst erlauben wir mal, dasss unsere R-Session mehrere Kerne benutzen darf.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-14_f3bed33e0f71fa0513c31b286a6ee558">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>  <span class="co">## for parallel processing</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Funktion <code>slide_windows</code> ist recht kompliziert. Es hilft oft, sich mit <code>debug(fun)</code> eine Funktion Schritt für Schritt anzuschauen.</p>
<p>Gehen wir Schritt für Schritt durch die Syntax von <code>slide_windows</code>.</p>
<p>Werfen wir einen Blick in <code>words</code>, erstes Element (ein Tibble mit einer Spalte). Denn <code>die einzelnen Elemente von</code>words<code>werden an die Funktion</code>slide_windows` als “Futter” übergeben.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-15_a2417d01674a2791129d97f08470a34e">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">futter1</span> <span class="op">&lt;-</span> <span class="va">nested_words3</span><span class="op">[[</span><span class="st">"words"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">futter1</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["word"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"systems"},{"1":"inc"},{"1":"is"},{"1":"trying"},{"1":"to"},{"1":"collect"},{"1":"a"},{"1":"debt"},{"1":"that"},{"1":"is"},{"1":"not"},{"1":"mine"},{"1":"not"},{"1":"owed"},{"1":"and"},{"1":"is"},{"1":"inaccurate"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Das ist der Text der ersten Beschwerde.</p>
<p>Okay, also dann geht’s los durch die einzelnen Schritte der Funktion <code>slide_windows</code>.</p>
<p>Zunächst holen wir uns die “Fenster” oder “Skipgrams”:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/skipgrams1_9a58d04e50ec9670dedbcfb420ab3d55">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">skipgrams1</span> <span class="op">&lt;-</span> <span class="fu">slider</span><span class="fu">::</span><span class="fu"><a href="https://slider.r-lib.org/reference/slide.html">slide</a></span><span class="op">(</span></span>
<span>   <span class="va">futter1</span>, </span>
<span>    <span class="op">~</span><span class="va">.x</span>, </span>
<span>    .after <span class="op">=</span> <span class="fl">3</span>, </span>
<span>    .step <span class="op">=</span> <span class="fl">1</span>, </span>
<span>    .complete <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bei <code>slide(tbl, ~.x)</code> geben wir die Funktion an, die auf <code>tbl</code> angewendet werden soll. Daher auch die Tilde, die uns von <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map()</a></code> her bekannt ist. In unserem Fall wollen wir nur die Elemente auslesen; Elemente auslesen erreicht man, in dem man sie mit Namen anspricht, in diesem Fall mit dem Platzhalter <code>.x</code>.</p>
<p>Jedes Element von <code>skipgrams1</code> ist ein 4*1-Tibble und ist ein Skripgram.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-16_8824c79cfdbfebb2d5432dc4ff428a38">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">skipgrams1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 17</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "systems" "inc" "is" "trying"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "inc" "is" "trying" "to"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "is" "trying" "to" "collect"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "trying" "to" "collect" "a"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "to" "collect" "a" "debt"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "collect" "a" "debt" "that"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "a" "debt" "that" "is"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "debt" "that" "is" "not"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "that" "is" "not" "mine"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "is" "not" "mine" "not"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "not" "mine" "not" "owed"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "mine" "not" "owed" "and"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "not" "owed" "and" "is"</span></span>
<span><span class="co">##  $ : tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   ..$ word: chr [1:4] "owed" "and" "is" "inaccurate"</span></span>
<span><span class="co">##  $ : NULL</span></span>
<span><span class="co">##  $ : NULL</span></span>
<span><span class="co">##  $ : NULL</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das zweite Skipgram von <code>skipgrams1</code> enthält, naja, das zweite Skipgram.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-17_1c786c0b43e382f97887f51a44ae011d">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">skipgrams1</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## tibble [4 × 1] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##  $ word: chr [1:4] "inc" "is" "trying" "to"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Und so weiter.</p>
<p>Okay, weiter im Programm. Jetzt mappen wir das Erstellen der Skipgrams</p>
<div class="cell" data-hash="050-word-embedding_cache/html/skipgrams2_85deb39de11a4e8fbd05f509d2c8efcd">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">safe_mutate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/safely.html">safely</a></span><span class="op">(</span><span class="va">mutate</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html">map2</a></span><span class="op">(</span><span class="va">skipgrams1</span>,</span>
<span>             <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">skipgrams1</span><span class="op">)</span>,</span>
<span>             <span class="op">~</span> <span class="fu">safe_mutate</span><span class="op">(</span><span class="va">.x</span>, window_id <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">out1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ :List of 2</span></span>
<span><span class="co">##   ..$ result: tibble [4 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   .. ..$ word     : chr [1:4] "systems" "inc" "is" "trying"</span></span>
<span><span class="co">##   .. ..$ window_id: int [1:4] 1 1 1 1</span></span>
<span><span class="co">##   ..$ error : NULL</span></span>
<span><span class="co">##  $ :List of 2</span></span>
<span><span class="co">##   ..$ result: tibble [4 × 2] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">##   .. ..$ word     : chr [1:4] "inc" "is" "trying" "to"</span></span>
<span><span class="co">##   .. ..$ window_id: int [1:4] 2 2 2 2</span></span>
<span><span class="co">##   ..$ error : NULL</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>out1</code> ist eine Liste mit 17 Elementen; jedes Element mit jeweils zwei Elementen: Den Ergebnissen und ob es einen Fehler gab bei <code>safe_mutate</code>. Die 10 Elemente entsprechen den 10 Skipgrams. Wir können aber <code>out1</code> auch “drehen”, transponieren genauer gesagt. so dass wir eine Liste mit <em>zwei</em> Elementen bekommen: das erste Element hat die (zehn) Ergebnisse (nämlich die Skipgrams) und das zweite Elemente, ob es Fehler gab.</p>
<p>Das Prinzip des Transponierens ist in <a href="#fig-Matrix-transpose" class="quarto-xref">Abbildung&nbsp;<span class="quarto-unresolved-ref">fig-Matrix-transpose</span></a> dargestellt.</p>
<div id="fig-Matrix-transpose" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-Matrix-transpose-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/Matrix_transpose.gif" class="img-fluid figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-Matrix-transpose-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;7.2: Transponieren einer Matrix (“Tabelle”)
</figcaption></figure>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-18_7db516c3139ca97464bf36e0930215b4">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">out2</span> <span class="op">&lt;-</span></span>
<span><span class="va">out1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/transpose.html">transpose</a></span><span class="op">(</span><span class="op">)</span> </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puh, das ist schon anstrengendes Datenyoga…</p>
<p>Aber jetzt ist es einfach. Wir ziehen das erste der beiden Elemente, die Ergebnisse heraus (<code>pluck</code>), entfernen leere Elemente (<code>compact</code>) und machen einen Tibble daraus (<code>bind_rows</code>):</p>
<div class="cell" data-hash="050-word-embedding_cache/html/skipgrams3_e18ad3a3a9378fb608ae7da530e15b8b">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">out2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">compact</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["word"],"name":[1],"type":["chr"],"align":["left"]},{"label":["window_id"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"systems","2":"1"},{"1":"inc","2":"1"},{"1":"is","2":"1"},{"1":"trying","2":"1"},{"1":"inc","2":"2"},{"1":"is","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Geschafft!</p>
</section><section id="ähnlichkeit-berechnen" class="level3" data-number="7.3.4"><h3 data-number="7.3.4" class="anchored" data-anchor-id="ähnlichkeit-berechnen">
<span class="header-section-number">7.3.4</span> Ähnlichkeit berechnen</h3>
<p>Nachdem wir jetzt <code>slide_windows</code> kennen, schauen wir uns die nächsten Schritte an:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/tidy-pmi1_366e085a07f4ced89213c51d4ecd790a">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pmi1</span> <span class="op">&lt;-</span> <span class="va">nested_words3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># &lt;--- Kleiner Datensatz!</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>words <span class="op">=</span> <span class="fu"><a href="https://furrr.futureverse.org/reference/future_map.html">future_map</a></span><span class="op">(</span>  <span class="co"># Schleife (mit mehreren Kernen) über ...</span></span>
<span>    <span class="va">words</span>,   <span class="co">#  alle Wörter</span></span>
<span>    <span class="va">slide_windows</span>,  <span class="co"># wobei jedes Mal diese Funtion angewendet wird</span></span>
<span>    <span class="fl">4L</span>  <span class="co"># Parameter an `slide_windows`: Window-Größe ist 4 (L wie "Long", für Integer)</span></span>
<span>  <span class="op">)</span><span class="op">)</span>  </span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wir werden <code>slide_windows</code> auf die Liste <code>words</code> an, die die Beschwerden enthält. Für jede Beschwerde erstellen wir die Skipgrams; diese Schleife wird realisiert über <code>map</code> bzw. <code>future_map</code>, die uns erlaubt, mehrere Kerne des Rechners gleichzeitig zu nutzen, damit es schneller geht.</p>
<p>Hier sehen wir z.B. die Skipgram-IDs der ersten Beschwerde.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-19_a2ea99525c016d294a5a6eca8e7c9a36">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pmi1</span><span class="op">[[</span><span class="st">"words"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["word"],"name":[1],"type":["chr"],"align":["left"]},{"label":["window_id"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"systems","2":"1"},{"1":"inc","2":"1"},{"1":"is","2":"1"},{"1":"trying","2":"1"},{"1":"inc","2":"2"},{"1":"is","2":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Genestet siehst es so aus:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-20_a442a77d2f64fecb72a2ccb340fdbdcc">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pmi1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["complaint_id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["words"],"name":[2],"type":["list"],"align":["right"]}],"data":[{"1":"3384392","2":"<tibble[,2]>"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Die Listenspalte entschachteln wir mal:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-21_442654d2c204f83422bb3525343fb1b5">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pmi2</span> <span class="op">&lt;-</span> <span class="va">tidy_pmi1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span>  <span class="co"># entschachtele</span></span>
<span></span>
<span><span class="va">tidy_pmi2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["complaint_id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["word"],"name":[2],"type":["chr"],"align":["left"]},{"label":["window_id"],"name":[3],"type":["int"],"align":["right"]}],"data":[{"1":"3384392","2":"systems","3":"1"},{"1":"3384392","2":"inc","3":"1"},{"1":"3384392","2":"is","3":"1"},{"1":"3384392","2":"trying","3":"1"},{"1":"3384392","2":"inc","3":"2"},{"1":"3384392","2":"is","3":"2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Zum Berechnen der Ähnlichkeit brauchen wir eineindeutige IDs, nach dem Prinzip “1. Skipgram der 1. Beschwerde” etc:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/tidy-pmi3_c094f46bfe2059133f95884d65af8e85">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pmi3</span> <span class="op">&lt;-</span> <span class="va">tidy_pmi2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span><span class="va">window_id</span>, <span class="va">complaint_id</span>, <span class="va">window_id</span><span class="op">)</span>  <span class="co"># führe Spalten zusammen</span></span>
<span></span>
<span><span class="va">tidy_pmi3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["window_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["word"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"3384392_1","2":"systems"},{"1":"3384392_1","2":"inc"},{"1":"3384392_1","2":"is"},{"1":"3384392_1","2":"trying"},{"1":"3384392_2","2":"inc"},{"1":"3384392_2","2":"is"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Schließlich berechnen wir die Ähnlichkeit mit <code>pairwise_pmi</code>, das hatten wir uns oben schon mal näher angeschaut:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/tidy-pmi4_2d5406115227464c1e9a41fcc9aef6f4">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_pmi4</span> <span class="op">&lt;-</span> <span class="va">tidy_pmi3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/pairwise_pmi.html">pairwise_pmi</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">window_id</span><span class="op">)</span>  <span class="co"># berechne Ähnlichkeit</span></span>
<span></span>
<span><span class="va">tidy_pmi</span> <span class="op">&lt;-</span> <span class="va">tidy_pmi4</span>  <span class="co"># mit dem Objekt arbeiten wir dann weiter</span></span>
<span></span>
<span><span class="va">tidy_pmi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["item2"],"name":[2],"type":["chr"],"align":["left"]},{"label":["pmi"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"inc","2":"systems","3":"5.728498"},{"1":"is","2":"systems","3":"2.838126"},{"1":"trying","2":"systems","3":"5.035351"},{"1":"systems","2":"inc","3":"5.728498"},{"1":"is","2":"inc","3":"2.838126"},{"1":"trying","2":"inc","3":"5.035351"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section><section id="svd" class="level3" data-number="7.3.5"><h3 data-number="7.3.5" class="anchored" data-anchor-id="svd">
<span class="header-section-number">7.3.5</span> SVD</h3>
<p>Die <em>Singulärwertzerlegung</em> (singular value decomposition, SVD) ist ein Verfahren zur Verringerung der Spaltenzahl (Dimension), vergleichbar zur Faktorenanalyse. Zur Anschaulichkeit - und ohne substanziellen Hintergrund - sei folgendes Beispiel genannt: Die Verben “gehen”, “rennen”, “laufen”, “schwimmen”, “fahren”, “rutschen” könnten zu einer gemeinsamen Dimension, etwa “fortbewegen” reduziert werden. Jedes einzelne der eingehenden Verben erhält eine Zahl von 0 bis 1, das die konzeptionelle Nähe des Verbs zur “dahinterliegenden” Dimension (fortbewegen) quantifiziert; die Zahl nennt man auch die “Ladung” des Items (Worts) auf die Dimension. Sagen wir, wir identifizieren 10 Dimensionen. Man erhält dann für jedes unique Wort im Corpus einen Vektor mit den Ladungen auf die Dimensionen. Im genannten Beispiel wäre es ein 10-stelliger Vektor. So wie ein 3-stelliger Vektor die Position einer Biene im Raum beschreibt<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, beschreibt hier unser 10-stelliger Vektor die “Position” eines Worts in unserem <em>Einbettungsvektor</em>.</p>
<p>Die Syntax dazu ist dieses Mal einfach:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/widely-svd_471d984af6e1856c781ad468b219d4fe">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_word_vectors</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">tidy_pmi</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/widely_svd.html">widely_svd</a></span><span class="op">(</span></span>
<span>    <span class="va">item1</span>, <span class="va">item2</span>, <span class="va">pmi</span>,</span>
<span>    nv <span class="op">=</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_word_vectors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">(</span><span class="va">head</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["dimension"],"name":[2],"type":["int"],"align":["right"]},{"label":["value"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"inc","2":"1","3":"0.03789628"},{"1":"is","2":"1","3":"0.11320691"},{"1":"trying","2":"1","3":"0.05127645"},{"1":"systems","2":"1","3":"0.03333321"},{"1":"to","2":"1","3":"0.12034339"},{"1":"collect","2":"1","3":"0.05542110"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Mit <code>nv = 100</code> haben wir die Anzahl (<code>n</code>) der Dimensionen (Variablen, <code>v</code>) auf 100 bestimmt.</p>
</section><section id="wortähnlichkeit" class="level3" data-number="7.3.6"><h3 data-number="7.3.6" class="anchored" data-anchor-id="wortähnlichkeit">
<span class="header-section-number">7.3.6</span> Wortähnlichkeit</h3>
<p>Jetzt, da wir mit der SVD jedes Wort in einem Koordinatensystem verortet haben, können wir die Abstände der Wörter im Koordinatensystem bestimmen. Das geht mit Hilfe des alten Pythagoras, s. <a href="#fig-euklid-distance" class="quarto-xref">Abbildung&nbsp;<span class="quarto-unresolved-ref">fig-euklid-distance</span></a>. Der Abstand, den man mit Hilfe des Satz des Pythagoras berechnet, nennt man auch <em>euklidische Distanz</em>.</p>
<div id="fig-euklid-distance" class="quarto-figure quarto-figure-center anchored" width="50%">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-euklid-distance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/euklid-distance.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-euklid-distance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;7.3: Euklidische Distanz in 2D, Quelle: Wikipedia, CC BY4.0, Kmhkmh
</figcaption></figure>
</div>
<p>Okay, wir sind in einem Raum mit vielen Dimensionen, was mein Hirn nicht mitmacht, <a href="https://mathworld.wolfram.com/Distance.html">aber der Algebra ist das egal</a>. Pythagoras’ Satz lässt sich genauso anwenden, wenn es mehr als Dimensionen sind.</p>
<p>Die Autoren basteln sich selber eine Funktion in <a href="https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings">Kap. 5.3</a>, aber der Einfachheit halber nehme ich (erstmal) die entsprechende Funktion aus <code>widyr</code>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/pairwise-dist_4118ca68baa871dfc0af7459269e405e">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">word_neighbors</span> <span class="op">&lt;-</span> </span>
<span><span class="va">tidy_word_vectors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/pairwise_dist.html">pairwise_dist</a></span><span class="op">(</span><span class="va">item1</span>, <span class="va">dimension</span>, <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="va">word_neighbors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["item2"],"name":[2],"type":["chr"],"align":["left"]},{"label":["distance"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"is","2":"inc","3":"1.0220147"},{"1":"trying","2":"inc","3":"0.9332845"},{"1":"systems","2":"inc","3":"0.4161259"},{"1":"to","2":"inc","3":"1.0913876"},{"1":"collect","2":"inc","3":"0.5221787"},{"1":"a","2":"inc","3":"1.0309535"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Schauen wir uns ein Beispiel an. Was sind die Nachbarn von “inaccurate”?</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-22_80346be309e1baf7556f8311772d02fd">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">word_neighbors</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">item1</span> <span class="op">==</span> <span class="st">"inaccurate"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">distance</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["item2"],"name":[2],"type":["chr"],"align":["left"]},{"label":["distance"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"inaccurate","2":"mine","3":"0.5248875"},{"1":"inaccurate","2":"score","3":"0.5310127"},{"1":"inaccurate","2":"oh","3":"0.5400913"},{"1":"inaccurate","2":"ny","3":"0.5400913"},{"1":"inaccurate","2":"dob","3":"0.5801282"},{"1":"inaccurate","2":"cell","3":"0.6093669"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Hier ist die Datenmenge zu klein, um vernünftige Schlüsse zu ziehen. Aber “incorrectly”, “correct”, “balance” sind wohl plausible Nachbarn von “inaccurate”.</p>
</section><section id="cosinus-ähnlichkeit" class="level3" data-number="7.3.7"><h3 data-number="7.3.7" class="anchored" data-anchor-id="cosinus-ähnlichkeit">
<span class="header-section-number">7.3.7</span> Cosinus-Ähnlichkeit</h3>
<p>Die Nähe zweier Vektoren lässt sich, neben der euklidischen Distanz, auch z.B. über die <a href="https://en.wikipedia.org/wiki/Cosine_similarity">Cosinus-Ähnlichkeit</a> (Cosine similarity) berechnen, vgl. auch <a href="#fig-dotproduct" class="quarto-xref">Abbildung&nbsp;<span class="quarto-unresolved-ref">fig-dotproduct</span></a>:</p>
<div id="fig-dotproduct" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dotproduct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/dotproduct.png" class="img-fluid figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-dotproduct-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;7.4: Die Cosinus-Ähnlichkeit zweier Vektoren
</figcaption></figure>
</div>
<p><a href="https://en.wikipedia.org/wiki/Dot_product#/media/File:Dot_Product.svg">Quelle: Mazin07, Lizenz: PD</a></p>
<p><span class="math display">\[{\displaystyle {\text{Cosinus-Ähnlichkeit}}=S_{C}(A,B):=\cos(\theta )={\mathbf {A} \cdot \mathbf {B}  \over \|\mathbf {A} \|\|\mathbf {B} \|}={\frac {\sum \limits _{i=1}^{n}{A_{i}B_{i}}}{{\sqrt {\sum \limits _{i=1}^{n}{A_{i}^{2}}}}{\sqrt {\sum \limits _{i=1}^{n}{B_{i}^{2}}}}}},}\]</span></p>
<p>wobei <span class="math inline">\(A\)</span> und <span class="math inline">\(B\)</span> zwei Vektoren sind und <span class="math inline">\(\|\mathbf {A} \|\)</span> das Skalarprodukt von A (und B genauso). Das <a href="https://en.wikipedia.org/wiki/Dot_product">Skalarprodukt</a> von <span class="math inline">\(\color {red} {a = {\displaystyle [a_{1},a_{2},\cdots ,a_{n}]}}\)</span> und <span class="math inline">\(\color {blue} {b = {\displaystyle [b_{1},b_{2},\cdots ,b_{n}]}}\)</span> ist so definiert:</p>
<p><span class="math display">\[{\displaystyle \mathbf {\color {red}a} \cdot \mathbf {\color {blue}b} =\sum _{i=1}^{n}{\color {red}a}_{i}{\color {blue}b}_{i}={\color {red}a}_{1}{\color {blue}b}_{1}+{\color {red}a}_{2}{\color {blue}b}_{2}+\cdots +{\color {red}a}_{n}{\color {blue}b}_{n}}\]</span></p>
<p>Entsprechend ist die Funktion <code>nearest_neighbors</code> zu verstehen aus <a href="https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings">Kap. 5.3</a>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-23_d86532b56b27a00d8929c8350a9ff2ee">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nearest_neighbors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">token</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/widely.html">widely</a></span><span class="op">(</span></span>
<span>      <span class="op">~</span> <span class="op">{</span></span>
<span>        <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">.</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">token</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> </span>
<span>          <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="va">token</span>, <span class="op">]</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">res</span>, ncol <span class="op">=</span> <span class="fl">1</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      sort <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span><span class="op">(</span><span class="va">item1</span>, <span class="va">dimension</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">item2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Wobei mit <code>widely</code> zuerst noch von der Langform in die Breitform umformatiert wird, da die Breitform von der Formel verlangt wird bzw. das Rechnen einfacher macht.</p>
<p>Der eine Vektor ist das Embedding des Tokens, der andere Vektor ist das <em>mittlere</em> Embedding über alle Tokens des Corpus. Wenn die Anzahl der Elemente konstant bleibt, kann man sich das Teilen durch <span class="math inline">\(n\)</span> schenken, wenn man einen Mittelwert berechnen; so hält es auch die Syntax von <code>nearest_neighbors</code>.</p>
<p>Ein nützlicher Post zur Cosinus-Ähnlichkeit findet sich <a href="https://towardsdatascience.com/cosine-similarity-how-does-it-measure-the-similarity-maths-behind-and-usage-in-python-50ad30aad7db">hier</a>. <a href="https://datascience-enthusiast.com/figures/cosine_sim.png">Dieses Bild</a> zeigt das Konzept der Cosinus-Ähnlichkeit anschaulich.</p>
<p>Zur Erinnerung: Der Cosinus eines Winkels ist definiert als Verhältnis der Länge der Ankathete (das ist jene Kathete, die einen Schenkel des Winkels bildet) zur Länge der Hypotenuse<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> in einem rechtwinkligen, vgl. <a href="#fig-dreieck" class="quarto-xref">Abbildung&nbsp;<span class="quarto-unresolved-ref">fig-dreieck</span></a>.</p>
<div id="fig-dreieck" class="quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dreieck-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="img/dreieck.png" class="img-fluid figure-img">
</div>
<figcaption class="figure quarto-float-caption quarto-float-fig" id="fig-dreieck-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;7.5: Ein rechtwinkliges Dreieck als Grundlage der trigonometrischen Funktionen
</figcaption></figure>
</div>
<p>Also: <span class="math inline">\({\displaystyle \cos \alpha ={\frac {b}{c}}}\)</span></p>
<p><a href="https://de.wikipedia.org/wiki/Sinus_und_Kosinus#/media/Datei:RechtwinkligesDreieck.svg">Quelle: PaterSigmund, Wikipedia,dre CC-BY-SA 2.5</a></p>
<p>Hilfreich ist auch <a href="https://de.wikipedia.org/wiki/Sinus_und_Kosinus#/media/Datei:Sinus_und_Kosinus_am_Einheitskreis_1.svg">die Visualisierung von Sinus und Cosinus am Einheitskreis</a>; gerne <a href="https://upload.wikimedia.org/wikipedia/commons/f/f3/Sinus_und_Cosinus_am_Einheitskreis.gif">animiert</a> betrachten.</p>
</section></section><section id="word-embeddings-vorgekocht" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="word-embeddings-vorgekocht">
<span class="header-section-number">7.4</span> Word-Embeddings vorgekocht</h2>
<section id="glove6b" class="level3" data-number="7.4.1"><h3 data-number="7.4.1" class="anchored" data-anchor-id="glove6b">
<span class="header-section-number">7.4.1</span> Glove6B</h3>
<p>In <a href="https://smltar.com/embeddings.html#glove">Kap. 5.4</a> schreiben die Autoren:</p>
<blockquote class="blockquote">
<p>If your data set is too small, you typically cannot train reliable word embeddings.</p>
</blockquote>
<p>Ein paar Millionen Wörter sollte der Corpus schon enthalten, so die Autoren. Da solche “Worteinbettungen” (word embedings) aufwändig zu erstellen sind, kann man fertige, “vorgekochte” Produkte nutzen.</p>
<p>Glove6B wurde anhand von Wikipedia und anderen Datenquellen erstellt <span class="citation" data-cites="pennington_glove_2014">(<a href="#ref-pennington_glove_2014" role="doc-biblioref">Pennington, Socher, und Manning 2014</a>)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Die zugehörigen Daten sind recht groß; für <a href="https://nlp.stanford.edu/projects/glove/"><code>glove6b</code></a> <span class="citation" data-cites="pennington_glove_2014">(<a href="#ref-pennington_glove_2014" role="doc-biblioref">Pennington, Socher, und Manning 2014</a>)</span> ist fast ein Gigabyte fällig. Sie sollten sich die Daten in einem ruhigen Moment (mit stabiler Internetverbindung) herunterladen und in einem Verzeichnis meiner Wahl abgespeichert (<code>datasets</code>). Da bei mir Download abbrach, als ich <code>embedding_glove6b(dimensions = 100)</code> aufrief, habe ich die Daten manuell heruntergeladen, s.u.</p>
</div>
</div>
<p>Wie immer, Hilfe für eine Funktion bekommt man mit <code>?fun_name</code> oder interaktiv z.B. in RStudio.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/load-glove_25547664596a3428a08225336fed918e">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">glove6b</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/textdata/man/embedding_glove.html">embedding_glove6b</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="st">"~/datasets"</span>,  <span class="co"># aus dem Paket `textdata`</span></span>
<span>                    dimensions <span class="op">=</span> <span class="fl">50</span>,  <span class="co"># mit nur 50 Dimensionen</span></span>
<span>                    manual_download <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>  <span class="co"># ist der Datensatz schon manuell heruntergeladen?</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-25_3abe0c0d76f6707e600d4198f18eb895">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">glove6b</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["token"],"name":[1],"type":["chr"],"align":["left"]},{"label":["d1"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["d2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["d3"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["d4"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"the","2":"0.418000","3":"0.249680","4":"-0.41242","5":"0.121700"},{"1":",","2":"0.013441","3":"0.236820","4":"-0.16899","5":"0.409510"},{"1":".","2":"0.151640","3":"0.301770","4":"-0.16763","5":"0.176840"},{"1":"of","2":"0.708530","3":"0.570880","4":"-0.47160","5":"0.180480"},{"1":"to","2":"0.680470","3":"-0.039263","4":"0.30186","5":"-0.177920"},{"1":"and","2":"0.268180","3":"0.143460","4":"-0.27877","5":"0.016257"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Die ersten paar Tokens sind:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-26_28530680bcc5628d1a12120723128674">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">glove6b</span><span class="op">$</span><span class="va">token</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="co">##  [1] "the"  ","    "."    "of"   "to"   "and"  "in"   "a"    "\""   "'s"  </span></span>
<span><span class="co">## [11] "for"  "-"    "that" "on"   "is"   "was"  "said" "with" "he"   "as"</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In eine Tidyform bringen:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-27_8275f0535dbb712b37c5099560291bc6">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_glove</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">glove6b</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">contains</a></span><span class="op">(</span><span class="st">"d"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"dimension"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>item1 <span class="op">=</span> <span class="va">token</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tidy_glove</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["dimension"],"name":[2],"type":["chr"],"align":["left"]},{"label":["value"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"the","2":"d1","3":"0.418000"},{"1":"the","2":"d2","3":"0.249680"},{"1":"the","2":"d3","3":"-0.412420"},{"1":"the","2":"d4","3":"0.121700"},{"1":"the","2":"d5","3":"0.345270"},{"1":"the","2":"d6","3":"-0.044457"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Ganz schön groß:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-28_6ff1b7a0a904b8b394c5c0080917aaa5">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">glove6b</span><span class="op">)</span></span>
<span><span class="co">## [1] 400000     51</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-29_fc98dce55158813840e3b3b927e95dc7">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">tidy_glove</span><span class="op">)</span></span>
<span><span class="co">## 503834736 bytes</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In Megabyte<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-30_0d746724a1ef5826c9de5d6cb700a12a">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/object.size.html">object.size</a></span><span class="op">(</span><span class="va">tidy_glove</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">^</span><span class="fl">20</span></span>
<span><span class="co">## 480.5 bytes</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Einfacher und genauer geht es so:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-31_0a80d721d6b20d2db98f8cc39736c006">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">tidy_glove</span><span class="op">)</span></span>
<span><span class="co">## 503.83 MB</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-32_abbda65bef7a208336648e41697c93ef">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## 858 MB</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Um Speicher zu sparen, könnte man <code>glove6b</code> wieder direkt löschen, wenn man nur mit der Tidyform weiterarbeitet.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-33_05483203e5b9a25944666a1414447e0f">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">glove6b</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Jetzt können wir wieder nach Nachbarn fragen, im euklidischen Sinne, wie oben. Probieren wir aus, welche Wörter nah zu “inaccurate” stehen.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Hinweis
</div>
</div>
<div class="callout-body-container callout-body">
<p>Wie wir oben gesehen haben, ist der Datensatz riesig<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, was die Berechnungen (zeitaufwändig) und damit nervig machen können. Darüber hinaus kann es nötig sein, dass Sie mehr Speicher auf Ihrem Computer zur Verfügung stellen müssen<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Wir müssen noch <code>maximum_size = NULL</code>, um das Jonglieren mit riesigen Matrixen zu erlauben. Möge der Gott der RAMs und Arbeitsspeicher uns gnädig sein!</p>
</div>
</div>
<p>Mit <code>pairwise_dist</code> dauert die Berechnung sehr lange und braucht wohl sehr viel Speicher. Mitunter kam folgender Fehler auf: “R error: vector memory exhausted (limit reached?)”.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-34_524f773014ed953c81dd36d80efe1362">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">word_neighbors_glove6b</span> <span class="op">&lt;-</span> </span>
<span><span class="va">tidy_glove</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/pairwise_dist.html">pairwise_dist</a></span><span class="op">(</span><span class="va">item1</span>, <span class="va">dimension</span>, <span class="va">value</span>, maximum_size <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">word_neighbors_glove6b</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_glove</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">item1</span> <span class="op">==</span> <span class="st">"inaccurate"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Deswegen probieren wir doch die Funktion <code>nearest_neighbors</code>, so wie es im Buch vorgeschlagen wird, s. <a href="https://smltar.com/embeddings.html#exploring-cfpb-word-embeddings">Kap 5.3</a>.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/fun-nearest-neighbors2_5fd3dc01fa8d285f56193e37aa4c29ba">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nearest_neighbors</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">token</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://juliasilge.github.io/widyr/reference/widely.html">widely</a></span><span class="op">(</span></span>
<span>      <span class="op">~</span> <span class="op">{</span></span>
<span>        <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">.</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">token</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> </span>
<span>          <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="va">token</span>, <span class="op">]</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">res</span>, ncol <span class="op">=</span> <span class="fl">1</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span>,</span>
<span>      sort <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      maximum_size <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span><span class="op">(</span><span class="va">item1</span>, <span class="va">dimension</span>, <span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">item2</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/tidy-glove-nearest-neighbors_fa2c0fa6962e7230cbc2a2e87dacc901">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_glove</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># slice_head(prob = .1) %&gt;% </span></span>
<span>  <span class="fu">nearest_neighbors</span><span class="op">(</span><span class="st">"error"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["item1"],"name":[1],"type":["chr"],"align":["left"]},{"label":["value"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"error","2":"1.0000000"},{"1":"errors","2":"0.8462532"},{"1":"correct","2":"0.7349197"},{"1":"mistake","2":"0.7174614"},{"1":"accurate","2":"0.7063602"},{"1":"precise","2":"0.7035035"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Entschachteln wir unsere Daten zu <code>complaints</code>:</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnest-tidy-complaints3_60ee389ba2152157b24e164be3693cd8">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_complaints3</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">nested_words3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span><span class="op">(</span><span class="va">words</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dann erstellen wir uns eine Tabelle, in der nur die Schnittmenge der Wörter aus den Beschwerden und Glove vorkommen. Dazu nutzen winr einen <a href="https://github.com/gadenbuie/tidyexplain/blob/main/images/inner-join.gif">inneren Join</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/inner-join.gif" class="img-fluid figure-img"></p>
<figcaption>Inner Join, Quelle: Garrick Adenbuie</figcaption></figure>
</div>
<p><a href="https://github.com/gadenbuie/tidyexplain">Quelle</a></p>
<div class="cell" data-hash="050-word-embedding_cache/html/join-complaints-glove_f4f9f39118501f69e6348786089f0a6d">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">complaints_glove</span> <span class="op">&lt;-</span> </span>
<span><span class="va">tidy_complaints3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"word"</span>, </span>
<span>  <span class="va">tidy_glove</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">item1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>word <span class="op">=</span> <span class="va">item1</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">complaints_glove</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["complaint_id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["word"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"3384392","2":"systems"},{"1":"3384392","2":"inc"},{"1":"3384392","2":"is"},{"1":"3384392","2":"trying"},{"1":"3384392","2":"to"},{"1":"3384392","2":"collect"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Wie viele unique (distinkte) Wörter gibt es in unserem Corpus?</p>
<div class="cell" data-hash="050-word-embedding_cache/html/tidy_complaints3_distinct_words_n_4c2ba336f309dd585efb40f944220f5f">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_complaints3_distinct_words_n</span> <span class="op">&lt;-</span> </span>
<span><span class="va">tidy_complaints3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tidy_complaints3_distinct_words_n</span></span>
<span><span class="co">## [1] 222</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code>tidy_complaints</code> gibt es übrigens 222 verschiedene Wörter.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/word_matrix_5814af2f71076aac8bec03f940273cd5">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">word_matrix</span> <span class="op">&lt;-</span> <span class="va">tidy_complaints3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"word"</span>,</span>
<span>             <span class="va">tidy_glove</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">item1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>word <span class="op">=</span> <span class="va">item1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">complaint_id</span>, <span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/cast_sparse.html">cast_sparse</a></span><span class="op">(</span><span class="va">complaint_id</span>, <span class="va">word</span>, <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#word_matrix</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>word_matrix</code> zählt für jede der 10 Beschwerden, welche Wörter (und wie häufig) vorkommen.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-35_6c409cd8f03afcb0de7658383dffb577">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">word_matrix</span><span class="op">)</span></span>
<span><span class="co">## [1]  10 222</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>10 Beschwerden (Dokumente) und 222 unique Wörter.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/glove_matrix_aa71f52cb314ed9633768250ba520e0d">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">glove_matrix</span> <span class="op">&lt;-</span> <span class="va">tidy_glove</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"item1"</span>,</span>
<span>             <span class="va">tidy_complaints3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>item1 <span class="op">=</span> <span class="va">word</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/cast_sparse.html">cast_sparse</a></span><span class="op">(</span><span class="va">item1</span>, <span class="va">dimension</span>, <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#glove_matrix</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>glove_matrix</code> gibt für jedes unique Wort den Einbettungsvektor an.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-36_6234824dda04e19d14e32629e01e8963">
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">glove_matrix</span><span class="op">)</span></span>
<span><span class="co">## [1] 222  50</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das sind 222 unique Wörter und 50 Dimensionen des Einbettungsvektors.</p>
<p>Jetzt können wir noch pro Dokument (10 in diesem Beispiel) die mittlere “Position” jedes Dokuments im Einbettungsvektor ausrechnen. Bildlich gesprochen: Was ist der mittlere Raumpunkt (Zentroid) des Bienenschwarms, wobei eine Biene ein Dokument darstellt und die Raumachsen die Dimensionen des Einbettungsvektors.</p>
<p>Dazu gewichten wir jedes Wort eines Dokuments mit den Ladungen des Einbettungsvektor und summieren diese Terme. Es resultiert eine Matrix mit einem Einbettungsvektor pro Dokument. Diese Matrix können wir jetzt als Prädiktorenmatrix hernehmen.</p>
<div class="cell" data-hash="050-word-embedding_cache/html/doc_matrix_8ac7db28475be6072fcb91a76e695cfb">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">doc_matrix</span> <span class="op">&lt;-</span> <span class="va">word_matrix</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">glove_matrix</span></span>
<span><span class="co">#doc_matrix %&gt;% head()</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="050-word-embedding_cache/html/unnamed-chunk-37_cdb06327327393c29b81fd32298bd1fe">
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">doc_matrix</span><span class="op">)</span></span>
<span><span class="co">## [1] 10 50</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Die Anzahl der Dokumente ist 10 und die Anzahl der Dimensionen (des Einbettungsvektors) ist 50.</p>
</section><section id="wordembeddings-für-die-deutsche-sprache" class="level3" data-number="7.4.2"><h3 data-number="7.4.2" class="anchored" data-anchor-id="wordembeddings-für-die-deutsche-sprache">
<span class="header-section-number">7.4.2</span> Wordembeddings für die deutsche Sprache</h3>
<p>In dem <a href="https://wikipedia2vec.github.io/wikipedia2vec/">Github-Projekt “Wikipedia2Vec”</a> finden sich die Materialien für ein deutsches Wordembedding <span class="citation" data-cites="yamada2019neural">(<a href="#ref-yamada2019neural" role="doc-biblioref">Yamada und Shindo 2019</a>)</span>.</p>
</section></section><section id="fazit" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="fazit">
<span class="header-section-number">7.5</span> Fazit</h2>
<p>Worteinbettungen sind eine aufwändige Angelegenheit. Positiv gesprochen kann ein Analysti die Muskeln spielen lassen und zeigen, was sie oder er so alles drauf hat. Ist ja schon cooles Zeugs, die Word Embeddings. Es besteht die Chance, dass man mit dieser Methode bessere Vorhersagen erreicht, als mit anderen, einfachen Ansätzen wir Worthäufigkeiten oder tf-idf. Auf der anderen Seite ist es oft sinnvoll, mit einfachen Ansätzen zu starten, und zu sehen, wie weit man kommt. Vielleicht ja weit genug. Natürlich haben Modelle auf Basis von Worthäufigkeiten auch ihre Schwächen: Vor allem ist ihre prädiktive Nützlichkeit nicht immer gegeben und die Datensätze werden schnell sehr groß (viele Spalten).</p>
</section><section id="fallstudie" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="fallstudie">
<span class="header-section-number">7.6</span> Fallstudie</h2>
<p><a href="https://juliasilge.com/blog/tidy-word-vectors/">Hacker-News-Einbettungs-Fallstudie</a> (was für ein Word!) – Eine praktische Darstellung der Erstellung von Word-Vektoren rein auf Basis der linearen Algebra.</p>
</section><section id="vertiefung" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="vertiefung">
<span class="header-section-number">7.7</span> Vertiefung</h2>
<p>Worteinbettungen sind ein zentrales Thema im NLP; für moderne Sprachmodelle sind sie von zentraler Bedeutung. Entsprechend findet sich viel Literatur, z.B. <span class="citation" data-cites="liu_representation_2023 george_python_2022 noauthor_word_2023 mikolov_efficient_2013 camacho-collados_embeddings_2020 almeida_word_2019 pilehvar_embeddings_2021">(<a href="#ref-liu_representation_2023" role="doc-biblioref">Liu, Lin, und Sun 2023</a>; <a href="#ref-george_python_2022" role="doc-biblioref">George 2022</a>; <a href="#ref-noauthor_word_2023" role="doc-biblioref"><span>„Word Embeddings in <span>NLP</span>: <span>A Complete Guide</span>“</span> 2023</a>; <a href="#ref-mikolov_efficient_2013" role="doc-biblioref">Mikolov u.&nbsp;a. 2013</a>; <a href="#ref-camacho-collados_embeddings_2020" role="doc-biblioref">Camacho-Collados und Pilehvar 2020</a>; <a href="#ref-almeida_word_2019" role="doc-biblioref">Almeida und Xexéo 2019</a>; <a href="#ref-pilehvar_embeddings_2021" role="doc-biblioref">Pilehvar und Camacho-Collados 2021</a>)</span>.</p>
<p>Ein Online-Python-Tutorial findet sich z.B. bei <a href="https://www.tensorflow.org/text/guide/word_embeddings">TensorFlow</a>.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-almeida_word_2019" class="csl-entry" role="listitem">
Almeida, Felipe, und Geraldo Xexéo. 2019. <span>„Word <span>Embeddings</span>: <span>A Survey</span>“</span>. <em>ArXiv</em>, Januar. <a href="https://www.semanticscholar.org/paper/Word-Embeddings%3A-A-Survey-Almeida-Xex%C3%A9o/e28e81a8cb6655aebb72357538f7b7a360366a29">https://www.semanticscholar.org/paper/Word-Embeddings%3A-A-Survey-Almeida-Xex%C3%A9o/e28e81a8cb6655aebb72357538f7b7a360366a29</a>.
</div>
<div id="ref-camacho-collados_embeddings_2020" class="csl-entry" role="listitem">
Camacho-Collados, Jose, und Mohammad Taher Pilehvar. 2020. <span>„Embeddings in <span>Natural Language Processing</span>“</span>. In <em>Proceedings of the 28th <span>International Conference</span> on <span>Computational Linguistics</span>: <span>Tutorial Abstracts</span></em>, 10–15. <span>Barcelona, Spain (Online)</span>: <span>International Committee for Computational Linguistics</span>. <a href="https://doi.org/10.18653/v1/2020.coling-tutorials.2">https://doi.org/10.18653/v1/2020.coling-tutorials.2</a>.
</div>
<div id="ref-george_python_2022" class="csl-entry" role="listitem">
George, Alexandra. 2022. <em>Python Text Mining: Perform Text Processing, Word Embedding, Text Classification and Machine Translation</em>. <span>Delhi</span>: <span>BPB Publications</span>.
</div>
<div id="ref-smltar" class="csl-entry" role="listitem">
Hvitfeldt, Emil, und Julia Silge. 2021. <em>Supervised <span>Machine Learning</span> for <span>Text Analysis</span> in <span>R</span></em>. 1. Aufl. <span>Boca Raton</span>: <span>Chapman and Hall/CRC</span>. <a href="https://doi.org/10.1201/9781003093459">https://doi.org/10.1201/9781003093459</a>.
</div>
<div id="ref-liu_representation_2023" class="csl-entry" role="listitem">
Liu, Zhiyuan, Yankai Lin, und Maosong Sun, Hrsg. 2023. <em>Representation <span>Learning</span> for <span>Natural Language Processing</span></em>. <span>Singapore</span>: <span>Springer Nature Singapore</span>. <a href="https://doi.org/10.1007/978-981-99-1600-9">https://doi.org/10.1007/978-981-99-1600-9</a>.
</div>
<div id="ref-mikolov_efficient_2013" class="csl-entry" role="listitem">
Mikolov, Tomas, Kai Chen, Greg Corrado, und Jeffrey Dean. 2013. <span>„Efficient <span>Estimation</span> of <span>Word Representations</span> in <span>Vector Space</span>“</span>. 6. September 2013. <a href="https://doi.org/10.48550/arXiv.1301.3781">https://doi.org/10.48550/arXiv.1301.3781</a>.
</div>
<div id="ref-pennington_glove_2014" class="csl-entry" role="listitem">
Pennington, Jeffrey, Richard Socher, und Christopher Manning. 2014. <span>„<span>GloVe</span>: <span>Global</span> Vectors for Word Representation“</span>. In <em>Proceedings of the 2014 Conference on Empirical Methods in Natural Language Processing (<span>EMNLP</span>)</em>, 1532–43. <span>Doha, Qatar</span>: <span>Association for Computational Linguistics</span>. <a href="https://doi.org/10.3115/v1/D14-1162">https://doi.org/10.3115/v1/D14-1162</a>.
</div>
<div id="ref-pilehvar_embeddings_2021" class="csl-entry" role="listitem">
Pilehvar, Mohammad Taher, und Jose Camacho-Collados. 2021. <em>Embeddings in <span>Natural Language Processing</span>: <span>Theory</span> and <span>Advances</span> in <span>Vector Representations</span> of <span>Meaning</span></em>. Synthesis <span>Lectures</span> on <span>Human Language Technologies</span>. <span>Cham</span>: <span>Springer International Publishing</span>. <a href="https://doi.org/10.1007/978-3-031-02177-0">https://doi.org/10.1007/978-3-031-02177-0</a>.
</div>
<div id="ref-noauthor_word_2023" class="csl-entry" role="listitem">
<span>„Word Embeddings in <span>NLP</span>: <span>A Complete Guide</span>“</span>. 2023. <span>Turing</span>. 2023. <a href="https://www.turing.com/kb/guide-on-word-embeddings-in-nlp">https://www.turing.com/kb/guide-on-word-embeddings-in-nlp</a>.
</div>
<div id="ref-yamada2019neural" class="csl-entry" role="listitem">
Yamada, Ikuya, und Hiroyuki Shindo. 2019. <span>„Neural Attentive Bag-of-Entities Model for Text Classification“</span>. In <em>Proceedings of the 23th <span>SIGNLL</span> Conference on Computational Natural Language Learning</em>, 563–73. <span>Association for Computational Linguistics</span>.
</div>
</div>
</section><aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Man könnte ergänzen: plus eine 4. Dimension für Zeit, plus noch ein paar Weitere für die Beschleunigung in verschiedene Richtungen…<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Quelle: https://de.wikipedia.org/wiki/Sinus_und_Kosinus<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p><span class="math inline">\(1024 \cdot 1024\)</span> Byte, und <span class="math inline">\(1024 =2^{10}\)</span>, daher <span class="math inline">\(2^{10} \cdot 2^{10} = 2^{20}\)</span><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>zugegeben, ein subjektiver Ausdruck<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Kaufen…<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></aside></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./065-Information.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Informationstheorie</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./060-hassrede.html" class="pagination-link" aria-label="<span class='chapter-number'>8</span>&nbsp; <span class='chapter-title'>Hassrede</span>">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Hassrede</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>